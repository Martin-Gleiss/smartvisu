/**
* -----------------------------------------------------------------------------
* @package     smartVISU
* @author      Martin Glei√ü
* @copyright   2012 - 2015
* @license     GPL [http://www.gnu.de]
* -----------------------------------------------------------------------------
*/
{% extends "index.html" %}

{% block content %}

	{% block headline %}
		<h1>stateengine</h1>
	{% endblock %}

	{% block intro %}
		Information on how to implement the autoblind/stateengine plugin

	{% endblock %}
<div class="docu_text">
If you use the autoblind/stateengine plugin you can define icons and values in the config.ini file and show an icon based on the current state.<br>
Examples:<br>
* stateengine_icons = "icons/ws/time_manual_mode.svg, icons/ws/secur_locked.svg, icons/ws/time_automatic.svg, icons/ws/fts_shutter_automatic.svg, icons/ws/weather_sun.svg, icons/ws/weather_sunset.svg, icons/ws/weather_sunrise.svg, icons/ws/weather_moonset.svg, icons/ws/scene_x-mas.svg, icons/ws/fts_shutter_automatic.svg, icons/ws/scene_sleeping.svg, icons/ws/weather_wind.svg, icons/ws/weather_snow.svg, icons/ws/weather_rain.svg, icons/ws/scene_x-mas.svg, icons/ws/scene_cinema.svg, icons/ws/it_television.svg, icons/ws/scene_sleeping.svg, icons/ws/status_away_2.svg, icons/ws/status_available.svg, icons/ws/time_manual_mode.svg, icons/ws/time_timer.svg, icons/ws/status_standby.svg, icons/ws/scene_shower.svg, icons/ws/weather_sunset.svg, icons/ws/weather_sunrise.svg, icons/ws/light_party.svg, icons/ws/scene_cleaning.svg, icons/ws/scene_drink.svg, icons/ws/scene_deckchair.svg, icons/ws/light_office.svg, icons/ws/light_office.svg, icons/ws/scene_summerhouse.svg, icons/ws/halloween.svg, icons/ws/weather_sun.svg" <br>
* stateengine_values = "Ausgesetzt, Gesperrt, Standard, Tag (statisch), Sonnenstand, Abend, Morgen, Nacht, Advent, Hinaufgefahren, Schlafen, Wind, Schnee, Regen, Advent, Kino, TV, Nacht, Abwesend, Anwesend, Manuell, Timer, Ausgeschaltet, Duschen, Abend, Morgen, Party, Putzen, Chillen, Outdoorchillen, Arbeiten, Outdoorarbeiten, Outdoorflexibel, Halloween, Mittag"
</div>
<div class="docu_text">
If you want to create a mostly automatic popup for multiple items on a page you can copy this code to the beginning of your page.
Change "item1" to a name of your liking and change the items inside the array accordingly.
After the "autoblind" entry you add your states that are relevant for your item.
</div>
<div class="twig">
	<code class="param">{% filter trim|escape|nl2br %}{% raw %}
{% set stateengine = {} %}
{% set stateengine_items = {
'item1': ['item1.automatik.lock', 'item1.automatik.settings.suspendduration', '0', '60', '5',
'item1.automatik.settings.sollwert', '0', '250', '5', 'item1.automatik.settings.sperren', '0', '1', 'sperren', 'autoblind',
'standard', 'morning']
} %}
{% endraw %}{% endfilter %}</code>
</div>
<div class="docu_text">
Copy this code right after it. You only have to add your own states in the "set sollwerte", "set sperrwerte" and below as an "if statement". Look at "standard" and "morning" as a template.
</div>
<div class="twig">
	<code class="param">{% filter trim|escape|nl2br %}{% raw %}
{% for item,content in stateengine_items %}
    {% set itemname = item|replace({'.': '_'}) %}
	{% set suspend = [['switch', 'slider'], [content[0], 'icon', [0,1], ['secur_open.svg','secur_locked.svg']], [content[1], content[2], content[3], content[4], '', 'handle']] %}
	{% set sollwerte = {} %}
	    {% set sollwerte = sollwerte|merge({'standard': content[5]~'.standard'}) %}
	    {% set sollwerte = sollwerte|merge({'morning': content[5]~'.morning'}) %}
	{% set sperrwerte = {} %}
	    {% set sperrwerte = sperrwerte|merge({'standard': content[9]~'.standard'}) %}
	    {% set sperrwerte = sperrwerte|merge({'morning': content[9]~'.morning'}) %}

	{% if 'standard' in content %}
	    {% set standard = [['switch', (content[8] == '0') ? 'flip', (not content[8] == '0' and not content[8] == '') ? 'slider', (content[12] == 'sperren') ? 'switch', (content[12] == 'prio') ? 'select'], ['item1.automatik.settings.standard.active', 'icon', [0,1], ['time_automatic.svg','time_automatic.svg']], (content[8] == '0') ? ([sollwerte.standard, '', '', content[6], content[7]]), (not content[8] == '0' and not content[8] == '') ? ([sollwerte.standard, content[6], content[7], content[8], '', 'handle']), (content[12] == 'sperren') ? ([sperrwerte.standard, 'icon', [content[10]|default(0),content[11]|default(1)], ['secur_open.svg','secur_locked.svg']]), (content[12] == 'prio') ? ([sperrwerte.standard, 'icon', [0,2,3], ['control_minus.svg','light_light_dim_00.svg','light_light_dim_90.svg']]) ] %}
	{% endif %}
	{% if 'morning' in content %}
	    {% set morning = [['switch', (content[8] == '0') ? 'flip', (not content[8] == '0' and not content[8] == '') ? 'slider', (content[12] == 'sperren') ? 'switch', (content[12] == 'prio') ? 'select'], ['item1.automatik.settings.morning.active', 'icon', [0,1], ['weather_sunrise.svg','weather_sunrise.svg']], (content[8] == '0') ? ([sollwerte.morning, '', '', content[6], content[7]]), (not content[8] == '0' and not content[8] == '') ? ([sollwerte.morning, content[6], content[7], content[8], '', 'handle']), (content[12] == 'sperren') ? ([sperrwerte.morning, 'icon', [content[10]|default(0),content[11]|default(1)], ['secur_open.svg','secur_locked.svg']]), (content[12] == 'prio') ? ([sperrwerte.morning, 'icon', [0,2,3], ['control_minus.svg','light_light_dim_00.svg','light_light_dim_90.svg']]) ] %}
	{% endif %}

	{% set suspendtext = ['header', 'Suspendzeit'] %}
	{% if content[12] == 'sperren' %}
	    {% set sollwerttext = ['header', 'Sperr- und Sollwerte'] %}
	{% elseif content[12] == 'prio' and not content[8] == '' %}
	    {% set sollwerttext = ['header', 'Soll- und Priowerte'] %}
	{% elseif content[12] == 'prio' and (content[8] == '' or content[8] == '0')%}
	    {% set sollwerttext = ['header', 'Priowerte'] %}
	{% else %}
	    {% set sollwerttext = ['header', 'Sollwerte'] %}
	{% endif %}
	{% set stateengine = stateengine|merge({(itemname): ['stateengine', (suspendtext), (suspend), (sollwerttext), ('standard' in content ) ? (standard), ('morning' in content ) ? (morning),  ('halloween' in content and ('now'|date('m/d')) == ('10/31')) ? (halloween), ('advent' in content and (("now"|date('m/d') > ('12/01') and "now"|date('m/d') < ('12/31')) or ("now"|date('m/d') > ('01/01') and "now"|date('m/d') < ('01/15')))) ? (advent)]}) %}
{% endfor %}

{% endraw %}{% endfilter %}</code>
</div>
<div class="docu_text">
You can implement all the code above in several list widgets that support ext_popup attributes. This attribute should look like this:<br>
</div>
<div class="twig">
	<code class="prettyprint">{% filter trim|escape|nl2br %}{% raw %}
		(stateengine['item1'])
	{% endraw %}{% endfilter %}</code>
	</div>
<div class="docu_text">
&nbsp;</div>
{% endblock %}
