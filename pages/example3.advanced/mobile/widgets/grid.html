/**
 * -----------------------------------------------------------------------------
 * @package     smartVISU - Grid Layout
 * @author      Axel Otterstätter
 * @copyright   2015
 * @license     GPL <http://www.gnu.de>
 * -----------------------------------------------------------------------------
 */

/**
 * Element: Object/Widget as Grid-Button
 *
 * @param unique id for this widget
 * @param title of the element (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a content
*/
{% macro element (id, info, row, col, sizex, sizey, content) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <div id="{{ uid(page, id) }}-mobile" style="width: 100%; height: 100%;">
            {{ content }}
        </div>
    </div>
{% endmacro %}	

/**
 * Pagelink
 *
 * @param unique id for this widget
 * @param popup-info of the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param the pagelink (for example: index.php?page=mobile/eg/room_xyz/index -> without .html!)
 * @param text printed on the button (optional only with icon)
 * @param a icon (optional)
*/
{% macro pagelink (id, info, row, col, sizex, sizey, pagelink, txt, icon) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" href="{{ pagelink }}" data-role="button" class="grid">
            {% if not icon %}
                <p>{{ txt|e }}</p>
            {% elseif icon and txt %}
                <img class="icon icon0" src="{{ icon0 }}{{ icon }}"/>
                <p>{{ txt|e }}</p>
            {% else %}
                <img class="icon single" src="{{ icon0 }}{{ icon }}" />
            {% endif %}
        </a>
    </div>
{% endmacro %}	

/**
 * Pagelink with dynamic status icon
 *
 * @param unique id for this widget
 * @param popup-info of the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param the pagelink (for example: index.php?page=mobile/eg/room_xyz/index -> without .html!)
 * @param text printed on the button (optional)
 * @param the dynamic icon
 * @param a gad/item for switching
 * @param a gad/item for variable value
 * @param the minimum value if the slider is moved to total left (optional, default 0)
 * @param the maximum value if the slider is moved to total right (optional, default 255)
*/
{% macro dynamic_pagelink (id, info, row, col, sizex, sizey, pagelink, txt, dyn_icon, gad_switch, gad_value, min, max) %}
    {% import   "icon.html" as icon %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" href="{{ pagelink }}" data-role="button" class="grid">
            <div class="svg-frame disabled {% if not txt %}single{% endif %}">
                {% if 'arrow' in dyn_icon %}
                    {{ icon.arrow(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'batterie' in dyn_icon %}
                    {{ icon.batterie(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'blade_arc' in dyn_icon %}
                    {{ icon.blade_arc(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'blade_z' in dyn_icon %}
                    {{ icon.blade_z(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'blade' in dyn_icon %}
                    {{ icon.blade(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'clock' in dyn_icon %}
                    {{ icon.clock(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'compass' in dyn_icon %}
                    {{ icon.compass(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'graph' in dyn_icon %}
                    {{ icon.graph(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'meter' in dyn_icon %}
                    {{ icon.meter(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'shutter' in dyn_icon %}
                    {{ icon.shutter(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'windrose' in dyn_icon %}
                    {{ icon.windrose(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'windsock' in dyn_icon %}
                    {{ icon.windsock(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'light' in dyn_icon %}
                    {{ icon.light(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'volume' in dyn_icon %}
                    {{ icon.volume(id~'-icon', gad_switch, gad_value, min, max) }}
                {% endif %}
            </div>
           {% if txt %}
                <p>{{ txt|e }}</p>
           {% endif %}
        </a>
    </div>
{% endmacro %}

/**
 * Pagelink with weather icon
 *
 * @param unique id for this widget
 * @param popup-info of the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param the pagelink (for example: index.php?page=mobile/eg/room_xyz/index -> without .html!)
 * @param text printed on the button (optional only with icon)
 * @param forcast offset: 1 for today, 2 for tomorrow (default), 3 the day after tomorrow ..., (optional, alternativ for text)
*/
{% macro weather_pagelink (id, info, row, col, sizex, sizey, pagelink, txt, offset) %}
	{% set uid = uid(page, id) %}

	{% if once('digiweather') %}
		<link rel="stylesheet" type="text/css" href="lib/weather/jdigiweather.css" />
	{% endif %}

    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" href="{{ pagelink }}" data-role="button" class="grid">
            <img id="{{ page }}-{{ id }}-weatherimg" />
            {% if txt %}
                <p>{{ txt|e }}</p>
            {% else %}
                <p id="{{ page }}-{{ id }}-weather" class="weather highlow">></p>
            {% endif %}
        </a>
    </div>

	<script type="text/javascript">
		$('#{{ page }}').on('pagebeforeshow', function (event, ui) {
			$.getJSON('lib/weather/service/{{ config_weather_service }}.php?location={{ location|default(config_weather_location) }}', function (data) {
				$('#{{ uid }}-weatherimg').attr('src', 'lib/weather/pics/' + data.forecast[{{ offset|default(1) }}].icon + '.png');
                $('#{{ uid }}-weatherimg').css('width', '90%');
                $('#{{ uid }}-weather.highlow').html(data.forecast[{{ offset|default(1) }}].temp);
			})
				.error(notify.json);
		});
	</script>
{% endmacro %}	

/**
 * Shutter
 *
 * @param unique id for this widget
 * @param title of the shutter (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item for the up- and down- movement
 * @param a gad/item for stopping the movement (optional)
 * @param a gad/item for the position of the shutters
 * @param a gad/item to move the shutters to the shade position (optional)
 * @param a gad/item to display the window status (optional) 
 */
{% macro shutter (id, info, row, col, sizex, sizey, gad_move, gad_stop, gad_pos, gad_shade, gad_window, type, hide) %}
	{% import   "basic.html" as basic %}
	{% import   "icon.html" as icon %}
	{% set uid = uid(page, id) %}
	{% set min = 0 %}
	{% set max = 100 %}
	
	<style>
	.pos .ui-slider .ui-input-text {
		display: none !important;
	}
	.pos .ui-slider-track, .pos .ui-slider-switch {
		margin: 0 15px 15px 15px !important;
	}
	</style>
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}-mobile" data-role="button" data-rel="popup" href="#{{ uid }}-popup" class="grid">
            {% if gad_pos %}
                <div class="svg-frame icon1 {% if not info %}single{% endif %}">
                    <svg id="{{ uid }}-svg" data-widget="pic.shutter_window" data-item="{{ gad_pos }}, {{ gad_window }}" data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}"
                        class="icon svg" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100">
                        <g>
                            <rect rx="1" x="15" y="25" width="70" height="4" />
                            <rect x="18" y="28" width="64" height="45" fill="none" />
                            <rect x="49" y="28" width="2" height="45" />
                            <rect x="46" y="50" width="8" height="2" />
                        </g>
                        <g id="{{ uid }}-svg-close" display="inline">
                            <rect x="50" y="50" width="4" height="2" fill="none"/>
                        </g>
                        <g id="{{ uid }}-svg-tilt" display="none">
                            <path style="fill:none; stroke-width:3; fill-opacity: 0;" d="m 53,72 c -1,0 -2,-1 -2,-2 L 47,54 44,40 c 0,-1 1,-2 1,-2 l 27,0 c 1,0 2,1 2,2 l 6,31 c 0,1 -1,2 -1,2" />
                            <rect x="48" y="56" width="4" height="2" />
                        </g>
                        <g id="{{ uid }}-svg-open" display="none">
                            <path style="fill:none; stroke-width:3; fill-opacity: 0;" d="m 82,69 0,1 c 0,1 -1,2 -2,2 l -16,6 c -1,0 -2,0 -2,-1 l 0,-39 c 0,-1 1,-2 2,-2 l 16,-6 c 1,0 2,0 2,1" />
                            <rect x="62" y="55" width="4" height="2" />
                        </g>
                    </svg>
                </div>
             {% else %} 
                {% if gad_window %}
                    <div class="icon {% if not info %}single{% endif %}">
                        {{ basic.symbol(id~'icon_open', gad_window, '', 'fts_window_1w_open.svg', 2, '', 'icon1') }}
                        {{ basic.symbol(id~'icon_tilt', gad_window, '', 'fts_window_1w_tilt.svg', 1, '', 'icon1') }}
                        {{ basic.symbol(id~'icon_close', gad_window, '', 'fts_window_1w.svg', 0) }}                    
                    </div>
                {% else %}
                    <img class="icon {% if not info %}single{% endif %}" src="{{ icon0 }}fts_window_1w.svg" />
                {% endif %}
            {% endif %}
            {% if info %}<p>{{ info|e }}</p>{%endif %}
        </a>
	</div>

    <div id="{{ uid }}-popup" data-role="popup" data-position-to="window">
        <div class="popup-info">
        {% if gad_window %}
            <div class="icon">
                {{ basic.symbol(id~'popup-icon_open', gad_window, '', 'fts_window_1w_open.svg', 2, '', 'icon1') }}
                {{ basic.symbol(id~'popup-icon_tilt', gad_window, '', 'fts_window_1w_tilt.svg', 1, '', 'icon1') }}
                {{ basic.symbol(id~'popup-icon_close', gad_window, '', 'fts_window_1w.svg', 0) }}
            </div>{% endif %}
            <div class="info">{{ info|e }}</div>
        </div>
        <div data-role="controlgroup" data-type="horizontal">
            {{ basic.button(id~'up', gad_move, '', 'control_arrow_up.svg', 0, 'midi') }}
            {{ basic.button(id~'down', gad_move, '', 'control_arrow_down.svg', 1, 'midi') }}
            {% if gad_stop %}{{ basic.button(id~'stop', gad_stop, '', 'audio_stop.svg', 1, 'midi') }}{% endif %}
            {% if gad_shade %}{{ basic.button(id~'shade', gad_shade, '', 'fts_shutter_50.svg', 1, 'midi') }}{% endif %}
        </div>
        {% if gad_pos %}<div class="pos">{{ basic.slider(id~'slider', gad_pos, 0 , 100 , 5 ) }}</div>{% endif %}
        <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
    </div>
{% endmacro %}

/**
 * Dynamic
 *
 * @param unique id for this widget
 * @param title of the dimmer (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param the dynamic icon
 * @param a gad/item for switching
 * @param a gad/item for a variable value
 * @param the minimum value if the slider is moved to total left (optional, default 0)
 * @param the maximum value if the slider is moved to total right (optional, default 255)
 * @param step between two values (optional, default 5)
 * @param readonly mode (default false)
 */
{% macro dynamic (id, info, row, col, sizex, sizey, dyn_icon, gad_switch, gad_value, min, max, step, read_only) %}
	{% import   "basic.html" as basic %}
    {% import   "icon.html" as icon %}
	{% set uid = uid(page, id) %}
    <div data-row="{{ row }}" data-widget="grid.dynamic" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}" data-role="button" {% if not read_only %} data-rel="popup" href="#{{ uid }}-popup" {% endif %} class="grid">
            <div class="svg-frame disabled {% if not info %}single{% endif %}">
                {% if 'arrow' in dyn_icon %}
                    {{ icon.arrow(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'batterie' in dyn_icon %}
                    {{ icon.batterie(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'blade_arc' in dyn_icon %}
                    {{ icon.blade_arc(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'blade_z' in dyn_icon %}
                    {{ icon.blade_z(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'blade' in dyn_icon %}
                    {{ icon.blade(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'clock' in dyn_icon %}
                    {{ icon.clock(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'compass' in dyn_icon %}
                    {{ icon.compass(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'graph' in dyn_icon %}
                    {{ icon.graph(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'meter' in dyn_icon %}
                    {{ icon.meter(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'shutter' in dyn_icon %}
                    {{ icon.shutter(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'windrose' in dyn_icon %}
                    {{ icon.windrose(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'windsock' in dyn_icon %}
                    {{ icon.windsock(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'light' in dyn_icon %}
                    {{ icon.light(id~'-icon', gad_switch, gad_value, min, max) }}
                {% elseif 'volume' in dyn_icon %}
                    {{ icon.volume(id~'-icon', gad_switch, gad_value, min, max) }}
                {% endif %}
            </div>
            {% if info %}<p>{{ info|e }}</p>{% endif %}
        </a>
    </div>
    <div id="{{ uid }}-popup" data-role="popup" style="min-width: 250px;" data-position-to="window">
        <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
		<div class="popup-info">
            <div class="info" style="float: none;">
                {{ info|e }}
            </div>
            <div class="dimmer">
                <div style="float: left;">
                    {% if 'arrow' in dyn_icon %}
                        {{ icon.arrow(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'batterie' in dyn_icon %}
                        {{ icon.batterie(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'blade' in dyn_icon %}
                        {{ icon.blade(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'blade_arc' in dyn_icon %}
                        {{ icon.blade_arc(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'blade_z' in dyn_icon %}
                        {{ icon.blade_z(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'clock' in dyn_icon %}
                        {{ icon.clock(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'compass' in dyn_icon %}
                        {{ icon.compass(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'graph' in dyn_icon %}
                        {{ icon.graph(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'meter' in dyn_icon %}
                        {{ icon.meter(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'shutter' in dyn_icon %}
                        {{ icon.shutter(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'windrose' in dyn_icon %}
                        {{ icon.windrose(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'windsock' in dyn_icon %}
                        {{ icon.windsock(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'light' in dyn_icon %}
                        {{ icon.light(id~'-icon2', gad_switch, gad_value, min, max) }}
                    {% elseif 'volume' in dyn_icon %}
                        {{ icon.volume(id~'-icon', gad_switch, gad_value, min, max) }}
                    {% endif %}
                </div><div>
                    {{ basic.slider(id~'-slider', gad_value, min, max, step) }}                
                </div>
            </div>
        </div>
    </div>    
{% endmacro %}

/**
 * Button
 *
 * @param unique id for this widget
 * @param popup and info on the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item
 * @param a icon
 * @param value send if the button is pressed (optional, default 1)
*/
{% macro button (id, info, row, col, sizex, sizey, gad, icon, val) %} 
	{% import   "basic.html" as basic %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-widget="basic.button" data-role="button" data-item="{{ gad }}" data-val="{{ val|default('1') }}" class="grid">
            <img class="icon {% if not info %}single{% endif %}" src="{{ icon0 }}{{ icon }}" />
            {% if info %}<p>{{ info|e }}</p>{% endif %}
        </a>
	</div>
{% endmacro %}	

/**
 * Button with png
 *
 * @param unique id for this widget
 * @param popup and info on the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item
 * @param a icon
 * @param a text (optional)
 * @param value send if the button is pressed (optional, default 1)
*/
{% macro png_button (id, info, row, col, sizex, sizey, gad, icon, txt, val) %} 
	{% import   "basic.html" as basic %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-widget="basic.button" data-role="button" data-item="{{ gad }}" data-val="{{ val|default('1') }}" class="grid">
            <img class="icon {% if not info %}single{% endif %}" src="{{ icon }}" />
            {% if txt %}<p>{{ txt|e }}</p>{% endif %}
        </a>
	</div>
{% endmacro %}	

/**
 * Dual 
 *
 * @param unique id for this widget
 * @param popup-info of the dual button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param icon position from left side
 * @param icon position from top side
 * @param a gad/item
 * @param the pic for the 'on' state (optional)
 * @param the pic for the 'off' state (optional)
 * @param value send for the 'on' state (optional, default 1)
 * @param value send for the 'off' state (optional, default 0)
*/
{% macro dual (id, info, row, col, sizex, sizey, gad, pic_on, pic_off, val_on, val_off) %} 
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}" data-widget="grid.dual" data-item="{{ gad }}"
            data-val-on="{{ val_on|default('1') }}" data-val-off="{{ val_off|default('0') }}"
            data-icon-on="{{ icon0 }}{{ pic_on|default('control_on_off.svg') }}" data-icon-off="{{ icon0 }}{{ pic_off|default('control_on_off.svg') }}"
            data-role="button" class="grid">
                <div class="svg-frame icon0">
                    <img class="icon {% if not info %}single{% endif %}" src="{{ icon0 }}{{ pic_off|default('control_on_off.svg') }}" />
                </div>
                <div class="svg-frame icon1 hide">
                    <img class="icon icon1 {% if not info %}single{% endif %}" src="{{ icon0 }}{{ pic_on|default('control_on_off.svg') }}" />      
                </div>
            {% if info %}<p>{{ info|e }}</p>{% endif %}
        </a>
    </div>

{% endmacro %}	

/**
 * Displays a rgb-selector
 *
 * @param unique id for this widget
 * @param popup-info of the rgb-selector (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item for on/off switching
 * @param text for the 'on' state (optional, default 'On')
 * @param text for the 'off' state (optional, default 'Off')
 * @param a gad/item for the r - value (0-255)
 * @param a gad/item for the g - value (0-255)
 * @param a gad/item for the b - value (0-255)
 * @param the minimum value if the light is off (optional, for future use)
 * @param the maximum value if the light is full on (optional, default 255)
 * @param the granularity of the rings (optional, default 8)
 * @param the number of colored segments (optional, default 10)
*/
{% macro rgb (id, info, row, col, sizex, sizey, gad, txt_on, txt_off, gad_r, gad_g, gad_b, min, max, step, colors, type, hide) %}
	{% set uid = uid(page, id) %}
	<div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}" class="grid" data-widget="grid.rgb" data-item="{{ gad_r }}, {{ gad_g }}, {{ gad_b }}"
            data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}"
            href="#{{ uid }}-popup" data-rel="popup" data-role="button">
            <div class="svg-frame">
                <object class="icon icon-rgb {% if not info %}single{% endif %}" data="{{ icon0 }}light_rgb.svg" type="image/svg+xml"></object>
            </div>
            {% if info %}<p>{{ info|e }}</p>{% endif %}
        </a>
    </div>
    
	<div id="{{ uid }}-popup" data-widget="grid.rgb-popup" data-item="{{ gad_r }}, {{ gad_g }}, {{ gad_b }}"
        {% import "basic.html" as basic %}
		data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}"
		 data-role="popup" data-overlay-theme="a" data-position-to="window">
		<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
		<div>
			<span>{{ basic.flip("{{ id }}-flip", gad, txt_on, txt_off) }}</span>{% if info %}<span> {{ info }} </span>{% endif %}
		</div>
		<div>&nbsp;</div>
		<div id="{{ uid }}-chooser" class="rgb-popup" style="width: 100%;"></div>
		<script type="text/javascript">
			var html = '';

			var colors = {{ colors|default(10) }};
			var share = 360 / colors;

			for (var s = 25; s <= 75; s += 25) {
				for (var i = 0; i < colors; i++) {
					html += '<div style="background-color:' + fx.hsv2rgb(i * share, s, 100) + ';"></div>';
				}
				html += '<div style="background-color:' + fx.hsv2rgb(i * share, 0, 100 - (s / 25 - 1) * 16.7) + ';"></div><br />';
			}
			for (var v = 100; v >= 25; v -= 25) {
				for (var i = 0; i < colors; i++) {
					html += '<div style="background-color:' + fx.hsv2rgb(i * share, 100, v) + ';"></div>';
				}
				html += '<div style="background-color:' + fx.hsv2rgb(i * share, 0, (v / 25 - 1) * 16.7) + ';"></div><br />';
			}

			$("#{{ uid }}-chooser").html(html);
		</script>
	</div>
{% endmacro %}	

/**
 * Displays a colordisc-rgb-selector
 *
 * @param unique id for this widget
 * @param popup-info of the colordisc (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item for on/off switching
 * @param text for the 'on' state (optional, default 'On')
 * @param text for the 'off' state (optional, default 'Off')
 * @param a gad/item for the r - value (0-255)
 * @param a gad/item for the g - value (0-255)
 * @param a gad/item for the b - value (0-255)
 * @param the minimum value if the light is off (optional, for future use)
 * @param the maximum value if the light is full on (optional, default 255)
 * @param the granularity of the rings (optional, default 8)
 * @param the number of colored segments (optional, default 10)
*/
{% macro colordisc (id, info, row, col, sizex, sizey, gad, txt_on, txt_off, gad_r, gad_g, gad_b, min, max, step, colors, type, hide) %}
	{% set uid = uid(page, id) %}
	{% import   "basic.html" as basic %}
	<div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}" class="grid" data-widget="grid.rgb" data-item="{{ gad_r }}, {{ gad_g }}, {{ gad_b }}"
            data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}"
            href="#{{ uid }}-popup" data-rel="popup" data-role="button">
            <div class="svg-frame">
                <object class="icon icon-rgb {% if not info %}single{% endif %}" data="{{ icon0 }}light_rgb.svg" type="image/svg+xml"></object>
            </div>
            {% if info %}<p>{{ info|e }}</p>{% endif %}
        </a>
    </div>	
	<div id="{{ uid }}-popup" data-role="popup" class="ui-content"  style="min-width: 280px; min-height: 280px;" data-position-to="window">
		<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
		<div>
			<span>{{ basic.flip("{{ id }}-flip", gad, txt_on, txt_off) }}</span>{% if info %}<span> {{ info }} </span>{% endif %}
		</div>

		<canvas id="{{ uid }}-disc" data-widget="basic.colordisc-popup"
			data-step="{{ step|default(8) }}" data-colors="{{ colors|default(10) }}">
		</canvas>
		
	</div>
	
	<script type="text/javascript">
		var colors = parseFloat($('#{{ uid }}-disc').attr('data-colors'));
		var size = 280;
		var canvas = $('#{{ uid }}-disc')[0];
		var step = 100 / ($('#{{ uid }}-disc').attr('data-step') / 2);

		var arc = Math.PI / (colors + 2) * 2;
		var startangle = -(Math.PI / 2) + arc;
		var gauge = (size - 10) / 16 / ($('#{{ uid }}-disc').attr('data-step') / 8);
		var share = 360 / colors;
		var ctx;

		canvas.width = size;
		canvas.height = size;

		if (canvas.getContext) {
			var center = size / 2 - 1;
			ctx = canvas.getContext("2d");

			// draw background
			ctx.beginPath();
			ctx.fillStyle = '#888';
			ctx.shadowColor = 'rgba(96,96,96,0.4)';
			ctx.shadowOffsetX = 2;
			ctx.shadowOffsetY = 2;
			ctx.shadowBlur = 4;
			ctx.arc(center, center, size / 2 - 1, 0, 2 * Math.PI, false);
			ctx.fill();
			ctx.beginPath();
			ctx.shadowOffsetX = 0;
			ctx.shadowOffsetY = 0;
			ctx.shadowBlur = 0;
			ctx.fillStyle = '#555';
			ctx.arc(center, center, size / 2 - 2, 0, 2 * Math.PI, false);
			ctx.fill();

			// draw colors
			var v, s;

			for (var i = 0; i <= colors; i++) {
				var angle = startangle + i * arc;
				var ring = 1;
				var h = i * share;
				for (v = step; v <= 100; v += step) {
					ctx.beginPath();
					ctx.fillStyle = fx.hsv2rgb(h, 100, v);
					ctx.arc(center, center, ring * gauge + gauge + 1, angle, angle + arc + 0.01, false);
					ctx.arc(center, center, ring * gauge, angle + arc + 0.01, angle, true);
					ctx.fill();
					ring += 1;
				}
				for (s = (100 - step); s >= step; s -= step) {
					ctx.beginPath();
					ctx.fillStyle = fx.hsv2rgb(h, s, 100);
					ctx.arc(center, center, ring * gauge + gauge + 1, angle, angle + arc + 0.01, false);
					ctx.arc(center, center, ring * gauge, angle + arc + 0.01, angle, true);
					ctx.fill();
					ring += 1;
				}
			}

			// draw grey
			i -= 1;
			angle = startangle + i * arc;
			ring = 1;
			h = i * share;
			for (v = step; v <= 100; v += (step / 2)) {
				ctx.beginPath();
				ctx.fillStyle = fx.hsv2rgb(h, 0, v);
				ctx.arc(center, center, ring * gauge + gauge + 1, angle, angle + 2 * arc + 0.01, false);
				ctx.arc(center, center, ring * gauge, angle + 2 * arc + 0.01, angle, true);
				ctx.fill();
				ring += 1;
			}

			// draw center
			ctx.beginPath();
			ctx.fillStyle = 'rgb(0,0,0)';
			ctx.arc(center, center, gauge + 1, 0, 2 * Math.PI, false);
			ctx.fill();
		}

	$(document).delegate('canvas[data-widget="basic.colordisc-popup"]', {
			'click': function (event) {
				var uid = this.id.substr(0, this.id.length - 5);
				var disc = $(this)[0];
				var ctx = disc.getContext("2d");

				var offset = $(this).offset();
				var x = Math.round(event.pageX - offset.left);
				var y = Math.round(event.pageY - offset.top);
				var rgb = ctx.getImageData(x, y, 1, 1).data;
				// DEBUG: console.log([rgb[0], rgb[1], rgb[2]]);

				var max = $('#' + uid).attr('data-max');
				var items = $('#' + uid).attr('data-item').explode();

				io.write(items[0], Math.round(rgb[0] / 255 * max));
				io.write(items[1], Math.round(rgb[1] / 255 * max));
				io.write(items[2], Math.round(rgb[2] / 255 * max));

				// $(this).hide();

				//$('#' + uid + '-screen').removeClass('in').addClass('hide');
			}
		});
	</script>
{% endmacro %}	

/**
 * A symbol, with no writing to knx, only displayed when the value of gad is equal to val. Symbols may be used in menus.
 * If more than one gad is given, they will be combined with mode ('or' / 'and).
 *
 * @param unique id for this widget
 * @param popup-info (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param one or more gad(s)/item(s). More gads/items in array form: [ item1 , item2 ]
 * @param the text, printed when gad has value val (optional)
 * @param the pic, shown when gad has value val
 * @param value (default 1)
*/
{% macro symbol(id, info, row, col, sizex, sizey, items, txt, icon, val) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-widget="grid.symbol" data-item="{{ implode(items) }}" data-val="{{ val|default('1') }}" data-role="button"
              data-mode="{{ mode|default('or') }}" class="ui-off symbol grid disabled" {% if info %}title="{{ info }}"{% endif %}>
            <img class="icon" src="{{ icon0 }}{{ icon|default('control_on_off.svg') }}" />
            {% if txt %}
                <p>{{ txt }}</p>
            {% else %}
                <p>{{ info }}</p>
            {% endif %}
        </a>
    </div>
{% endmacro %}

/**
 * Number: Displays a number
 *
 * @param unique id for this widget
 * @param popup-info of the float value (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item
 * @param value min
 * @param value max
 * @param a unit, tries to get the format for that unit from the language-file (optional)
 * @param an icon (optional)
*/
{% macro number (id, info, row, col, sizex, sizey, gad, min, max, unit, icon) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-role="button" data-rel="popup" href="#{{ uid(page, id)}}-popup" class="grid">
            {% if icon %}
                <img class="icon" src="{{ icon0 }}{{ icon }}"/>
                <p id="{{ uid(page, id) }}" data-widget="grid.number" data-item="{{ gad }}" data-unit="{{ unit }}">-.- {{ unit }}</p>
            {% else %}
                <span class="centered">
                    <p id="{{ uid(page, id) }}" data-widget="grid.number" data-item="{{ gad }}" data-unit="{{ unit }}">-.- {{ unit }}</p>                
                </span>
            {% endif %}
           
        </a>
    </div>
	<div id="{{ uid(page, id)}}-popup" data-role="popup"  data-overlay-theme="a" class="ui-content" style="min-width: 300px; min-height: 110px;" data-position-to="window">
        <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
        {% if info %}<p>{{ info }}</p>{% endif %}
        <div data-role="stepper" data-direction="vertical">  
            <input type="text" data-item="{{ gad }}" data-widget="grid.number-step" id="{{ uid(page, id) }}-spin" value="{{min}}" data-options='{"type":"horizontal"}' min="{{min}}" max="{{max}}" class="quantity" size="2" data-role="none"/>
        </div>
       
    </div>

{% endmacro %}

/**
 * Float: Displays a value as float
 *
 * @param unique id for this widget
 * @param popup-info of the float value (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item
 * @param a unit, tries to get the format for that unit from the language-file (optional)
 * @param an icon (optional)
*/
{% macro float (id, info, row, col, sizex, sizey, gad, unit, icon) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-role="button" class="ui-off grid">
            {% if icon %}
                <img class="icon" src="{{ icon0 }}{{ icon }}"/>
                <p id="{{ uid(page, id) }}" data-widget="basic.float" data-item="{{ gad }}" data-unit="{{ unit }}">-.- {{ unit }}</p>
            {% else %}
                <span class="centered">
                    <p id="{{ uid(page, id) }}" class="centered" data-widget="basic.float" data-item="{{ gad }}" data-unit="{{ unit }}">-.- {{ unit }}</p>
                </span> 
            {% endif %}
           
        </a>
    </div>
{% endmacro %}

/**
 * Value: Displays a value
 *
 * @param unique id for this widget
 * @param popup-info of the float value (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a gad/item
 * @param a text (optional)
 * @param a unit (optional)
 * @param an icon (optional)
*/
{% macro value (id, info, row, col, sizex, sizey, gad, txt, unit, icon) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-role="button" class="ui-off grid">
            {% if icon %}
                <img class="icon" src="{{ icon0 }}{{ icon }}"/>
                <p id="{{ uid(page, id) }}-value" data-widget="basic.value" data-item="{{ gad }}" data-unit="{{ unit }}"> --- {{ unit }}</p>
            {% else %}
                <span class="centered">
                    {% if txt %}
                        <span>{{ txt }}</span>
                    {% endif %}
                    <p id="{{ uid(page, id) }}-value" data-widget="basic.value" data-item="{{ gad }}" data-unit="{{ unit }}"> --- {{ unit }}</p>                                        
                </span>
            {% endif %}          
        </a>
    </div>
{% endmacro %}

/**
 * Float_popup: Displays a value as float and a popup with details
 * 
 *
 * @param unique id for this widget
 * @param popup-info of the float value (optional)
 * @param size x
 * @param size y
 * @param a gad/item
 * @param unit
 * @param icon
 * @param series of gad/item/s for plot. More item/s in array form: [ item1 , item2 ]
 * @param the mode: 'avg', 'sum', 'min', 'max'
 * @param the minimum time (x-axis): '1h', '2h'... (duration-format)
 * @param the maximum time (x-axis): '', '1h', '2h'... (duration-format, default: now)
 * @param the minimum y-axis (optional)
 * @param the maximum y-axis (optional)
 * @param the step between two time-points (optional, only for 'offline'-driver)
 * @param label/s for each series (optional)
 * @param color/s for each series e. g. '#f00' for red (optional, default: sutiable for design)
 * @param type/s for each series: 'line', 'stair', 'spline', 'area', 'areaspline', 'column' (optional, default 'line')
 * @param title/s for the x-axis and y-axis
 * @param minimum time while zooming in sec (optional, duration-format)
 * @param display plot-options (optional)
 *
 * @see misc/fundamentals#Array-Form
 * @see misc/fundamentals#Duration-Format

*/
{% macro float_popup (id, info, row, col, sizex, sizey, gad, unit, icon, gad_plot, mode, tmin, tmax, ymin, ymax, step, label, color, exposure, axes, zoom, options) %}
 {% import "basic.html" as basic %}
 {% import "plot.html" as plot %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" data-rel="popup" href="#{{ uid(page, id)}}-popup"
           style="display: block; text-align: center; " data-role="button" class="grid">
            {% if icon %}
                <img class="icon" src="{{ icon0 }}{{ icon }}"/>
                <p id="{{ uid(page, id) }}" data-widget="basic.float" data-item="{{ gad }}" data-unit="{{ unit }}">-.- {{ unit }}</p>
            {% else %}
                <span class="centered">
                    <p id="{{ uid(page, id) }}" data-widget="basic.float" data-item="{{ gad }}" data-unit="{{ unit }}">-.- {{ unit }}</p>
                </span>
            {% endif %}
           
        </a>
    </div>
	<div id="{{ uid(page, id)}}-popup" data-tmin="{{tmin}}" data-tmax="{{tmax}}" data-role="popup" data-overlay-theme="a" class="ui-content" style="min-width: 400px; min-height: 210px;" data-position-to="window">
		
        <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
        <div id="{{ uid(page, id) }}-plot" data-widget="plot.period" data-item="" data-itemsoll="{{ implode(gad_plot, [mode|default('avg'), tmin|default('1h'), tmax|default('0h')]) }}"
            {% if ymin is not empty %} data-ymin="{{ ymin }}" {% endif %} {% if ymax is not empty %} data-ymax="{{ ymax }}" {% endif %}
            data-step="{{ step|default(20) }}" data-label="{{ implode(label) }}"
            data-color="{{ implode(color) }}" data-exposure="{{ implode(exposure) }}" data-axis="{{ implode(axes) }}"
            {% if zoom is not empty %} data-zoom="{{ zoom }}" {% endif %}
            class="plot">
        </div>
        {% if options %}
            <div class="ui-grid-c">
                <div class="ui-block-a popup"><div class="ui-bar ui-bar-a" >tmin:</div></div>
                <div class="ui-block-b popup"><div class="ui-bar ui-bar-a" >tmax:</div></div>
                <div class="ui-block-c popup"><div class="ui-bar ui-bar-a" >mode:</div></div>
                <div class="ui-block-d"><div class="ui-bar ui-bar-a" ></div></div>
                <div class="ui-block-a popup"><div class="ui-bar ui-bar-a" ><input name="tmin" id="{{ uid(page, id)}}-tmin" value="" type="text" data-mini="true" ></div></div>
                <div class="ui-block-b popup"><div class="ui-bar ui-bar-a" ><input name="tmax" id="{{ uid(page, id)}}-tmax" value="" type="text" data-mini="true" ></div></div>
                <div class="ui-block-c popup"><div class="ui-bar ui-bar-a" ><input name="mode" id="{{ uid(page, id)}}-mode" value="" type="text" data-mini="true" ></div></div>
                /**<div class="ui-block-d popup"><div class="ui-bar ui-bar-a" ><input name="item" id="{{ uid(page, id)}}-item" value="" type="text" data-mini="true" ></div></div>*/
                /**<div class="ui-block-d popup"><div class="ui-bar ui-bar-a" ><button id='plot_popup_re' data-mini='true' data-icon="refresh">Resize</button></div></div>*/
                <div class="ui-block-d popup"><div class="ui-bar ui-bar-a" > <a id='popup_plotevent' data-role="button" data-mini='true' data-icon="refresh">Resize</a></div></div>
            </div>
        {% endif %}
 	</div>
	<script type="text/javascript">
		$(document).on('click', 'a#popup_plotevent', function () {
		});

		/** Event nach dem öffnen des Popups */
		$("#{{ uid(page, id) }}-popup").on("popupafteropen", function(e)
		{
			/** holen und vergleichen der Data-items */
			var itemssoll = widget.explode($("#{{ uid(page, id)}}-plot").attr('data-itemsoll'));
			var items = widget.explode($("#{{ uid(page, id)}}-plot").attr('data-item'));
			
			/** beim ersten Start ist das "Data-Item" vom Plot noch leer 
				daher mit dem Sollitem füllen und Daten holen */
			if(items == "")
			{
				$("#{{ uid(page, id)}}-plot").attr('data-item',itemssoll);
				$("#{{ uid(page, id)}}-plot").highcharts().destroy();
				io.monitor(); /** mach automatisch einen Update der neuen Daten */
				items = itemssoll;
			}
			else
			{
				/** Update der Plotdaten triggern, wird beim Chrome benötigt */ 
				plotRefresh(items);
			}
			
			/** Items zerlegen für die Anzeige */
			for (var i = 0; i < items.length; i++) 
			{
				var pt = items[i].split('.');
				var item = items[i].substr(0, items[i].length - 3 - pt[pt.length - 3].length - pt[pt.length - 2].length - pt[pt.length - 1].length);
		
			}
            $("#{{ uid(page, id)}}-tmin").val(pt[pt.length - 1]);
            $("#{{ uid(page, id)}}-tmax").val(pt[pt.length - 2]);
            $("#{{ uid(page, id)}}-mode").val(pt[pt.length - 3]);
		});
		
		/** Event nach dem schliessen des Popups */
		$("#{{ uid(page, id) }}-popup").on("popupafterclose", function(e)
		{
			
			var items = Array();
			items = widget.explode($("#{{ uid(page, id)}}-plot").attr('data-item'));
			var data = Array();
			
			
			for (var i = 0; i < items.length; i++) {

				var pt = items[i].split('.');
				var item = items[i].substr(0, items[i].length - 3 - pt[pt.length - 3].length - pt[pt.length - 2].length - pt[pt.length - 1].length);
				data[i] = item + "." + $("#{{ uid(page, id)}}-mode").val() + "." + $("#{{ uid(page, id)}}-tmax").val() + "." + $("#{{ uid(page, id)}}-tmin").val();
				
			}		
			
			/** Wurde etwas geändert, z.B. Startzeit der Daten ? */
			if(!arrays_equal(data,items))
			{
				var save = data.toString();
				/** Speichern des neuen "Data-item" Inhaltes */
				$("#{{ uid(page, id)}}-plot").attr('data-item',(save));
				/**widget.prepare();*/
				$("#{{ uid(page, id)}}-plot").highcharts().destroy();
				/** widget.refresh();*/
				io.monitor();
			}
		});
		
		var plotRefresh = function (items){
				var values = widget.get(items);
				$("#{{ uid(page, id)}}-plot").trigger('update', [values]);
		}
		
		function arrays_equal(a,b) { 
            return !!a && !!b && !(a<b || b<a); 
        }
	</script>
{% endmacro %}

/**
 * Camera
 *
 * @param unique id for this widget
 * @param title of the camera (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param stream url
 * @param picture or mjpeg url (optional)
 * @param video width (not used)
 * @param video height (not used)
 */
{% macro camera (id, info, row, col, sizex, sizey, stream, picture, width, height) %}
	{% import   "basic.html" as basic %}
	{% set uid = uid(page, id) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}-mobile" data-role="button" data-widget="basic.button" class="grid camera_button" href="{{ stream }}" >
               {% if picture and info %}
                    <img class="pic" src="{{ picture }}" />
                    <p>{{ info|e }}</p>
               {% elseif picture %}
                    <img class="pic src="{{ picture }}" />
               {% elseif info %}
                    <img class="icon" src="{{ icon0 }}it_camera.svg" />
                    <p>{{ info|e }}</p>
               {% else %}
                    <img class="icon src="{{ icon0 }}it_camera.svg" />
               {% endif %}
        </a>
    </div>
    <!-- Not used 
    <div id="{{ uid }}-popup" data-role="popup" class="ui-content" style="min-width: 50px; min-height: 30px;" data-position-to="window">
        <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
		{% if info %}<div> {{ info }} </div>{% endif %}
		<embed id="{{ uid }}-vlc" {% if txt %}title="{{ info }}"{% endif %} type="application/x-google-vlc-plugin" version="VideoLAN.VLCPlugin.2" 
			   autoplay="yes" loop="no" controls="no" branding="no" style="width: {{ width }}; height: {{ height }};"
			   target="{{ stream }}" text="{{ info }}" {% if txt %}title="{{ info }}"{% endif %}>
		</embed>
    </div>    
	<script type="text/javascript">
		$(document).on("pageshow",function() {
			if ( isVLCInstalled() === true ) {
				$("#{{ uid }}-mobile").attr("href", "#{{ uid }}-popup");
			} else {
				$("#{{ uid }}-mobile").attr("href", "{{ stream }}");
			}							

			function isVLCInstalled() {
				var name = "VLC";
				if (navigator.plugins.length > 0) {
					for(var i=0; i<navigator.plugins.length; ++i)
						if (navigator.plugins[i].name.indexOf(name) != -1) 
						  return true;
				}
				else {
					try {
						new ActiveXObject("VideoLAN.VLCPlugin.2");
						return true;
					} catch (err) {}
				}
				return false;
			}
		});
	</script>-->
{% endmacro %}

/**
 * url: Popup with a external page
 *
 * @param unique id for this widget
 * @param popup-info of the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param the url to open in a popup (for example: http://www.google.de)
 * @param a icon (optional)
 * @param width of the popup
 * @param height of the popup
*/
{% macro url (id, info, row, col, sizex, sizey, url, icon, width, height) %} 
	{% set uid = uid(page, id) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}-mobile" href="#{{ uid }}-popup" class="grid" style="display: block;" data-role="button" data-rel="popup" data-position-to="window">
            {% if not icon %}
                <span class="centered">
                    <p>{{ info|e }}</p>
                </span>
            {% elseif info %}
                <img class="icon" src="{{ icon0 }}{{ icon }}" />
                <p>{{ info|e }}</p>
            {% else %}
                <img class="icon single" src="{{ icon0 }}{{ icon }}" />
            {% endif %}
        </a>	
    </div>
	<div data-role="popup" id="{{ uid }}-popup" data-position-to="window"> 
		<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>
		{% if info %}<div> {{ info }} </div>{% endif %}
		<iframe src="{{ url }}" width="{{ width }}" height="{{ height }}" seamless></iframe>
	</div>
{% endmacro %}	


/**
 * scene: Select a scene
 *
 * @param unique id for this widget
 * @param text printed on the button (optional)
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param a item
 * @param a icon (optional)
 * @param array for labels
 * @param array for values to send (same order as labels)
*/


{% macro scene (id, info, row, col, sizex, sizey, gad, icon, labels, values) %} 
	{% set uid = uid(page, id) %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}-mobile" href="#{{ uid }}-popup" data-widget="mobile.scene" data-value="{{ implode(values) }}" data-label="{{ implode(labels) }}"
		   style="display: block;" data-role="button" data-rel="popup" class="grid">
            {% if not icon %}
                <span class="centered">
                    <p>{{ info|e }}</p>
                </span>
            {% elseif info %}
				<img class="icon" src="{{ icon0 }}{{ icon }}" />
				<p>{{ info|e }}</p>
            {% else %}
				<img class="icon single" src="{{ icon0 }}{{ icon }}" />
            {% endif %}
        </a>	
    </div>
	<div data-role="popup" id="{{ uid }}-popup" class="ui-content" style="min-width: 50px; min-height: 20px;" data-position-to="window"> 
		<!-- <a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Schließen</a>-->
		<div id="{{ uid }}-group" data-role="controlgroup" data-type="horizontal"></div>
        <script type="text/javascript">
            $(document).on("pagebeforecreate",function(){
                var value = $("#{{ uid }}-mobile").attr('data-value').explode();
                var label = $("#{{ uid }}-mobile").attr('data-label').explode();
                for(var i=0; i<value.length; ++i) {
                    if ( $("#{{ uid }}-button"+value[i]).length === 0) {
                        //alert("Array Nr.: "+i+" Value: "+value[i]+" Label: "+label[i]);
                        $("#{{ uid }}-group").append('<a id="{{ uid }}-button'+value[i]+'" data-role="button" popupid="{{ uid }}-popup" data-widget="mobile.scene-button" data-iconpos="nopic" class="ui-mini" data-iconpos="nopic" data-item="{{ gad }}" data-val="'+value[i]+'">'+label[i]+'</a>');
                    }
                }
            });
            
            $(document).delegate('a[data-widget="mobile.scene-button"]', {
                'click': function (event) {
                    if ($(this).attr('data-val') != '') {
                        io.write($(this).attr('data-item'), $(this).attr('data-val'));
                    }
                    $( "#"+$(this).attr('popupid') ).popup( "close" )
                }
            });
        </script>
    </div>
{% endmacro %}	

/**
 * period: Display a plot as period in a grid-element
 *
 * @param unique id for this popup-widget
 * @param text as title
 * @param icon row
 * @param icon col
 * @param size x
 * @param size y
 * @param series of item/s. More item/s in array form: [ item1 , item2 ]
 * @param the mode: 'avg', 'sum', 'min', 'max'
 * @param the minimum time (x-axis): '1h', '2h'... (duration-format)
 * @param the maximum time (x-axis): '', '1h', '2h'... (duration-format, default: now)
 * @param the minimum y-axis (optional)
 * @param the maximum y-axis (optional)
 * @param the step between two time-points (optional, only for 'offline'-driver)
 * @param label/s for each series (optional)
 * @param color/s for each series e. g. '#f00' for red (optional, default: sutiable for design)
 * @param type/s for each series: 'line', 'stair', 'spline', 'area', 'areaspline', 'column' (optional, default 'line')
 * @param title/s for the x-axis and y-axis
 * @param minimum time while zooming in sec (optional, duration-format)
 *
 * @see misc/fundamentals#Array-Form
 * @see misc/fundamentals#Duration-Format
*/
{% macro plot_period (id, info, row, col, sizex, sizey, gad, mode, tmin, tmax, ymin, ymax, step, label, color, exposure, axes, zoom) %}
	<div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex }}" data-sizey="{{ sizey }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid }}-mobile" style="display: block;" data-role="button" class="grid">
            <div id="{{ uid(page, id) }}-plot" data-widget="plot.period" data-item="{{ implode(gad, [mode|default('avg'), tmin|default('1h'), tmax|default('0')]) }}"
                {% if ymin is not empty %} data-ymin="{{ ymin }}" {% endif %} {% if ymax is not empty %} data-ymax="{{ ymax }}" {% endif %}
                data-step="{{ step|default(20) }}" data-label="{{ implode(label) }}"
                data-color="{{ implode(color) }}" data-exposure="{{ implode(exposure) }}" data-axis="{{ implode(axes) }}"
                {% if zoom is not empty %} data-zoom="{{ zoom }}" {% endif %} class="plot">
            </div>
        </a>
	</div>
{% endmacro %}


/**
 * Displays the actual weather at location
 *
 * @param unique id for this widget
 * @param text as title
 * @param icon row
 * @param icon col
 * @param size x (optional, default 2)
 * @param size y (optional, default 4)
 * @param location as string (optional)
 *
 * @info based on jDigiClock by Radoslav Dimov
 * @link http://www.radoslavdimov.com
*/
{% macro weather_current(id, info, row, col, sizex, sizey, location) %}
	{% set uid = uid(page, id) %}

	{% if once('digiweather') %}
		<link rel="stylesheet" type="text/css" href="lib/weather/jdigiweather.css" />
	{% endif %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex|default(2) }}" data-sizey="{{ sizey|default(4) }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" href="{{ pagelink }}" data-role="button" class="grid weather">
            {% if info %}
                <div class="info">{{ info }}</div>
            {% endif %}
            <img id="{{ page }}-{{ id }}-weatherimg" class="weather" />
            <div id="{{ page }}-{{ id }}-weather" class="weather">
                <div class="values">
                    <div class="temp"></div>
                    <div class="cond"></div>                
                    <div class="wind"></div>
                    <div class="humi"></div>
                    {% if location %}
                    <div class="city"></div>
                    {% endif %}
                </div>
            </div>
        </a>
    </div>

	<script type="text/javascript">
		$('#{{ page }}').on('pagebeforeshow', function (event, ui) {
			$.getJSON('lib/weather/service/{{ config_weather_service }}.php?location={{ location|default(config_weather_location) }}', function (data) {
				$('#{{ uid }}-weatherimg').attr('src', 'lib/weather/pics/' + data.current.icon + '.png')
				$('#{{ uid }}-weather .temp').html(data.current.temp);
				$('#{{ uid }}-weather .cond').html(data.current.conditions);
				$('#{{ uid }}-weather .humi').html(data.current.more);
				$('#{{ uid }}-weather .wind').html(data.current.wind);
				$('#{{ uid }}-weather .city').html(data.city);
			})
				.error(notify.json);
		});
	</script>
{% endmacro %}

/**
* Displays the forecast weather of one day at location
 *
 * @param unique id for this widget
 * @param text as title
 * @param icon row
 * @param icon col
 * @param size x (optional, default 2)
 * @param size y (optional, default 4)
 * @param location as string (optional)
 * @param offset: 1 for today, 2 for tomorrow (default), 3 the day after tomorrow ..., (optional)
 *
 * @info based on jDigiClock by Radoslav Dimov
 * @link http://www.radoslavdimov.com
*/
{% macro weather_forecast(id, info, row, col, sizex, sizey, location, day) %}
	{% set uid = uid(page, id) %}

	{% if once('digiweather') %}
		<link rel="stylesheet" type="text/css" href="lib/weather/jdigiweather.css" />
	{% endif %}
    <div data-row="{{ row }}" data-col="{{ col }}" data-sizex="{{ sizex|default(2) }}" data-sizey="{{ sizey|default(4) }}" {% if info %}title="{{ info }}"{% endif %} class="grid">
        <a id="{{ uid(page, id) }}-mobile" href="{{ pagelink }}" data-role="button" class="grid weather">
            <div>
                {% if info %}
                    <span class="info" >{{ info }} </span>
                {% endif %}
                <span id="{{ page }}-{{ id }}-forecastday"></span>
            </div>
            <img id="{{ page }}-{{ id }}-forecastimg" class="weather" />
            <div id="{{ page }}-{{ id }}-forecast" class="weather">
                <div class="values">
                    <div class="highlow"></div>
                    <div class="cond"></div>  
                    <div class="wind"></div>
                    <div class="humi"></div>
                    {% if location %}              
                    <div class="city"></div>
                    {% endif %}
                </div>
            </div>
        </a>
    </div>

	<script type="text/javascript">
		$('#{{ page }}').on('pagebeforeshow', function (event, ui) {
			$.getJSON('lib/weather/service/{{ config_weather_service }}.php?location={{ location|default(config_weather_location) }}', function (data) {
				$('#{{ uid }}-forecastday').html(data.forecast[{{ day|default(1) }}].date);
                $('#{{ uid }}-forecastimg').attr('src', 'lib/weather/pics/' + data.forecast[{{ day|default(1) }}].icon + '.png')
				$('#{{ uid }}-forecast .city').html(data.city);
				$('#{{ uid }}-forecast .cond').html(data.forecast[{{ day|default(1) }}].conditions);
				$('#{{ uid }}-forecast .humi').html(data.forecast[{{ day|default(1) }}].more);
				$('#{{ uid }}-forecast .wind').html(data.forecast[{{ day|default(1) }}].wind);
				$('#{{ uid }}-forecast .highlow').html(data.forecast[{{ day|default(1) }}].temp);
			})
				.error(notify.json);
		});
	</script>
{% endmacro %}

/**
 * Footer
 *
 * @param unique id for this widget
 * @param a gad/item for the temp_inside (optional)
 * @param a gad/item for the outside_temp (optional)
 * @param target for the prev button (optional)
 * @param target for the home button (optional)
 * @param target for the next button (optional)
 * @param a gad/item for the analog dynamic clock icon (optional)
*/

{% macro footer (id, temp_inside, temp_outside, prev, home, next, gad_clock) %} 
	{% set uid = uid(page, id) %}
    {% import   "basic.html" as basic %}
	<div data-role="footer" class="ui-bar ui-footer-custom" id="{{ uid }}-mobile" data-position="fixed" data-theme="a">
        {% if temp_inside %}
            <img class="icon" src="{{ icon0 }}temp_inside.svg" /> 
            {{ basic.float('float_footer_innen', temp_inside, '°', 'div') }}
        {% endif %}
        {% if temp_outside %}
            <img class="icon" src="{{ icon0 }}temp_outside.svg" /> 
            {{ basic.float('float_footer_aussen', temp_outside, '°', 'div') }}
        {% endif %}
        {% if gad_clock %}
            {% import   "icon.html" as icon %}
            {{ icon.clock(id~'-iconClock', '', gad_clock) }}
            <div>{{ now|date(' d.m.Y ') }}</div>
        {% else %}
            <!--<img class="icon" src=" {{ icon0 }}time_calendar.svg" />-->
            <div>{{ now|date(' d.m.Y ') }}</div>
            <!--<img class="icon" src=" {{ icon0 }}time_clock.svg" />-->
            <div>{{ now|date(' H:i ') }}</div>
        {% endif %}
        <div class="align-right">
            <div data-role="controlgroup" data-type="horizontal">
                {% if prev %}
                    <a href="{{ prev }}" class="prev" data-role="button" data-icon="arrow-l" data-iconpos="notext" data-theme="a" title="Zurück">Zurück</a>
                {% else %}
                    <a class="prev" onclick="goBack()" data-role="button" data-icon="arrow-l" data-iconpos="notext" data-theme="a" title="Zurück">Zurück</a>
                {% endif %}
                {% if home %}
                    <a href="{{ home }}" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" title="Start">Start</a>
                {% endif %}
                {% if next %}
                    <a href="{{ next }}" class="next" data-role="button" data-icon="arrow-r" data-iconpos="notext" data-theme="a" title="Weiter">Weiter</a>
                {% endif %}
            </div>
        </div>
	</div>
{% endmacro %}
