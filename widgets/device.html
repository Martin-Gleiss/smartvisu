/**
* -----------------------------------------------------------------------------
* @package     smartVISU
* @author      Martin Gleiß
* @copyright   2012 - 2015
* @license     GPL [http://www.gnu.de]
* -----------------------------------------------------------------------------
*/


/**
* Standard blind
*
* @param unique id for this widget (optional)
* @param name of the blind
* @param a item for the up and down movement (optional, min/max will be sent to item_pos if omitted)
* @param a item for stopping the movement (optional)
* @param a item for the absolute position of the blinds
* @param a item for increase and decrease of the blade (optional)
* @param a item for the absolute angle of the blade (optional)
* @param the minimum value for close (optional, default: 0)
* @param the maximum value for open (optional, default: 255)
* @param step between two values (optional, default: 5)
*
* @info inspired by Frank Berlenz
*/
{% macro blind(id, txt, item_move, item_stop, item_pos, item_shift, item_angle, min, max, step) %}
	{% import "basic.html" as basic %}

	<div class="blind" {{ not id is empty ? 'id="' ~ uid(page, id) ~ '"' | raw }}>
		<table align="center" cellpadding="0">
			<tr>
				<td valign="top">
					<div class="set">
						{% if item_move is empty %}
							{{ basic.button('', item_pos, '', 'carat-u', value_top) }}
						{% else %}
							{{ basic.button('', item_move, '', 'carat-u', value_top < value_bottom ? 0 : 1 ) }}
						{% endif %}
					</div>
				</td>
				<td rowspan="3" align="left" class="pos">
					{{ basic.slider('', item_pos, min, max, step, 'vertical') }}</td>
				<td rowspan="2" valign="bottom" class="angle">
					{{ txt }}<br />
					{% if item_angle %} {{ basic.slider('', item_angle, min, max, step, 'semicircle') }} {% endif %}
				</td>
			</tr>
			<tr>
				<td>
					{% if item_stop %}
						<div class="set">{{ basic.button('', item_stop, '', 'delete', 1) }}</div> {% endif %}</td>
			</tr>
			<tr>
				<td valign="bottom">
					<div class="set">
						{% if item_move is empty %}
							{{ basic.button('', item_pos, '', 'carat-d', value_bottom) }}
						{% else %}
							{{ basic.button('', item_move, '', 'carat-d', value_top < value_bottom ? 1 : 0 ) }}
						{% endif %}
					</div>
				</td>
				<td valign="bottom">
					{% if item_shift %}
						<div class="set">
							<span style="float: left;">{{ basic.button('', item_shift, '', 'minus', 0) }}</span>
							<span style="float: right;">{{ basic.button('', item_shift, '', 'plus', 1) }}</span>
						</div>
					{% endif %}
				</td>
			</tr>
		</table>
	</div>
{% endmacro %}


/**
* The Codepad is used to protect some widgets. You have to enter a correct code to use the widgets for a time.
* You may specify a global code in the config.php for all codepads.
*
* @param unique id for this widget
* @param code to be entered (optional, default in config)
* @param a title for the pad (optional)
* @param how long should the widgets be unlocked (optional, default: 10 seconds)
*/
{% macro codepad(id, code, title, duration) %}

	<div id="{{ uid(page, id) }}" data-id="{{ id }}" data-widget="device.codepad" data-val="{{ code|default(config_codepad_code)|md5 }}" data-duration="{{ duration|default('10') }}"
		data-role="popup" data-overlay-theme="a" class="alert" style="width: 166px;" >
		<div data-role="header" data-theme="c"><h1>{{ title|default('Enter Code') }}</h1></div>

		<input type="password" style="text-align: center;"/>
		
		<div style="margin: 10px;">
		{% for i in 1..9 %}
			<a data-val="{{ i }}" data-role="button" data-inline="true" data-iconpos="nopic" data-mini="true" >{{ i }}</a>
		{% endfor %}
			<a data-val="-" data-role="button" data-inline="true" data-iconpos="nopic" data-mini="true" >-</a>
			<a data-val="0" data-role="button" data-inline="true" data-iconpos="nopic" data-mini="true" >0</a>
			<a data-val="ok" data-role="button" data-inline="true" data-iconpos="nopic" data-mini="true" >OK</a>
		</div>
	</div>

{% endmacro %}


/**
* Standard dimmer with switching and dimming function
*
* @param unique id for this widget (optional)
* @param name of the dimmer
* @param a item for switching
* @param a item for dimming
* @param the minimum value if the slider is moved to total left (optional, default: 0)
* @param the maximum value if the slider is moved to total right (optional, default: 255)
* @param step between two values (optional, default: 5)
* @param the pic for the 'on' state (optional)
* @param the pic for the 'off' state (optional)
* @param the color for the 'on' state (optional)
* @param the color for the 'off' state (optional)
*/
{% macro dimmer(id, txt, item_switch, item_value, min, max, step, pic_on, pic_off, color_on, color_off) %}
	{% import "basic.html" as basic %}

	<div class="dimmer"  data-widget="device.dimmer" {{ not id is empty ? 'id="' ~ uid(page, id) ~ '"' | raw }} data-item="{{ item_switch }}, {{ item_value }}">
		{{ basic.stateswitch('', item_switch, 'icon', '', [ pic_off|default('light_light.svg'), pic_on|default('light_light.svg') ], '', [ color_off , color_on|default('icon1') ]) }}
		<p>{{ txt|e }}</p>
		{{ basic.slider('', item_value, min, max, step, 'horizontal', 'none') }}
	</div>

{% endmacro %}


/**
* Standard RTR (Room Temperatur Regulator)
*
* @param unique id for this widget (optional)
* @param name of the rtr
* @param a item for the actual temperature
* @param a item for the set temperature
* @param a item for comfort / standby (3x bit or 1x byte)
* @param a item for night (3x bit or 1x byte)
* @param a item for frost (3x bit or 1x byte)
* @param a item for the current state of the actor
* @param a item for a text (some rtr have a text-display), (optional)
* @param step for plus/minus buttons (optional, default: 0.5)
*/
{% macro rtr(id, txt, item_actual, item_set, item_comfort, item_night, item_frost, item_state, item_txt, step) %}
	{% import "basic.html" as basic %}

	<div {{ not id is empty ? 'id="' ~ uid(page, id) ~ '"' | raw }} data-widget="device.rtr" data-step="{{ step|default(0.5) }}"
		class="rtr">
		<div class="actual">
			<div class="temp">{{ basic.print('', item_actual, '°' ) }}</div>
			<div class="text">{{ txt }} {% if item_txt %} {{ basic.print('', item_txt, 'text') }} {% endif %}</div>
		</div>

		{% if item_set %}
			<div class="set">
				<a class="ui-btn ui-micro ui-btn-corner-all ui-btn-inline ui-shadow ui-nodisc-icon ui-btn-icon-notext ui-icon-minus" data-sign="-1"></a>

				<div class="temp">{{ basic.print('', item_set, '°' ) }}</div>
				<a class="ui-btn ui-micro ui-btn-corner-all ui-btn-inline ui-shadow ui-nodisc-icon ui-btn-icon-notext ui-icon-plus" data-sign="+1"></a>
			</div>
		{% endif %}

		<div class="control">
			{% if ((config_driver == 'linknx') and (item_comfort == item_night) and (item_night == item_frost)) %}
				{{ basic.switch('', item_comfort, 'user_available.svg', 'user_away.svg', 'comfort', 'standby') }}
				{{ basic.switch('', item_night, 'scene_night.svg', 'scene_day.svg', 'night', 'standby') }}
				{{ basic.switch('', item_frost, 'weather_frost.svg', 'weather_frost.svg', 'frost', 'standby') }}
			{% elseif ((item_comfort == item_night) and (item_night == item_frost)) %}
				{{ basic.switch('', item_comfort, 'user_available.svg', 'user_away.svg', '1', '2') }}
				{{ basic.switch('', item_night, 'scene_night.svg', 'scene_day.svg', '3', '2') }}
				{{ basic.switch('', item_frost, 'weather_frost.svg', 'weather_frost.svg', '4', '2') }}
			{% else %}
				{{ basic.switch('', item_comfort, 'user_available.svg', 'user_away.svg') }}
				{{ basic.switch('', item_night, 'scene_night.svg', 'scene_day.svg') }}
				{{ basic.switch('', item_frost, 'weather_frost.svg', 'weather_frost.svg') }}
			{% endif %}
			<div style="float:left; width: 3px; height: 50px;"></div>
			{{ basic.switch('', item_state, 'sani_heating.svg', 'sani_heating.svg') }}
		</div>
	</div>
{% endmacro %}


/**
* Standard shutter
*
* @param unique id for this widget (optional)
* @param name of the shutter
* @param a item for the up and down movement (optional, value_top/value_bottom will be sent to item_pos if omitted)
* @param a item for stopping the movement (optional)
* @param a item for the absolute position of the blinds
* @param a item for increase and decrease of the blade (optional, for future use)
* @param a item for the absolute angle of the blade (optional)
* @param a item for some saved positions (optional)
* @param the value for opened (optional, default 0)
* @param the value for closed (optional, default 255)
* @param step between two values (optional, default 5)
* @param 'half' blade turns from -1 to +1, 'full' blade turns from 0 to +1 (optional, default 'half')
* @param a background image url; optimal size is 100px x 180px (optional)
* @param the value to send for position 1 (optional, default 0)
* @param the value to send for position 2 (optional, default 1)
*
* @info inspired by Jörg Gutowski
*/
{% macro shutter(id, txt, item_move, item_stop, item_pos, item_shift, item_angle, item_saved, value_top, value_bottom, step, mode, background, value_pos_1, value_pos_2) %}
	{% import "basic.html" as basic %}

	<div class="blind" {{ not id is empty ? 'id="' ~ uid(page, id) ~ '"' | raw }}>
		<table align="center" cellpadding="0">
			<tr>
				<td valign="top">
					<div class="set">
						{% if item_move is empty %}
							{{ basic.button('', item_pos, '', 'carat-u', value_top) }}
						{% else %}
							{{ basic.button('', item_move, '', 'carat-u', value_top < value_bottom ? 0 : 1 ) }}
						{% endif %}
					</div>
				</td>
				<td rowspan="3" valign="center" class="pos">
					{{ basic.shutter('', item_pos, item_angle, value_top, value_bottom, step, mode, background) }}
				</td>
				<td valign="top">
					{% if item_saved %}
						<div>{{ basic.button('', item_saved, 'Pos1', 'grid', value_pos_1) }}</div>
					{% endif %}
				</td>
			</tr>
			<tr>
				<td valign="center">
					{% if item_stop %}
						<div class="set">{{ basic.button('', item_stop, '', 'delete', 1) }}</div>
					{% endif %}
				</td>
				<td valign="center">{{ txt }}</td>
			</tr>
			<tr>
				<td valign="bottom">
					<div class="set">
						{% if item_move is empty %}
							{{ basic.button('', item_pos, '', 'carat-d', value_bottom) }}
						{% else %}
							{{ basic.button('', item_move, '', 'carat-d', value_top < value_bottom ? 1 : 0 ) }}
						{% endif %}
					</div>
				</td>
				<td valign="bottom">
					{% if item_saved %}
						<div>{{ basic.button('', item_saved, 'Pos2', 'grid', value_pos_2) }}</div>
					{% endif %}
				</td>
			</tr>
		</table>
	</div>

{% endmacro %}

/**
* Widget for usage of UZSU plugin
*
* @param unique id for this widget (optional)
* @param the item of the UZSU (NOT the item which is switched by UZSU)
* @param headline of popup (optional, default: UZSU)
* @param the pic for the 'on' state (optional)
* @param the pic for the 'off' state (optional)
* @param supported types are 'bool', 'num', 'list', 'text' (optional, default: bool)
* @param valueParameterList depending on valueType (optional):
	bool: ['text on','text off'] or ['text1:value1','text2:value2'], 
	num: ['min max step'], 
	list: ['value1','value2','value3'] or ['text1:value1','text2:value2','text3:value3'], 
	text: no value parameter
* @param the color for the 'on' state, e.g. '#f00' for red (default 'icon1' of the design)
* @param the color for the 'off' state, e.g. '#f00' for red (default 'icon0' of the design)
*
* @author Michael Würtenberger
*/

{% macro uzsuicon(id, item, headline, pic_on, pic_off, valueType, valueParameterList, color_on, color_off, _backend) %}
	{% import "basic.html" as basic %}

	<span {{ not id is empty ? 'id="' ~ uid(page, id) ~ '"' | raw }} data-widget="uzsu.uzsuicon" data-item="{{ item }}" 
		data-headline="{{ headline|default('UZSU') }}" data-designType="{{ _backend }}"
		data-valueType="{{ valueType|default('bool') }}" data-valueParameterList="{{ implode(valueParameterList) }}"
		class="switch icon">
		<a>
			{{ basic._icon(pic_off|deficon('time_timer_switch.svg'), color_off, '', 'icon-off') }}
			{{ basic._icon(pic_on|deficon('time_timer_switch.svg'), color_on|default('icon1'), '', 'icon-on hide') }}
		</a>
	</span>
	
{% endmacro %}