/**
* -----------------------------------------------------------------------------
* @package     smartVISU
* @author      Martin Glei√ü
* @copyright   2012 - 2015
* @license     GPL [http://www.gnu.de]
* -----------------------------------------------------------------------------
*/


/**
* Displays a digital clock
*
* @param {id} unique id for this widget
* @param {text=} location for weather data (optional, no weather shown if omitted)
* @param {duration=15i} the refresh interval for weather data (using relative time format), default 15i (15 minutes)
*
* stopitem will be set to "true" when new page is loaded in order to stop the clock from loading digits till eternity ;)
* data-item="" is needed to trigger the update method on page refresh
*
* @info based on jDigiClock by Radoslav Dimov
* @link http://www.radoslavdimov.com
*/
{% macro digiclock(id, location, repeat) %}
	{% set uid = uid(page, id) %}
	
	/** use data-item="" in order to trigger update when page is loaded from cache */
	<div id="{{ uid }}-digiclock" data-widget="clock.digiclock" class="digiclock" stoptimer="false" data-item=""
	 {% if config_timesource == 'server' %} data-servertime-url="lib/clock/servertime.php" {% endif %}
	 ></div>

	{% if not location is empty %}
		<div class="center digiweather" style="visibility: hidden;" data-widget="clock.digiclock" data-repeat="{{ repeat|default('15i') }}"
			data-service-url="lib/weather/service/{{ config_weather_service|url_encode }}.php?location={{ location|default(config_weather_location)|url_encode }}">
			<div id="{{ uid }}-spot" class="spot">
				<div class="temp"></div>
				<div class="city"></div>
				<div class="cond"></div>
				<img src="">
			</div>
		</div>
	{% endif %}

{% endmacro %}


/**
* Displays a clock in icon style
*
* @param {id} unique id for this widget
*/
{% macro iconclock(id) %}
	{% import "icon.html" as icon %}

	<span id="{{ uid(page, id) }}-iconclock" data-widget="clock.iconclock" data-repeat="1i" class="iconclock"
	 {% if config_timesource == 'server' %} data-servertime-url="lib/clock/servertime.php" {% endif %}
	 >{{ icon.clock(id) }}</span>

{% endmacro %}


/**
* Displays a mini text-based clock
*
* @param {id=} unique id for this widget (optional)
* @param {text=} a PHP like date/time format string (optional)
*/
{% macro miniclock(id, format) %}

	<span{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="clock.miniclock" data-repeat="1i" class="miniclock"
		data-format="{{ format|default('time') }}"
		{% if config_timesource == 'server' %} data-servertime-url="lib/clock/servertime.php" {% endif %}
		>{{ "now"|date('H:i') }}</span>

{% endmacro %}


/**
* Displays a countdown
*
* @param {id=} unique id for this widget (optional)
* @param {text} an item being switched
* @param {text} an item containing the start time of the countdown (timestamp) 
* @param {text} an item containing the duration of the countdown (h,i,s format) 
* @param {text=} the countdown interval in seconds, e.g. '60s' (default: '10s')  
*/
{% macro countdown(id, item, starttime, duration, interval ) %}

	{% if interval is empty %} {% set interval = "10s" %} {% endif %}
	<span{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="clock.countdown" data-interval="{{ interval }}" class="miniclock"
		data-item="{{ item }}, {{ starttime }}, {{ duration }}">--:--:--</span>

{% endmacro %}