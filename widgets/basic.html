/**
* -----------------------------------------------------------------------------
* @package     smartVISU
* @author      Martin Gleiß and others
* @copyright   2012 - 2023
* @license     GPL [http://www.gnu.de]
* -----------------------------------------------------------------------------
*/

/**
* Displays a checkbox
*
* @param {id=} unique id for this widget (optional)
* @param {item(bool)=} an item
* @param {text=} label of the checkbox (optional)
  checkbox gets shrinked when empty, pass a whitespace to prevent this
* @param {text=1} value for the checked state (optional, default 1)
* @param {text=0} value for the unchecked state (optional, default 0)
*/
{% macro checkbox(id, item, txt, val_on, val_off) %}

	<label{% if txt is empty %} style="padding-right: 0; width: 0;"{% endif %}>
		<input type="checkbox"{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.checkbox" data-item="{{ item }}"
			{%- if txt is empty %} data-mini="true"{% endif -%}
			data-val-on="{{ val_on|default(1) }}" data-val-off="{{ val_off|default(0) }}" />
		{{ txt }}&nbsp;
	</label>

{% endmacro %}


/**
* Displays a color selector
*
* @param {id=} unique id for this widget (optional)
* @param {item[?](num,list)} an item for the red value in RGB model or hue in HSL and HSV model, or single item containing list of all color values
* @param {item(num)=} an item for the green value in RGB model or saturation in HSL and HSV model
(to let blank if first item contains list of all values)
* @param {item(num)=} an item for the blue value in RGB model or lightness in HSL model / brightness in HSB model
(to let blank if first item contains list of all values)
* @param {value[?]=0} minimum value if the light is off; single value or list of values for each component (optional, default 0)
* @param {value[?]=255} maximum value if the light is full on; single value or list of values for each component (optional, default 255 for rgb, [360,100,100] for hsl & hsv)
* @param {value=7} number of shades per color (optional, default 7)
* @param {value=10} number of colored segments (optional, default 10)
* @param {text(disc,rect,slider)=disc} 'disc' for circular, 'rect' for rectangular view, 'slider' for HSV sliders (optional, default: disc)
* @param {text(rgb,hsl,hsv)=rgb} possible values: 'rgb', 'hsl' and 'hsv' (optional, default: rgb)
*
* @see misc/fundamentals#Items
*
* @author Martin Gleiß and Stefan Widmer
* @info inspired by Marcus Popp
*/
{% macro color(id, item_r_h, item_g_s, item_b_l_v, min, max, steps, colors, style, colormodel) %}
	{% set style = style|default('disc') %}

	{% if style == 'slider' %}
		{% import _self as basic %}
		<div{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.color"
			data-style="{{ style }}" data-colormodel="{{ colormodel|default('rgb') }}"
			data-min="{{ implode(min|default('0')) }}" data-max="{{ implode(max|default(colormodel == 'hsl' or colormodel == 'hsv' ? [360,100,100] : 255)) }}"
			data-step="{{ steps|default(7) }}" data-colors="{{ colors|default(10) }}"
			data-item="{{ item_r_h }}, {{ item_g_s }}, {{ item_b_l_v }}"
			>
			<div class="color-hue">
				<input type="range" value="0" min="0" max="360" step="1"
					data-orientation="horizontal" data-handleinfo="false" data-highlight="true" class="ui-slider-no-input" />
			</div>
			<div class="color-saturation">
				<input type="range" value="0" min="0" max="100" step="1"
					data-orientation="horizontal" data-handleinfo="false" data-highlight="true" class="ui-slider-no-input" />
			</div>
			<div class="color-lightness">
				<input type="range" value="0" min="0" max="100" step="1"
					data-orientation="horizontal" data-handleinfo="false" data-highlight="true" class="ui-slider-no-input" />
			</div>
		</div>
	{% else %}
		<a{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.color"
			data-style="{{ style }}" data-colormodel="{{ colormodel|default('rgb') }}"
			data-item="{{ item_r_h }}, {{ item_g_s }}, {{ item_b_l_v }}"
			data-min="{{ implode(min|default('0')) }}" data-max="{{ implode(max|default(colormodel == 'hsl' or colormodel == 'hsv' ? [360,100,100] : 255)) }}"
			data-step="{{ steps|default(7) }}" data-colors="{{ colors|default(10) }}"
			class="colordisc"><span></span></a>
	{% endif %}
{% endmacro %}


/**
* Displays a flip-switch
*
* @param {id=} unique id for this widget (optional)
* @param {item(bool,num,str)} an item
* @param {text=On} text for the 'on' state (optional, default 'On')
* @param {text=Off} text for the 'off' state (optional, default 'Off')
* @param {text=1} value for the 'on' state (optional, default 1)
* @param {text=0} value for the 'off' state (optional, default 0)
* @param {color=} alternative color (e.g. '#777') for active switch (optional)
*
* @see misc/fundamentals#Items
*/
{% macro flip(id, item, txt_on, txt_off, val_on, val_off, background) %}

	<select{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.flip" data-item="{{ item }}"
		data-role="flipswitch" data-background="{{ background }}">
		<option value="{{ val_off|default(0) }}">{{ txt_off|default('Off') }}</option>
		<option value="{{ val_on|default(1) }}">{{ txt_on|default('On') }}</option>
	</select>

{% endmacro %}


/**
* Used to glue two widgets together. Only needed if you don't use 'Realtime'!
* If you click the 'from'-widget, the 'to'-widget will be reloaded and updated after a delay.
*
* @param {id(nonunique)} id of the element that is being clicked (from)
* @param {id(nonunique)} id of the element that contains an item that will be changed (to)
*/
{% macro glue(id_from, id_to) %}
	<script>
		$('#{{ config_pages~'_'~page }}').on('pageinit', function (event, ui) {
			$('#{{ uid(page, id_from) }}').on('click', function () {
				window.setTimeout(function () {
					var items = widget.explode($('#{{ uid(page, id_to) }}').attr('data-item'));
					for (var i = 0; i < items.length; i++) {
						io.read(items[i]);
					}
				}, {{ config_delay }});
			});
		});
	</script>
{% endmacro %}


/**
* show an icon, optionally colored statically or dynamically by item
*
* @param {image} icon to show 
- smartVISU icons and icons in ./dropins/icons/ws: path and extension may be omitted (e.g. "light_light") 
- others: full file name with path and extension
- to avoid SVG embedding, use full filename with path and extension and add "/ne" at the end, e.g. "dropins/icons/ws/myicon.svg/ne"
* @param {color(icon0to5,rgb,hsl,hsv,hex,#f00)=icon0} the color in any CSS form (e.g. '#f00' for red) or classes 'icon0' through 'icon5' (default 'icon0' of the design)
	To use dynamic coloring by item give one of the following color models: 'rgb', 'hsl', 'hsv' or 'hex'. Alpha vaiues in the items will be automatically added, so e.g. specified 'rgb' converts to rgba.
* @param {item[?](num,list)=} either one item which sends all three/four color parts as array or an array of three /four items each sending one of the color parts.
* @param {type=icon} icon type / size. valid types: 'micro','mini','midi','icon' (optional, default = 'icon')
*
* @see design/design_icons#Icons (list of available pictures)
*
* @author Stefan Widmer
*/
{% macro icon(pic, color, item, type) %}
	{% set iconstyles = ['icon0', 'icon1', 'icon2', 'icon3', 'icon4', 'icon5'] %}
	{% set iconF = 'icons/ws/' %}
	{% set colormodels = ['rgb','hsl','hsv','hex'] %}
	{% set noembed = 0 %} {% if pic|trim|slice(-3,3) == '/ne' %} {% set noembed = "1" %} {% set pic = pic|trim|slice(0,-3) %} {% endif %}
	{% if type not in ['micro','mini','midi'] %} {% set type = '' %} {% else %} {% set uitype = 'ui-'~type %} {% endif %}
	
	{% if pic|trim|slice(0, 1) != '<' or pic|trim|slice(0, 4) == '<svg' -%} /** pic is an icon */
		{% if item and not color %}{% set color = 'rgb' %}{% endif %}
		{% if color in colormodels -%}
			<span data-widget="basic.icon" data-colormodel="{{ color }}" data-item="{{ implode(item) }}" data-min="{{ implode(min|default([0,0,0])) }}" data-max="{{ implode(max|default(color == 'hsl' or color == 'hsv' ? [360,100,100] : [255,255,255])) }}">
		{%- endif -%}

		{% if pic|trim|slice(0, 4) != '<svg' -%} /** pic is not a dynamic icon */

			/**- rewrite legacy png to svg if png file does not exist and svg file does -*/
			/**- and rewrite smartVISU svg with path to icons namespace if it exists -*/
			{% if ((pic matches '#^icons/../.*\.png$#' and not isfile(pic)) or (pic matches '#^icons/../.*\.svg$#' and noembed == 0)) and isfile(iconF ~ pic|slice(9,-4) ~ '.svg') %}
				{% if pic|slice(6, 2) != iconF|slice(-3, 2) %}
					{% set color = pic|slice(6, 2) %}
				{% endif %}
				{% set pic = '@icons/' ~ pic|slice(9,-4) ~ '.svg' %}
			{% endif %}
			
			{% set color = color|default('icon0') %}

			/**- pic whithout path -*/
			{% if '/' not in pic and not isfile(pic) %}
				{% set pic = localize_svg(pic) %}
			{% endif -%}
			
			{% if  pic|trim|slice(-4, 4) == '.svg' and pic|trim|slice(0,6) == '@icons'  %}
				<svg class="icon {{ type }}
			{% else %}
				<img class="icon {{ noembed == 1 ? '' :  'do-fx' }} {{ type }} 
			{% endif %}
		{%- else -%} /** pic is a dynamic icon */
			<span class="{{ ( uitype == '' ? 'icon' : 'ui-icn ui-btn-inline') }} {{ uitype }}  /** uitype is empty if icon is called from e.g. stateswitch **/
			{% if color not in iconstyles %} icon1 {% endif %}
		{%- endif %}
		
		{%- set color = {'or': '#f9a028', 'gn': '#84c929', 'bl': '#4176a9', 'sw': '#000', 'ws': '#fff'}[color]|default(color) -%} /**- legacy smartVISU colors -*/
		{% if color in iconstyles %} {{ color }} {% endif %}
		{%- if color not in iconstyles and color not in colormodels %}" style="stroke:{{ color }}; fill:{{ color }}; color:{{ color }}; {%- endif -%}

		{%- if pic|trim|slice(0, 4) != '<svg' -%}
			{% if  pic|trim|slice(-4, 4) == '.svg' and pic|trim|slice(0,6) == '@icons' %}
				" role="img" aria-label="{{ pic|split('/')|last|split('.')[0:-1]|join('.') }}" {{ source( pic )|split('<svg')[1]|replace( {'stroke="#fff"':'', 'fill="#fff"':'', 'stroke="#FFF"':'', 'fill="#FFF"':''} )|raw }}  
			{% else %}
				" src="{{ pic }}" alt="{{ pic|split('/')|last|split('.')[0:-1]|join('.')|default(pic) }}">
			{% endif %}
		{%- else -%}
			">{{ pic }}</span>
		{%- endif -%}
		{% if color in colormodels -%}
			</span>
		{%- endif -%}
	{%- else -%} /** pic is any other widget */
		{{ pic|raw }}
	{%- endif -%}

{% endmacro %}


/**
* Displays an input field
*
* @param {id=} unique id for this widget (optional)
* @param {item(bool,num,list,str)} an item, sent values are:
	- date, dateflip, datecal, dateslide, datetime, datetimeflip: Date object resp. ISO 8601 - e.g. '2017-11-29T23:00:00.000Z' in UTC time (if no string format specified)
	- time & timeflip: String with 24hr clock - e.g. '18:31:27' - format for time is taken from language file
	- duration & durationflip: Number of seconds
	- any other: Entered value
* @param {text(text,textarea,number,date,dateflip,datecal,dateslide,datetime,datetimeflip,time,timeflip,duration,durationflip)=text} 'text', 'number', 'date', 'dateflip', 'datecal', 'dateslide', 'datetime', 'datetimeflip', 'time', 'timeflip', 'duration', 'durationflip' (optional, default: text)
* @param {text=} lowest allowed value (optional)
	- date, dateflip, datetime & datetimeflip: Number of days before today
	- time & timeflip: Format is 24hr clock - e.g. '18:31:27'
	- duration & durationflip: in seconds
* @param {text=} highest allowed value (optional)
	- date, dateflip, datetime & datetimeflip: Number of days after today
	- time, timeflip: Format is 24hr clock - e.g. '18:31:27'
	- duration & durationflip: in seconds
* @param {value=1} step between two values (optional, no effect on date/time types)
* @param {text=} string format for date and datetime only (optional)
    - empty: default format for date will be standard date object (see above)
    - with given format option, the date will be converted to a string, e.g. '%d.%m.%Y'	represents DD.MM.YYYY.
	  For options see https://jtsage.dev/DateBox/doc/3-3-output/
	- to globally change time format for timeboxes, use the override method of JTSage in your visu.js:
	  jQuery.extend(jQuery.jtsage.datebox.prototype.options, {overrideTimeOutput: "%H:%M", overrideTimeFieldOrder: ["h","i"] })
*
* @author Stefan Widmer
* @info Inspired by Michael Würtenberger, date/time control uses JTSageDateBox
*/
{% macro input(id, item, type, min, max, step, format) %}
	{% set type = type|default('text') %}
	{% if type|lower == 'textarea' %}
		<textarea {% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.input" data-item="{{ item }}" type="textarea"></textarea>
	{% else %}
		<input{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.input" data-item="{{ item }}"
			{% if type|lower in ['time', 'timeflip'] %}
				type="text" data-role="datebox" data-datebox-mode="{{ type~'box' }}" data-use-focus="true"
				data-min-svtime="{{ min|default('false') }}" data-max-svtime="{{ max|default('false') }}"
			{% elseif type|lower in ['duration', 'durationflip'] %}
				type="text" data-role="datebox" data-datebox-mode="{{ type~'box' }}" data-use-focus="true"
				data-min-dur="{{ min|default('false') }}" data-max-dur="{{ max|default('false') }}" data-duration-step="{{ step|default(1) }}"
			{% elseif type|lower in ['date', 'dateflip', 'datecal', 'dateslide'] %}
				type="text" data-role="datebox" data-datebox-mode="{{ (type == 'date' ? type : type|slice(4))~'box' }}" data-use-focus="true"
				data-min-days="{{ min|default('false') }}" data-max-days="{{ max|default('false') }}"
				data-stringformat ="{{ format|default('false') }}"
			{% elseif type|lower in ['datetime', 'datetimeflip'] %}
				type="text" data-role="datebox" data-datebox-mode="{{ type~'box' }}" data-use-focus="true"
				data-min-days="{{ min|default('false') }}" data-max-days="{{ max|default('false') }}"
				data-stringformat ="{{ format|default('false') }}" {% if format is not empty %}data-options='{"overrideDatetimeFormat":"{{ format }}" }'{% endif %}
			{% else %}
				type="{{ type|default('text') }}"
				min="{{ min }}" max="{{ max }}" step="{{ step|default(1) }}"
			{% endif %}
			data-clear-btn="false" />
	{% endif %}
{% endmacro %}


/**
* A widget to display a list
*
* @param {id=} unique id for this widget (optional)
* @param {item(list)} an item
* @param {value=5} max number of values to show (optional, default 5)
* @param {text=} title of the collapsible (optional)
* @param {text=} make the widget collapsible (optional)
*
* @author Christian Strassburg
*/
{% macro listview(id, item, size, title, col) %}
	<div {% if not col is empty %}data-role="collapsible"{% endif %} data-theme="a" data-content-theme="a"{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-item="{{ item }}" class="text" data-widget="basic.listview" data-size="{{ size }}" data-collapsed="false" >
		{% if not col is empty %}<h4>{{ title }}</h4>{% endif %}
		<ul data-role="listview"></ul>
	</div>
{% endmacro %}


/**
* Displays a button to shift offset
*
* @param {id=} unique id for this widget (optional)
* @param {item(num)} an item
* @param {value=1} step between two values; use positive numbers to increase, negative ones to decrease (optional, default 1)
* @param {image=} icon to show on the button (optional)
* @param {text=} text printed on the button (optional)
* @param {type(text)=mini} valid types: 'micro', 'mini', 'midi', 'icon', 'text' (optional, default: mini)
* @param {text=} lowest allowed value (optional, default: no limit)
* @param {text=} highest allowed value (optional, default: no limit)
*
* @see misc/fundamentals#Items
*/
{% macro offset(id, item, step, icon, text, type, min, max) %}
	{% import _self as basic %}

	<a{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.offset" data-item="{{ item }}" data-min ="{{ min }}" data-max ="{{ max }}" data-step="{{ step|default(1) }}" class="
		{%- if type == 'icon' or type == 'text' -%} /**- display as icon -*/
			switch ui-link
		{%- else -%} /**- display as button -*/
			ui-btn ui-{{ type|default('mini') }} ui-corner-all ui-btn-inline
		{%- endif -%}
			{%- if icon is empty -%}
				">
			{%- else -%}
				{{ not text is empty ? ' ui-btn-icon-top' }} ui-nodisc-icon">{{ basic.icon(icon) }}
			{%- endif -%}
		{{- text|e -}}
	</a>
{% endmacro %}


/**
* prints value or text (optionally calculated and/or formatted)
*
* @param {id=} unique id for this widget (optional)
* @param {item[?](bool,num,list,str)} one or more item(s). Multiple items in array-form: [item1, item2]
* @param {format=} either a unit of the language file, an individual format string (PHP sprintf like) or a simple string as suffix.
  Formats 'date', 'time', 'long', 'short' are applicable on valid timestamps like "2020-01-01T12:00:00.000000+01:00" or Unix timestamps in Milliseconds
  Use 'text' to display result as unformatted string, 'html' to render it as unescaped html, 'text2br' to convert line endings like '\r', '\n' or '\r\n' to HTML breaks or 'script' to just execute as JavaScript w/o displaying anything.
* @param {formula=VAR} any valid JavaScript expression with following variables and aggregate functions (optional, default: VAR)
  - VAR1, VAR2, ... represent the corresponding item's value, VAR is an array of all item values
  - SUM(VAR), AVG(VAR), SUB(VAR), MIN(VAR) and MAX(VAR) aggregate the values
* @param {text[]=} array of upper thresholds; the color according to highest reached threshold is applied (optional)
* @param {color[?](icon0to5,hidden,blank)=icon0} array of colors; 'icon0' through 'icon5' or e. g. '#f00' for red (optional, default = icon0 )
  additionally you can use 'hidden' to not diplay at all or 'blank' to make it invisible but preserve the space that would be used.
  the first one is the base color for values below first threshold, so pass one color more than thresholds.
* @param {text=} URL to use as link (optional)
* @param {text=} used in combination with href as data-rel attribute {e.g. to open a popup} (optional)
*
* @see misc/fundamentals#Array-Form
*
* @author Stefan Widmer
* @info inspired by Martin Gleiß and Raik Alber
*/
{% macro print(id, item, format, formula, threshold, color, href, rel) %}
{% set color = color|default('icon0') %}
{% if href is empty %}{% else %}<a href="{{ href }}"{% if rel is not empty %} data-rel="popup"{% endif %}>{% endif %}
	<span{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-item="{{ implode(item) }}" class="text" data-widget="basic.print"
		data-format="{{ format }}" data-formula="{{ formula|default('VAR1') }}"
		data-thresholds="{{ implode(threshold) }}" data-colors="{{ implode(color) }}">---</span>
  {% if href is empty %}{% else %}</a>{% endif %}

{% endmacro %}


/**
* Displays a round slider
* @param {id=} unique id for this widget (optional)  
* @param {item(num,list)} an item (list type can be used if slider type is "range")
* @param {value=0} the minimum value if the slider is moved to total left (optional, default: 0)  
* @param {value=255} the maximum value if the slider is moved to total right (optional, default: 255)  
* @param {value=5} step between two values (optional, default: 5)  
* @param {text=} pretext of the center text/value 
* @param {text=} text after center text/ value
* @param {text=} unit of the center value
* @param {text(false,true)=false} display a scale with values along the slider (optional, default='false')
* @param {value=20} scale-integer, the scale-divider for the scale
* @param {text=} icon to be displayed in the center (optional)
* @param {text(pie,quarter-top-left,quarter-top-right,quarter-bottom-left,quarter-bottom-right,half-top,half-bottom,half-left,half-right,custom-half,custom-quarter)=pie} circleshape slider style (like pie, quarter-top-left, quarter-top-right, quarter-bottom-left, quarter-bottom-right, half-top, half-bottom, half-left, half-right, custom-half, custom-quarter)
* @param {text(default,range,min-range)=min-range} slidertype (default, min-range,range ) (optional, default = min-range)
* @param {value=120} radius of the slider (optional, default: 90)  
* @param {value=15} width of the slide line
* @param {value=0.1} thickness of the slide line
* @param {value=1} 'live mode': if enabled, values will be sent during sliding. '0' sends values only when sliding is stopped, after click into track or if value is edited in input field. (optional, default = 1)
*
* @see misc/fundamentals#Items
*
* @author Bonze, Wolfram v. Hülsen
*/

{% macro roundslider(id, item, min, max, step, pre_value, to_value, unit, scale, scale_interval, pic, circleshape, slidertype, radius, width, thickness, live) %}
	{% if circleshape not in ['', 'pie', 'quarter-top-left', 'quarter-top-right', 'quarter-bottom-left', 'quarter-bottom-right', 'half-top', 'half-bottom', 'half-left', 'half-right'] %} {% set circleshape = '' %} {% endif %}
	{% import "@widgets/lib.html" as lib %}
	
	/**- pic whithout path -*/
	{% if '/' not in pic and not isfile(pic) %}
		{% set pic = localize_svg(pic) %}
	{% endif -%}
	
	/** load icon to copy into tooltip */
	<div class = "rs-insert-icon" style = "display:none;"> 
		{% if  pic|trim|slice(-4, 4) == '.svg' and pic|trim|slice(0,6) == '@icons'  %}
			{{ lib.svgimg('', pic, 'icon0', 'width:1em; margin:auto; margin-bottom: 0em; margin-top:-1em; display:block !important;') }}
		{% endif %}
	</div> 
		
	<div {% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.roundslider" data-item="{{item}}" data-values=" {{unit}}, {{pre_value| default('')}}, {{ to_value| default('') }}, {{ scale| default('false')}}" 
		data-radius="{{radius | default('80')}}" data-scale_min="{{min | default('0')}}" data-scale_max="{{max| default('255')}}" data-step="{{step | default('5')}}" data-scale_interval="{{scale_interval | default('20')}}"
		data-width="{{width | default('15')}}" data-thickness="{{thickness | default('0.1')}}" data-circleshape="{{circleshape | default('pie')}}" data-slidertype="{{slidertype | default('min-range')}}" data-icon="{{pic}}"
		data-live="{{ live|default(1) }}" style="margin:auto; margin-top:30px; margin-bottom:30px;"> 
	</div>
{% endmacro %}


/**
* Select a specific value (e.g. a scene)
*
* @param {id=} unique id for this widget (optional)
* @param {item(bool,num,list)} an item
* @param {type(menu)=menu} type: 'menu', 'micro', 'mini', 'midi', 'icon' (optional, default: menu)
* @param {text[]=[0,1]} list of values (optional, default [0,1])
* @param {image[]=} list of icons for every button (optional) - not supported for type 'menu'
* @param {text[]=} list of texts for every menu entry or button (optional)
* @param {color(icon0to5)=icon1} the color for the on state of the buttons 'icon0' through 'icon5' or color names or codes like #f00 (optional, default: icon1) - not supported for type 'menu'
* @param {text(horizontal,vertical,none)=horizontal} orientation of the controlgroup: 'horizontal', 'vertical' or 'none' for seperate buttons (optional, default: 'horizontal') - not supported for type 'menu'
* @param {item(list)=} an item containing all selectable values (optional) - overrides existing value definitions, available for menu type only
* @param {item(list)=} an item containing the texts corresponding to the selectable values (optional even if itemvals is specified), available for menu type only
* @param {color(icon0to5,blink,simulate,:)=} activity indicator which is active until response (or a timeout  is reached); pass either a color, icon class, 'blink' or 'simulate'. Timeout is 3s by default and can be set globally using the configuration key "indicator_duration". Add a colon and integer number to specify an individual timeout, e.g. 'blink:15' (optional)
	You can also set an indicator icon, text and color by passing these as additional parameters in the icon, text and color arrays. Just provide one icon more than you have values to switch. A dynamic icon can be used also along with the 'simulate' option.
	The indicator options will not be applied to the select element of type 'menu' which will convert all options to 'blink'.
*
* @see misc/fundamentals#Items
*/
{% macro select(id, item, type, value, icon, text, color_on, group, itemvals, itemtxts, indicator) %}
	{% import _self as basic %}
	{% if type == 'menu' or type is empty %}
		{% if ":" in indicator %} 
			{% set indicatorparms = indicator|split(":") %}
			{% set indicator = indicatorparms[0] %}
			{% set indicator_duration = indicatorparms[1] %}
		{% else %} 
			{% set indicator_duration = config_indicator_duration|default(3) %}
		{% endif %}
		<select{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.select" data-native-menu="false" data-item="{{ item }}, {{ itemvals }}, {{ itemtxts }}" 
		data-indicator-type="{{ indicator }}" data-indicator-duration="{{ indicator_duration }}">
		<option></option>
		{% if itemvals == '' or itemvals is empty %}
			{% for val in value|default([0,1]) %}
				<option value="{{ val|replace({', ': ','}) }}">{{ text[loop.index0]|default(val) }}</option>
			{% endfor %}
		{% endif %}
		</select>
	{% else %}
		<div{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.select"{% if group != 'none' %} data-role="controlgroup" data-type="{{ group|default('horizontal') }}"{% endif %}>
			{% for val in value|default([0,1]) %}
				{% set pic = icon is iterable ? icon[loop.index0]|default(icon[0]) : icon %}
				{% if indicator is not empty and icon is iterable and icon|length > value|length %}
					{% set pic = [pic, pic]|merge([icon[icon|length-1]]) %}
				{% endif %}
				{{basic.stateswitch('', item, type|default('mini'), [val, val], pic, (text is iterable ? text[loop.index0]|default(text[0]) : text)|default(pic is empty ? val : ''), [color_on|default('icon1'), ''], indicator)}}
			{% endfor %}
		</div>
	{% endif %}
{% endmacro %}


/**
* Displays a shutter control
*
* @param {id=} unique id for this widget (optional)
* @param {item(num)} an item for the position of the blinds
* @param {item(num)=} an item for the angle of the blinds (optional)
* @param {value=0} the value for opened (optional, default 0)
* @param {value=255} the value for closed (optional, default 255)
* @param {value=5} step between two values (optional, default 5)
* @param {text(half,full)=half} 'half' blade turns from -1 to +1, 'full' blade turns from 0 to +1 (optional, default 'half')
* @param {image=} background image url (relative to smartVISU directory or absolute); optimal size is 100px x 180px (optional)
*
* @see misc/fundamentals#Items
*
* @info inspired by Jörg Gutowski
*/
{% macro shutter(id, item_pos, item_angle, value_top, value_bottom, step, mode, background) %}
	{% import "@widgets/lib.html" as lib %}
	<div{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.shutter" data-item="{{ item_pos }}, {{ item_angle }}"
		data-min="{{ value_top|default('0') }}" data-max="{{ value_bottom|default('255') }}" data-step="{{ step|default(5) }}"
		data-mode="{{ mode|default('half') }}" class="shutter"{{ background ? (' style="background-image: url(\'' ~ background ~ '\')"')|raw }}>

		<div class="control hide">
			{{ lib.svgimg('', 'control_arrow_up_down.svg', 'icon pos') }} /** alt="up/down" */
			{% if item_angle != '' %}
				<div class="separator">&nbsp;</div>
				{{ lib.svgimg('', 'control_arrow_turn_left_right.svg', 'icon angle' ) }}/** alt="angle" */
			{% endif %}
		</div>

		{% for i in 1..12 %}
			<div class="blade-pos"></div>
		{% endfor %}

	</div>

{% endmacro %}


/**
* a skylight (roof window) with open/tilted/closed status and shutter
*
* @param {id=} unique id for this widget
* @param {item(num)} an item for the height of the shutter blades
* @param {item(num,str)=} an item for the roof window wing status (0/'closed', 1/'tilted', 2/'open') (optional, default = 0) 
* @param {value=0} the value for shutter on top end (optional, default 0)
* @param {value=255} the value for shutter at bottom end (optional, default 255)
* @param {color[?](icon0to5,!)=icon1} color for 'open' state e.g. 'icon0' through 'icon5' or '#f00' for red. Prepend a '!' to make the color constant ('!icon3'). Color is 'icon0' if window is closed and constant color is not forced. (optional)
*
* @author: raman
*/
{% macro skylight(id, item_value, item_window, min, max, color) %}
	{% if color is empty %}{% set color = ['icon0', 'icon1'] %}{% endif %}
	{% if color is not iterable %}{% set color = ['icon0', color] %}{% endif %}
	<svg role="img" {% if id is not empty %}id="{{ uid(page, id) }}"{% endif %} data-widget="basic.skylight" data-item="{{ item_value }}, {{ item_window }}" data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}"
		 data-color="{{ implode(color) }}" class="icon icon0" 
		xmlns="http://www.w3.org/2000/svg" viewBox="20 20 321 321">
	  <polyline class="icon0" id="blind" fill-opacity=".4" stroke-width="4" stroke-linecap="butt" points="156,100 279,100 203,264 80,264 156,100" />
	  
	  <path fill="none" stroke-width="10" d="m207.744,264.139c-2.091,4.48-7.4,8.113-11.861,8.113l-115.944,.023c-4.461,0-6.383-3.633-4.293-8.115l77.917-167.094c2.089-4.48 7.4-8.115 11.861-8.115l115.945-.023c4.459,0 6.381,3.634 4.292,8.115l-77.917,167.096z"/>
	  <path d="m277.924,104.261-127.503,0 8.769-17.246 127.503,0z"/>
	  <path d="m76.381,262.584h127.455v6.432h-127.455z"/>
	  
	  <path id="window0" fill="none" stroke-width="10" d="m201.967,246.192c-1.693,3.632-5.998,6.577-9.614,6.577l-90.915,.019c-3.616,0-5.174-2.945-3.479-6.578l59.546-127.698c1.694-3.632 6-6.578 9.615-6.578l90.915-.02c3.616,0 5.174,2.946 3.479,6.579l-59.547,127.699z"/>
	  <path id="knob0" fill-opacity="1" d="m146.288,240.305c-.958,2.055-1.917,4.11-2.876,6.166-1.152,2.47-.717,5.37 1.794,6.841 2.186,1.28 5.689,.676 6.841-1.794 .958-2.055 1.917-4.11 2.876-6.166 1.152-2.47 .717-5.37-1.794-6.841-2.186-1.281-5.689-.676-6.841,1.794z"/>
	  
	  <path id="window1" fill="none" stroke-width="0" d="m182.773,241.17c-3.02,3.637-8.404,6.586-12.024,6.586l-91.039,.02c-3.621,0-4.107-2.949-1.087-6.587l103.161-121.862c3.019-3.636 8.404-6.585 12.024-6.585l84.344-.019-14.59,31.144-80.789,97.303z"/>
	  <path id="knob1" fill-opacity="0" d="m129.036,234.268c-1.708,2.058-3.417,4.115-5.126,6.173-1.739,2.094-2.059,5.012 0,7.07 1.793,1.794 5.328,2.1 7.071,0 1.708-2.058 3.417-4.115 5.126-6.173 1.739-2.094 2.059-5.012 0-7.07-1.793-1.794-5.328-2.1-7.071,0z"/>
	  
	  <path id="window2" fill="none" stroke-width="0" d="m181.148,212.418c-3.23,1.883-8.786,3.408-12.406,3.408l-91.04,.01c-3.621,0-3.935-1.525-.704-3.408l113.591-66.168c3.23-1.882 8.787-3.409 12.407-3.409l61.312-.008-13.529,29.015-69.631,40.56z"/>
	  <path id="knob2" fill-opacity="0" d="m128.62,206.358c-1.829,1.064-3.657,2.129-5.485,3.193-2.352,1.369-3.169,4.493-1.794,6.841 1.378,2.353 4.485,3.166 6.841,1.794 1.829-1.064 3.657-2.129 5.485-3.193 2.352-1.369 3.169-4.493 1.794-6.841-1.378-2.352-4.485-3.166-6.841-1.794z"/>
	</svg>
{% endmacro %}


/**
* Displays a slider-control
*
* @param {id=} unique id for this widget (optional)
* @param {item(num)} an item
* @param {value=0} the minimum value if the slider is moved to total left (optional, default 0)
* @param {value=255} the maximum value if the slider is moved to total right (optional, default 255)
* @param {value=5} step between two values (optional, default 5)
* @param {text(horizontal,vertical,bottomup,semicircle)=horizontal} possible options: 'horizontal', 'vertical', 'bottomup', 'semicircle' (optional, default 'horizontal')
* @param {text(input,handle,both,none)=input} how should the value be shown; possible options: 'input', 'handle', 'both', 'none' (optional, default 'input')
* @param {value=} the minimum value to display if the slider is moved to total left if this should differ from sent/received value (optional, default like min)
* @param {value=} the maximum value to display to total right if this should differ from sent/received value (optional, default like max)
* @param {value=1} 'live mode': if enabled, values will be sent during sliding. '0' sends values only when sliding is stopped, after click into track or if value is edited in input field. (optional, default = 1)
* @param {text=} set a colour for the slider track like: linear-gradient(90deg, rgb(229, 234, 255), rgb(255, 177, 111)) (optional)
*
* @see misc/fundamentals#Items
*/
{% macro slider(id, item, min, max, step, orientation, value_display, min_display, max_display, live, style) %}
	<input{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.slider" data-item="{{ item }}"
		type="range" value="0" min="{{ min_display|default(min)|default(0) }}" max="{{ max_display|default(max)|default(255) }}" step="{{ step|default(5) }}" data-min-send="{{ min|default(0) }}" data-max-send="{{ max|default(255) }}" data-live="{{ live|default(1) }}" data-style="{{ style|default('') }}"
		data-orientation="{{ orientation|default('horizontal') }}" data-handleinfo="{{ value_display == 'handle' or value_display == 'both' }}" data-highlight="true" class="{{ value_display|default('input') == 'input' or value_display == 'both' ? '' : 'ui-slider-no-input' }}" />
{% endmacro %}


/**
* A versatile button/switch
* (supercedes basic.button, basic.dual, basic.hiddenswitch, basic.multistate and basic.switch)
*
* @param {id=} unique id for this widget (optional)
* @param {item(bool,num,list,scene,str)} an item
* @param {type(text)=mini} valid types: 'micro', 'mini', 'midi', 'icon', 'text' (optional, default: mini)
* @param {text[?]=[0,1]} array of values (optional, default [0,1])
  If the item has a value that is not part of the list, the state (icon, text, color) of the last value in the list will be shown.
* @param {image[?]=control_on_off} array of icons (optional, default just if text is empty: control_on_off.svg)
	dynamic icons can be used, e.g. icon.light('', '', item_value); please note: these must not be wrapped by apostrophs (').									
	the second attribute in the dynamic icon must be empty. Otherwise there will be conflicts with item_switch
* @param {text[?]=} array of texts (optional)
* @param {color[?](icon0to5,hidden,blank)=icon0} array of colors; 'icon0' through 'icon5' or e. g. '#f00' for red (optional, default: icon0)
	additionally you can use 'hidden' to not diplay at all or 'blank' to make it invisible but preserve the space that would be used.
* @param {color(icon0to5,blink,simulate,:)=} activity indicator which is active until response (or a timeout  is reached); pass either a color, icon class, 'blink' or 'simulate'. Timeout is 3s by default and can be set globally using the configuration key "indicator_duration". Add a colon and integer number to specify an individual timeout, e.g. 'blink:15' (optional)
	You can also set an indicator icon, text and color by passing these as additional parameters in the icon, text and color arrays. Just provide one icon more than you have values to switch. A dynamic icon can be used also along with the 'simulate' option.
* @param {text=} an item to which a value is sent on longpress OR an id of a popup, with prefix '#' (optional)
* @param {text=} the value to send on longpress (optional)
	If this starts with a + or - sign the value is treated as offset to current stateswitch value.
* @param {text=} the value to send on releasing after a longpress (optional)
*
* @see misc/fundamentals#Items
* @see design/design_icons#Icons
*
* @author Stefan Widmer
* @info Based on work of Martin GLEISS and Pierre-Yves KERVIEL
*/
{% macro stateswitch(id, item, type, value, icon, text, color, indicator, item_longpress, value_longpress, value_longrelease) %}
	{% import _self as basic %}

	{% set value = (value|default([0,1]) is iterable ? value|default([0,1]) : [value]) %}
	{% set color = color|default(['icon0','icon1']) %}
	{% set iconstyles = ['icon0', 'icon1', 'icon2', 'icon3', 'icon4', 'icon5'] %}
	{% if ":" in indicator %} 
		{% set indicatorparms = indicator|split(":") %}
		{% set indicator = indicatorparms[0] %}
		{% set indicator_duration = indicatorparms[1] %}
	{% else %} 
		{% set indicator_duration = config_indicator_duration|default(3) %}
	{% endif %}
	
	<a style="display:none"></a> /** Work around for bug in jQuery Mobile, see https://knx-user-forum.de/forum/supportforen/smartvisu/31967-neues-widget-nur-aktive-lampen-anzeigen-ausschalten-ermöglichen?p=1145001#post1145001 */
	<span{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.stateswitch" data-item="{{ item }}"
		data-value="{{ value|first }}" data-vals="{{ implode(value) }}" data-indicator-type="{{ indicator }}" data-indicator-duration="{{ indicator_duration }}"
		data-item-longpress="{{ item_longpress }}"{% if not value_longpress is null %} data-value-longpress="{{ value_longpress }}"{% endif %}{% if not value_longrelease is null %} data-value-longrelease="{{ value_longrelease }}"{% endif %}
		style="display: none; !important">
	{% for val in ( indicator is not empty and icon is iterable and icon|length > value|length ? value|merge(['indicator']) : value) %}
		{% set pic = icon is iterable ? icon[loop.index0] : icon %}
		{% if type != 'text' and text is empty %}{% set pic = pic|deficon('control_on_off.svg') %}{% endif %}
		{% set col = (color is iterable ? color[loop.index0] : color)|default('icon0') %}
		{% set txt = (text is iterable ? text[loop.index0] : text)|default('') %}
    <a data-widget="basic.stateswitch" data-val="{{ val }}" data-index="{{ loop.index0 }}" data-col="{{ col }}" {{ col == 'hidden' ? 'style="display: none;"'|raw : col == 'blank' ? 'style="visibility: hidden;"'|raw : col not in iconstyles ? ('style="color: ' ~ col ~ '; fill: ' ~ col ~ '; stroke: ' ~ col ~ ';"')|raw }} class="{{ col in iconstyles ? col~' ' }}
			{%- if type == 'icon' or type == 'text' -%} /**- display as icon -*/
				switch ui-link
			{%- else -%} /**- display as button -*/
				ui-btn ui-{{ type|default('mini') }} ui-corner-all ui-btn-inline
				{%- if not pic is empty -%}
					{{ not txt is empty ? ' ui-btn-icon-top' }} ui-nodisc-icon
				{%- endif -%}
			{%- endif -%}
			">
			{%- if not pic is empty -%}{{ basic.icon(pic, col) }}{%- endif -%}
			{{- txt|e -}}
		</a>
  {% endfor %}
  <a class="ui-btn" style="display: none !important"></a> /** placeholder for last moved control */
  </span>
{% endmacro %}


/**
* An icon or text, with no writing to backend, only displayed when the value of item is equal to defined value. Symbols may be used in menus.
* If more than one item is given, they will be combined with formula.
*
* @param {id=} unique id for this widget (optional)
* @param {item[?](bool,num,list,scene)=} zero, one or more item(s). More items in array form: [item1, item2] (optional)
* @param {text[?]=} the text, printed when item has value val (optional)
* @param {image[?]=control_on_off} the icon shown when item has value val (optional, default 'control_on_off' if text is empty)
	dynamic icons can be used, e.g. icon.light('', '', value_item); please note: these must not be wrapped by apostrophs (')
* @param {text[?]=1} comparative value(s) (default 1)
* @param {formula=or} 'or', 'and' or any JavaScript expression with following variables, result will be compared to comparative value above. Additionally you can use 'min' and 'max' to test if any of the defined items has a value >= or <= comparative value (default 'or')
	VAR1, VAR2, ... represent the corresponding item's value, VAR is an array of all item values
	If the formula starts with a greater than symbol '>' the value will be treated as threshold. The symbol (text, icon and color) according to highest reached threshold will be shown. The first symbol is the base for values below first threshold, so pass one symbol more than values.
	If '>' is not used, symbols will only be shown if the item value matches exactly one of the given value parameters
* @param {color[?](icon0to5)=icon0} the color 'icon1' or e. g. '#f00' for red (default 'icon0' of the design)
	this applies to text only if no icon is set (for backward compatibility)
* @param {text=} URL to use as link (optional)
* @param {text=} used in combination with href as data-rel attribute {e.g. to open a popup} (optional)
* @param {type(btn-micro,btn-mini,btn-midi)=icon} icon type with or without button. valid types: 'micro','mini','midi','icon', 'btn-micro', 'btn-mini', 'btn-midi' (optional, default = 'icon')
* @param {text=} text to show inside button if button type selcted (optional)
*
* @see design/design_icons#Icons
*
* @author Martin Gleiß and Stefan Widmer
*/
{% macro symbol(id, items, text, icon, value, formula, color, href, rel, type, btntxt) %}
	{% import _self as basic %}
	{% if type not in ['micro','mini','midi', 'btn-micro', 'btn-mini', 'btn-midi'] %}{% set type = '' %}{% endif %}
	{% set value = (value|default([1]) is iterable ? value|default([1]) : [value]) %}
	{% set value = text|length > value|length or icon|length > value|length or color|length > value|length ? value|merge(['']) : value %} /** add an empty value if more icons/texts/colors as values are passed (used for threshold i.a.) */
	{% set iconstyles = ['icon0', 'icon1', 'icon2', 'icon3', 'icon4', 'icon5'] %}
	{% set color = color|default('icon0') %}
	{% set uitype ='' %}
	<{% if href is empty %}span{% else %}a href="{{ href }}"{% if rel is not empty %} data-rel="popup"{% endif %}{% endif %}{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.symbol"
		{% if not items is empty %}data-item="{{ implode(items) }}" style="display: none;" {% endif %}
		data-val="{{ implode(value) }}" data-mode="{{ formula|default('or') }}" class="symbol">
		{%- for val in value -%}
			{%- set pic = icon is iterable ? icon[loop.index0] : icon -%}
			{%- if text is empty %}{% set pic = pic|deficon('control_on_off.svg') %}{% endif -%}
			{%- set col = (color is iterable ? color[loop.index0] : color)|default('icon0') -%}
			{%- set txt = (text is iterable ? text[loop.index0] : text)|default('') -%}
			<span data-val="{{ val }}"
				style="{% if not loop.first %}display:none;{% endif %}{% if pic is empty and not txt is empty and not col is empty and col != 'icon1' %}color: {{ col }};{% endif %}"
				{% if pic is empty and not txt is empty and col in iconstyles %} class="{{col}}"{% endif %}>
				{%- if pic %}
					{% if type in ['btn-micro', 'btn-mini', 'btn-midi'] %} 
						{% set uitype = 'ui-'~type|slice(4) %}
						<span class="ui-btn {{ uitype }} ui-btn-inline ui-corner-all {{ not btntxt is empty ? ' ui-btn-icon-top' }} ui-nodisc-icon"> 
							{{ basic.icon(pic, col,'','') }}
							{{- btntxt|e -}}
						</span>
					{% else %}		
						{{ basic.icon(pic, col,'',type) }}
					{% endif %}
				{% endif -%}
				{{- txt|raw -}}
			</span>
	  {%- endfor -%}
	</{% if href is empty %}span{% else %}a{% endif %}>
{% endmacro %}


/**
* Displays a (partly) filled tank
*
* @param {id=} unique id for this widget (optional)
* @param {item(num)} an item for the actual position of filled tank
* @param {value=0} the value for empty (optional, default 0)
* @param {value=255} the value for full (optional, default 255)
* @param {value=5} step between two values (optional, default 5, for future use)
* @param {text(none,cylinder,water,pellets)=none} the mode: 'none', 'cylinder', 'water', 'pellets' (optional, default 'none')
* @param {color[?]=} single color or array of colors; e. g. '#f00' for red. If thresholds are used provide one color more than thresholds (optional)
* @param {text[]=} array of upper thresholds; the color according to highest reached threshold is applied (optional)
*/
{% macro tank(id, item_pos, min, max, step, mode, color, threshold) %}

	{% set color = color is iterable ? color : [color] %}
	<div{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.tank" data-item="{{ item_pos }}"
		data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}" data-thresholds="{{ implode(threshold) }}" data-colors="{{ implode(color) }}"
		class="tank">
		<div
			{% if mode == 'cylinder' %}
				style="background-image: url('pages/base/pics/scale_cylinder.png'); background-color: {{ color[0]|default('#444') }};"
			{% elseif mode == 'water' %}
				style="background-image: url('pages/base/pics/scale_water.png'); background-color: {{ color[0]|default('#09f') }};"
			{% elseif mode == 'pellets' or mode == 'pallets' %} /** remove typo "pallets" over time */
				style="background-image: url('pages/base/pics/scale_pellets.png'); background-color: {{ color[0]|default('#eb7') }};
					-moz-border-radius: 10em 10em 0.5em 0.5em; -webkit-border-radius: 10em 10em 0.5em 0.5em; border-radius: 10em 10em 0.5em 0.5em;"
			{% endif %}
			>&nbsp;</div>
	</div>

{% endmacro %}


/**
* A widget to trigger a logic (e. g. in smarthomeNG)
*
* @param {id=} unique id for this widget (optional)
* @param {text} the name of the trigger (logic)
* @param {text=} text printed on the button (optional)
* @param {image=} icon to show on the button (optional)
* @param {text=1} value to send if the button is pressed (optional, default 1)
* @param {type=mini} type: 'micro', 'mini', 'midi' (optional, default: mini)
* @param {text(button,page,both)=button} trigger event: 'button', 'page', 'both' (optional, default: button)
*/
{% macro trigger(id, name, txt, icon, val, type, event) %}
	{% import _self as basic %}

	<a{% if not id is empty %} id="{{ uid(page, id) }}"{% endif %} data-widget="basic.trigger" data-name="{{ name }}" data-val="{{ val }}"
		data-triggerevent="{{ event }}"
		{% if event == 'page' %} style="display: none;" {% endif %}
		class="ui-btn ui-{{ type|default('mini') }} ui-corner-all ui-btn-inline ui-shadow
		{%- if icon is empty -%}
			">
		{%- else -%}
			{{ txt ? ' ui-nodisc-icon ui-btn-icon-top' : '' }}">{{ basic.icon(icon) }}
		{%- endif -%}
		{{- txt|e -}}
	</a>
{% endmacro %}


/**
* a window with open/tilted/closed status and shutter
*
* @param {id=} unique id for this widget
* @param {item(num)} an item for the height of the shutter blades
* @param {item(num,str)=} an item for the window right wing status (0/'closed', 1/'tilted', 2/'open') (optional, default = 0) 
* @param {item(num,str)=} an item for the window left wing status (0/'closed', 1/'tilted', 2/'open') (optional, default = 0)
* @param {value=0} the value for shutter on top end (optional, default 0)
* @param {value=255} the value for shutter at bottom end (optional, default 255)
* @param {color[?](icon0to5,!)=icon1} color for 'open' state e.g. 'icon0' through 'icon5' or '#f00' for red. Prepend a '!' to make the color constant ('!icon3'). Color is 'icon0' if window is closed and constant color is not forced. (optional)
*
* @author: Wolfram v. Hülsen
*/
{% macro window(id, item_value, item_window_r, item_window_l, min, max, color) %}
{% if color is empty %}{% set color = ['icon0', 'icon1'] %}{% endif %}
{% if color is not iterable %}{% set color = ['icon0', color] %}{% endif %}
<svg role="img" {% if id is not empty %}id="{{ uid(page, id) }}"{% endif %} data-widget="basic.window" data-item="{{ item_value }}, {{ item_window_r }}, {{ item_window_l }}" data-min="{{ min|default('0') }}" data-max="{{ max|default('255') }}"
	 data-color="{{ implode(color) }}" class="icon icon0" 
	xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100">
	<!-- window frame -->
	<rect stroke-width="3" rx="1" x="15" y="25" width="70" height="4" />
	<rect stroke-width="3" rx="1" x="18" y="28" width="64" height="45" fill="none" />
	<rect stroke-width="1" rx="1" x="49" y="28" width="2" height="45" />
	
	<!-- window wings with place holders for transormation -->
	<rect id="wing_l" stroke-width="3" opacity="1" rx="1" x="18" y="28" width="32" height="45" fill="none" transform="translate(0,0) skewY(0) scale(1, 1)"/>
	<rect id="handle_l" stroke-width="3" rx="1" x="46" y="50" width="3" height="2" transform="translate(0,0) skewY(0) scale(1, 1)" />
	<rect id="wing_r" stroke-width="3" opacity="1" rx="1" x="50" y="28" width="32" height="45" fill="none" transform="translate(0, 0) skewY(0) scale(1, 1)"/>
	<rect id="handle_r" stroke-width="3" rx="1" x="51" y="50" width="3" height="2" transform="translate(0, 0) skewY(0) scale(1, 1)" />
	
	<!-- place holder for grid function representing the shutter (.js widget adds lines here) -->
	<g stroke-width ="2.5" opacity=".8">
	</g>
</svg>
{% endmacro %}


/******************************************************************************
 * D E P R E C A T E D  W I D G E T S
 ******************************************************************************/
