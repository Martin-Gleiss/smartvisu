/* smartVISU, Martin Glei√ü, 2012 - 2015, GPL [http://www.gnu.de] */
$(document).on("pagebeforeshow",function(){$('a[data-widget="basic.button"]').on({click:function(b){b.stopPropagation();""!=$(this).attr("data-val")&&io.write($(this).attr("data-item"),$(this).attr("data-val"))}});$('input[data-widget="basic.checkbox"]').on({update:function(b,a){b.stopPropagation();$(this).prop("checked",0!=a).checkboxradio("refresh")},change:function(b){b.stopPropagation();io.write($(this).attr("data-item"),$(this).prop("checked")?1:0)}});$('a[data-widget="basic.colordisc"]').on({update:function(b,
a){b.stopPropagation();var c=$(this).attr("data-max");$("#"+this.id+" span").css("background-color","rgb("+Math.round(a[0]/c*255)+","+Math.round(a[1]/c*255)+","+Math.round(a[2]/c*255)+")")},click:function(b){b.stopPropagation();$("#"+this.id+"-screen").removeClass("hide").addClass("in");var a=$(this).offset();b=$("#"+this.id+"-disc");var c=a.top-b.height()/2+15,a=a.left-b.width()/2+25;b.css("top",c.limit(5,$(window).height()+$(document).scrollTop()-b.height()-5,1));b.css("left",a.limit(5,$(window).width()-
b.width()-5,1));b.show()}});$('div[data-widget="basic.colordisc"]').on({click:function(b){b.stopPropagation();b=this.id.substr(0,this.id.length-7);$("#"+b+"-disc").hide();$("#"+b+"-screen").removeClass("in").addClass("hide")}});$('canvas[data-widget="basic.colordisc"]').on({init:function(b){b.stopPropagation();b=parseFloat($(this).attr("data-colors"));var a=$(this)[0],c=100/($(this).attr("data-step")/2),d=Math.PI/(b+2)*2,e=-(Math.PI/2)+d,f=16.875/($(this).attr("data-step")/8),g=360/b;a.width=280;
a.height=280;if(a.getContext){a=a.getContext("2d");a.beginPath();a.fillStyle="#888";a.shadowColor="rgba(96,96,96,0.4)";a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowBlur=4;a.arc(139,139,139,0,2*Math.PI,!1);a.fill();a.beginPath();a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.fillStyle="#555";a.arc(139,139,138,0,2*Math.PI,!1);a.fill();for(var k,l=0;l<=b;l++){var m=e+l*d,n=1,p=l*g;for(k=c;100>=k;k+=c)a.beginPath(),a.fillStyle=fx.hsv2rgb(p,100,k),a.arc(139,139,n*f+f+1,m,m+d+.01,!1),a.arc(139,139,
n*f,m+d+.01,m,!0),a.fill(),n+=1;for(k=100-c;k>=c;k-=c)a.beginPath(),a.fillStyle=fx.hsv2rgb(p,k,100),a.arc(139,139,n*f+f+1,m,m+d+.01,!1),a.arc(139,139,n*f,m+d+.01,m,!0),a.fill(),n+=1}--l;m=e+l*d;n=1;p=l*g;for(k=c;100>=k;k+=c/2)a.beginPath(),a.fillStyle=fx.hsv2rgb(p,0,k),a.arc(139,139,n*f+f+1,m,m+2*d+.01,!1),a.arc(139,139,n*f,m+2*d+.01,m,!0),a.fill(),n+=1;a.beginPath();a.fillStyle="rgb(0,0,0)";a.arc(139,139,f+1,0,2*Math.PI,!1);a.fill()}},click:function(b){b.stopPropagation();var a=this.id.substr(0,
this.id.length-5),c=$(this)[0].getContext("2d"),d=$(this).offset();b=c.getImageData(Math.round(b.pageX-d.left),Math.round(b.pageY-d.top),1,1).data;c=$("#"+a).attr("data-max");d=$("#"+a).attr("data-item").explode();io.write(d[0],Math.round(b[0]/255*c));io.write(d[1],Math.round(b[1]/255*c));io.write(d[2],Math.round(b[2]/255*c));$(this).hide();$("#"+a+"-screen").removeClass("in").addClass("hide")}});$('a[data-widget="basic.dual"]').on({update:function(b,a){b.stopPropagation();$(this).val(a);$(this).trigger("draw")},
draw:function(b){b.stopPropagation();$(this).val()==$(this).attr("data-val-on")?($("#"+this.id+"-off").hide(),$("#"+this.id+"-on").show()):($("#"+this.id+"-on").hide(),$("#"+this.id+"-off").show())},click:function(b){b.stopPropagation();io.write($(this).attr("data-item"),$(this).val()==$(this).attr("data-val-off")?$(this).attr("data-val-on"):$(this).attr("data-val-off"))}});$('a[data-widget="basic.multistate"]').on({update:function(b,a){b.stopPropagation();list_val=$(this).attr("data-vals").explode();
list_img=$(this).attr("data-img").explode();idx=list_val.indexOf(a.toString());$("#"+this.id+" img").attr("src",list_img[idx]);$(this).val(idx)},click:function(b){b.stopPropagation();list_val=$(this).attr("data-vals").explode();old_idx=parseInt($(this).val());b=old_idx+1;b>=list_val.length&&(b=0);io.write($(this).attr("data-item"),list_val[b]);$(this).val(b)}});$('select[data-widget="basic.flip"]').on({update:function(b,a){b.stopPropagation();$(this).val(0<a?"on":"off").slider("refresh")},change:function(b){b.stopPropagation();
io.write($(this).attr("data-item"),"on"==$(this).val()?1:0)}});$('[data-widget="basic.float"]').on({update:function(b,a){b.stopPropagation();""!=$(this).attr("data-unit")?$("#"+this.id).html(parseFloat(a).transUnit($(this).attr("data-unit"))):$("#"+this.id).html(parseFloat(a).transFloat())}});$('[data-widget="basic.formula"]').on({update:function(b,a){b.stopPropagation();var c=0,d=0,e=$(this).attr("data-unit"),f=$(this).attr("data-formula").substring(0,3),g=$(this).attr("data-formula");if("date"==
e||"time"==e||"short"==e||"long"==e)c=new Date(a[0]),$("#"+this.id).html(c.transUnit(e));else{if(-1<g.indexOf("VAR1")){for(d=0;d<a.length;d++)g=eval("formula.replace(/VAR"+(d+1)+"/g, response[i]);");c=eval(g)}else{"SUB"==f&&(c=a[d],d++);for(;d<a.length;d++)c="SUB"==f?c-a[d]:c+a[d];"AVG"==f&&(c/=d);""!=f&&(c=eval(g.replace(/VAR/g,c).replace(/AVG/g,"").replace(/SUM/g,"").replace(/SUB/g,"")))}$("#"+this.id).html(parseFloat(c).transUnit(e))}}});$('a[data-widget="basic.rgb"]').on({update:function(b,a){b.stopPropagation();
var c=$(this).attr("data-max");$("#"+this.id+" span").css("background-color","rgb("+Math.round(a[0]/c*255)+","+Math.round(a[1]/c*255)+","+Math.round(a[2]/c*255)+")")}});$('div[data-widget="basic.rgb-popup"] > div').on({click:function(b){b.stopPropagation();b=$(this).css("background-color");b=b.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);var a=$(this).parent().attr("data-max"),c=$(this).parent().attr("data-item").explode();io.write(c[0],Math.round(b[1]/255*a));io.write(c[1],Math.round(b[2]/255*a));io.write(c[2],
Math.round(b[3]/255*a));$(this).parent().popup("close")},mouseenter:function(b){b.stopPropagation();$(this).addClass("ui-focus")},mouseleave:function(b){b.stopPropagation();$(this).removeClass("ui-focus")}});$('span[data-widget="basic.shifter"]').on({update:function(b,a){b.stopPropagation();var c=Math.min(10*(a[0]/$(this).attr("data-max")*10+.49).toFixed(0),100);0!=a[1]&&0<c?$("#"+this.id+" img").attr("src",$(this).attr("data-pic-on").replace("00",c)):$("#"+this.id+" img").attr("src",$(this).attr("data-pic-off"))},
click:function(b){b.stopPropagation();b=$(this).attr("data-item").explode();$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?io.write(b[1],1):io.write(b[1],0)}});$(document).delegate('span[data-widget="basic.shifter"] > a > img',"hover",function(b){"mouseenter"===b.type?$(this).addClass("ui-focus"):$(this).removeClass("ui-focus")});$('div[data-widget="basic.shutter"]').on({update:function(b,a){b.stopPropagation();var c=13,d="half"==$(this).attr("data-mode")?.5:1;void 0!==a[1]&&(c=parseInt(13/
d*(a[1]/$(this).attr("data-max")+d-1)));for(var e=parseInt(182*a[0]/$(this).attr("data-max")),f=12;1<=f;f--)if(14<=e){var g=13-Math.abs(c),d="height: "+(e>14*f&&13==c?14-g:15-g)+"px;",d=13!=c?d+("margin-top: "+(14<=e-15?g:parseInt(g/2))+"px;"):d+("border-top: 1px dotted "+(e>14*f?"#ccc":"#333")+";");0<c?$("#"+this.id+"-"+f).attr("class","blade-pos"):$("#"+this.id+"-"+f).attr("class","blade-neg");$("#"+this.id+"-"+f).attr("style",d);e-=15}else d="height: "+e+"px;",d+="border-top: 1px dotted #aaa;",
$("#"+this.id+"-"+f).attr("style",d),e=1},click:function(b){b.stopPropagation();var a=$(this).offset(),c=Math.round(b.pageX-a.left);b=Math.floor(((b.pageY-a.top)/160-.0625)*$(this).attr("data-max")/$(this).attr("data-step"))*$(this).attr("data-step");b=b.limit($(this).attr("data-min"),$(this).attr("data-max"),1);a=$(this).attr("data-item").explode();""!=a[1]&&52<c?io.write(a[1],b):io.write(a[0],b)},mouseenter:function(b){b.stopPropagation();$("#"+this.id+" .control").fadeIn(400)},mouseleave:function(b){b.stopPropagation();
$("#"+this.id+" .control").fadeOut(400)}});$('input[data-widget="basic.slider"]').on({update:function(b,a){b.stopPropagation();$(this).attr("lock",1);$("#"+this.id).val(a).slider("refresh").attr("mem",$(this).val())},slidestop:function(b){b.stopPropagation();$(this).val()!=$(this).attr("mem")&&io.write($(this).attr("data-item"),$(this).val())},change:function(b){b.stopPropagation();(void 0===$(this).attr("timer")||0==$(this).attr("timer")&&0==$(this).attr("lock"))&&$(this).val()!=$(this).attr("mem")&&
(void 0!==$(this).attr("timer")&&$(this).trigger("click"),$(this).attr("timer",1),setTimeout("$('#"+this.id+"').attr('timer', 0);",400));$(this).attr("lock",0)},click:function(b){b.stopPropagation();io.write($(this).attr("data-item"),$(this).val())}});$('span[data-widget="basic.switch"]').on({update:function(b,a){b.stopPropagation();$(this).val(a);$(this).trigger("draw")},click:function(b){b.stopPropagation();io.write($(this).attr("data-item"),$(this).val()==$(this).attr("data-val-off")?$(this).attr("data-val-on"):
$(this).attr("data-val-off"))},draw:function(b){b.stopPropagation();$(this).val()==$(this).attr("data-val-on")?($("#"+this.id+"-off").hide(),$("#"+this.id+"-on").show()):($("#"+this.id+"-on").hide(),$("#"+this.id+"-off").show())}});$('span[data-widget="basic.switch.v1"]').on({update:function(b,a){b.stopPropagation();$("#"+this.id+" img").attr("src",a==$(this).attr("data-val-on")?$(this).attr("data-pic-on"):$(this).attr("data-pic-off"))},click:function(b){b.stopPropagation();$("#"+this.id+" img").attr("src")==
$(this).attr("data-pic-off")?io.write($(this).attr("data-item"),$(this).attr("data-val-on")):io.write($(this).attr("data-item"),$(this).attr("data-val-off"))}});$('span[data-widget="basic.switch.v1"] > a > img',"hover").on({update:function(b,a){b.stopPropagation();"mouseenter"===b.type?$(this).addClass("ui-focus"):$(this).removeClass("ui-focus")}});$('span[data-widget="basic.symbol"]').on({update:function(b,a){b.stopPropagation();var c="and"==$(this).attr("data-mode");if(a instanceof Array)for(var d=
0;d<a.length;d++)c="and"==$(this).attr("data-mode")?c&&a[d]==$(this).attr("data-val"):c||a[d]==$(this).attr("data-val");else c=a==$(this).attr("data-val");$("#"+this.id+" img").attr("title",new Date);c?$("#"+this.id).show():$("#"+this.id).hide()}});$('div[data-widget="basic.tank"]').on({update:function(b,a){b.stopPropagation();$("#"+this.id+" div").css("height",Math.round(180*Math.min(a/$(this).attr("data-max"),1)))}});$('[data-widget="basic.text"]').on({update:function(b,a){b.stopPropagation();$("#"+
this.id).html(a==$(this).attr("data-val-on")?$(this).attr("data-txt-on"):$(this).attr("data-txt-off"))}});$('a[data-widget="basic.trigger"]').on({click:function(b){b.stopPropagation();io.trigger($(this).attr("data-name"),$(this).attr("data-val"))}});$('[data-widget="basic.value"]').on({update:function(b,a){b.stopPropagation();var c=$(this).attr("data-unit");if("date"==c||"time"==c||"short"==c||"long"==c){var d=new Date(a);$("#"+this.id).html(d.transUnit(c))}else""!=c&&$.isNumeric(a)?$("#"+this.id).html(parseFloat(a).transUnit(c)):
$("#"+this.id).html(a)}});$('span[data-widget="clock.iconclock"]').on({repeat:function(b){b.stopPropagation();b=Math.floor((new Date-(new Date).setHours(0,0,0,0))/1E3/60);$("#"+this.id+" svg").trigger("update",[[b],[0]])}});$('span[data-widget="clock.miniclock"]').on({repeat:function(b){b.stopPropagation();b=new Date;$(".miniclock").html(b.getHours()+":"+(10>b.getMinutes()?"0"+b.getMinutes():b.getMinutes()))}});$('div[data-widget="device.codepad"]').on({keyup:function(b){b.stopPropagation();13==b.keyCode&&
$("#"+this.id+"-ok").click()}});$('div[data-widget="device.codepad"] > div > a').on({click:function(b){b.stopPropagation();var a=$(this).parent().parent();b=$("#"+a.attr("id")+"-code");var c=$(this).attr("data-val");"ok"==c?a.attr("data-val")==b.val()?($('div[data-bind="'+a.attr("data-id")+'"]').attr("data-access",(new Date).getTime()).removeClass("codepad"),setTimeout(function(){$('div[data-bind="'+a.attr("data-id")+'"]').attr("data-access","").addClass("codepad")},(new Date).duration(a.attr("data-duration")).valueOf()),
a.popup("close")):(b.val(""),$("#"+a.attr("id")).addClass("ui-focus"),setTimeout(function(){$("#"+a.attr("id")).removeClass("ui-focus")},400)):"-"==c?b.val(""):b.val(b.val()+c)}});$('div[data-widget="device.rtr"] > div > a[data-icon="minus"]').on({click:function(b,a){b.stopPropagation();var c=$(this).parent().parent().attr("id"),d=$("#"+c).attr("data-step"),c=$("#"+c+"set").attr("data-item"),d=(Math.round(10*(widget.get(c)-d))/10).toFixed(1);io.write(c,d)}});$('div[data-widget="device.rtr"] > div > a[data-icon="plus"]').on({click:function(b,
a){b.stopPropagation();var c=$(this).parent().parent().attr("id"),d=$("#"+c).attr("data-step"),c=$("#"+c+"set").attr("data-item"),d=(Math.round(10*(1*widget.get(c)+1*d))/10).toFixed(1);io.write(c,d)}});$('div[data-widget="plot.comfortchart"]').on({update:function(b,a){b.stopPropagation();var c=$(this).attr("data-label").explode(),d=$(this).attr("data-axis").explode(),e=[];e[0]={type:"area",name:c[0],lineWidth:0,data:[[17,35],[16,75],[17,85],[21,80],[25,60],[27,35],[25,19],[20,20],[17,35]]};e[1]={type:"area",
name:c[1],lineWidth:0,data:[[17,75],[22.5,65],[25,33],[18.5,35],[17,75]]};e[2]={name:"point",data:[[1*a[0],1*a[1]]],marker:{enabled:!0,lineWidth:2,radius:6,symbol:"circle"},showInLegend:!1};$("#"+this.id).highcharts({series:e,xAxis:{min:10,max:35,title:{text:d[0],align:"high",margin:-2}},yAxis:{min:0,max:100,title:{text:d[1],margin:7}},plotOptions:{area:{enableMouseTracking:!1}},tooltip:{formatter:function(){return this.x.transUnit("temp")+" / "+this.y.transUnit("%")}}})},point:function(b,a){b.stopPropagation();
var c=$("#"+this.id).highcharts(),d=c.series[2].data[0];a[0]||(a[0]=d.x);a[1]||(a[1]=d.y);c.series[2].data[0].update([1*a[0],1*a[1]],!0)}});$('div[data-widget="plot.multiaxis"]').on({update:function(b,a){b.stopPropagation();var c=[];$(this).attr("data-ymin")&&(c=$(this).attr("data-ymin").explode());var d=[];$(this).attr("data-ymax")&&(d=$(this).attr("data-ymax").explode());var e=$(this).attr("data-label").explode(),f=$(this).attr("data-color").explode(),g=$(this).attr("data-exposure").explode(),k=
$(this).attr("data-axis").explode(),l=$(this).attr("data-zoom"),m=[];$(this).attr("data-assign")&&(m=$(this).attr("data-assign").explode());var n=[];$(this).attr("data-opposite")&&(n=$(this).attr("data-opposite").explode());var p=[];$(this).attr("data-ycolor")&&(p=$(this).attr("data-ycolor").explode());var r=[],q=[],h;for(h=0;h<a.length;h++)r[h]={type:"stair"!=g[h]?g[h]:"line",step:"stair"==g[h]?"left":!1,name:e[h],data:a[h],color:f[h]?f[h]:null,yAxis:m[h]?m[h]-1:0};for(h=0;h<k.length-1;h++)q[h]=
{min:c[h]?c[h]:null,max:d[h]?d[h]:null,title:{text:k[h+1]},opposite:0<n[h],minPadding:.05,maxPadding:.05,endOnTick:!1,startOnTick:!1},p[h]&&(q[h].lineColor=p[h],q[h].tickColor=p[h]);l?$("#"+this.id).highcharts({chart:{zoomType:"x"},series:r,xAxis:{type:"datetime",title:{text:k[0]},minRange:(new Date).duration(l).valueOf()},yAxis:q}):$("#"+this.id).highcharts({series:r,xAxis:{type:"datetime",title:{text:k[0]}},yAxis:q})},point:function(b,a){b.stopPropagation();var c=$(this).attr("data-count");1>c&&
(c=100);for(var d=0;d<a.length;d++)if(a[d]){for(var e=$("#"+this.id).highcharts(),f=0;f<a[d].length;f++)e.series[d].addPoint(a[d][f],!1,e.series[d].data.length>=c);e.redraw()}}});$('div[data-widget="plot.period"]').on({update:function(b,a){b.stopPropagation();for(var c=$(this).attr("data-label").explode(),d=$(this).attr("data-color").explode(),e=$(this).attr("data-exposure").explode(),f=$(this).attr("data-axis").explode(),g=$(this).attr("data-zoom"),k=[],l=0;l<a.length;l++)k[l]={type:"stair"!=e[l]?
e[l]:"line",step:"stair"==e[l]?"left":!1,name:c[l],data:a[l],color:d[l]?d[l]:null};g?$("#"+this.id).highcharts({chart:{zoomType:"x"},series:k,xAxis:{type:"datetime",title:{text:f[0]},minRange:(new Date).duration(g).valueOf()},yAxis:{min:$(this).attr("data-ymin"),max:$(this).attr("data-ymax"),title:{text:f[1]}}}):$("#"+this.id).highcharts({series:k,xAxis:{type:"datetime",title:{text:f[0]}},yAxis:{min:$(this).attr("data-ymin"),max:$(this).attr("data-ymax"),title:{text:f[1]}}})},point:function(b,a){b.stopPropagation();
var c=$(this).attr("data-count");1>c&&(c=100);for(var d=0;d<a.length;d++)if(a[d]){for(var e=$("#"+this.id).highcharts(),f=0;f<a[d].length;f++)e.series[d].addPoint(a[d][f],!1,e.series[d].data.length>=c);e.redraw()}}});$('div[data-widget="plot.rtr"]').on({update:function(b,a){b.stopPropagation();for(var c=$(this).attr("data-label").explode(),d=$(this).attr("data-axis").explode(),e=a[2],f=e[0][0],g=0,k=1;k<e.length;k++)g+=e[k-1][1]*(e[k][0]-f),f=e[k][0];g/=f-e[0][0];1>g?g*=100:100<g&&(g=g/255*100);$("#"+
this.id).highcharts({chart:{type:"line"},series:[{name:c[0],data:a[0],type:"spline"},{name:c[1],data:a[1],dashStyle:"shortdot",step:"left"},{type:"pie",name:"\u2211  On: ",data:[{name:"On",y:g},{name:"Off",y:100-g,color:null}],center:["95%","90%"],size:35,showInLegend:!1,dataLabels:{enabled:!1}}],xAxis:{type:"datetime"},yAxis:{min:$(this).attr("data-min"),max:$(this).attr("data-max"),title:{text:d[1]}},tooltip:{formatter:function(){return this.series.name+" <b>"+(this.percentage?this.y.transUnit("%"):
this.y.transUnit("temp"))+"</b>"}}})},point:function(b,a){b.stopPropagation();var c=$(this).attr("data-count");1>c&&(c=100);for(var d=0;d<a.length;d++){var e=$("#"+this.id).highcharts();if(a[d]&&(0==d||1==d))for(var f=0;f<a[d].length;f++)e.series[d].addPoint(a[d][f],!1,e.series[d].data.length>=c);e.redraw()}}});$('div[data-widget="plot.temprose"]').on({update:function(b,a){b.stopPropagation();var c=$(this).attr("data-label").explode(),d=$(this).attr("data-axis").explode(),e=parseInt($(this).attr("data-count")),
f=[];f[0]={name:c[0],pointPlacement:"on",data:a.slice(0,e)};a.slice(e).length==e&&(f[1]={name:c[1],pointPlacement:"on",data:a.slice(e),dashStyle:"shortdot"});$("#"+this.id).highcharts({chart:{polar:!0,type:"line",marginLeft:10},series:f,xAxis:{categories:d,tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0},tooltip:{formatter:function(){return this.x+" - "+this.series.name+": <b>"+this.y.transUnit("temp")+"</b>"}},legend:{x:10,layout:"vertical"}})},point:function(b,
a){b.stopPropagation();var c=$("#"+this.id).highcharts(),d=c.series[2].data[0];a[0]||(a[0]=d.x);a[1]||(a[1]=d.y);c.series[2].data[0].update([1*a[0],1*a[1]],!0)}});$('span[data-widget="status.collapse"]').on({update:function(b,a){b.stopPropagation();0!=a[0]?($('div[data-bind="'+$(this).attr("data-id")+'"]').not(".ui-collapsible").show().trigger("expand"),$('div[data-bind="'+$(this).attr("data-id")+'"].ui-popup').popup("open")):($('div[data-bind="'+$(this).attr("data-id")+'"]').not(".ui-collapsible").hide().trigger("collapse"),
$('div[data-bind="'+$(this).attr("data-id")+'"].ui-popup').popup("close"))}});$('span[data-widget="status.log"]').on({update:function(b,a){b.stopPropagation();var c,d="";if(a[0]instanceof Array){for(var e=a[0].slice(0,$(this).attr("data-count")),f=0;f<e.length;f++)c='<div class="color '+e[f].level.toLowerCase()+'"></div>',c+="<h3>"+(new Date(e[f].time)).transLong()+"</h3>",c+="<p>"+e[f].message+"</p>",d+='<li data-icon="false">'+c+"</li>";$("#"+this.id+" ul").html(d).trigger("prepare").listview("refresh").trigger("redraw")}}});
$('span[data-widget="status.notify"]').on({update:function(b,a){b.stopPropagation();0!=a[0]&&(notify.add($(this).attr("data-mode"),$(this).attr("data-signal"),$("#"+this.id+" h1").html(),"<b>"+a[1]+"</b><br  />"+$("#"+this.id+" p").html()),notify.display())}});$('span[data-widget="status.message"]').on({update:function(b,a){b.stopPropagation();0!=a[0]?($("#"+this.id+"-message p span").html(a[1]?"<b>"+a[1]+"</b><br />":""),$("#"+this.id+"-message .stamp").html(a[2]?(new Date(a[2])).transShort():(new Date).transShort()),
$("#"+this.id+"-message").popup("open")):$("#"+this.id+"-message").popup("close")}});$('svg[data-widget^="icon."]').on({update:function(b,a){b.stopPropagation();a instanceof Array&&this.setAttributeNS(null,"class","icon"+(a[0]&&a[1]?" icon1":" icon0"))},click:function(b){b.stopPropagation();$(this).attr("data-item")&&(b=$(this).attr("data-item").explode(),b[1]&&io.write(b[1],0==widget.get(b[1])?1:0))}});$('svg[data-widget="icon.arrow"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*
2*Math.PI,d=[],d=d.concat([50,50],fx.rotate([25,50],c,[50,50]),fx.rotate([50,18],c,[50,50]),fx.rotate([75,50],c,[50,50]),[50,50]);$("#"+this.id+" #line0").attr("points",d.toString());d=[];d=d.concat(fx.rotate([32,50],c,[50,50]),fx.rotate([32,60],c,[50,50]),fx.rotate([68,60],c,[50,50]),fx.rotate([68,50],c,[50,50]));$("#"+this.id+" #line1").attr("points",d.toString())}});$('svg[data-widget="icon.battery"]').on({update:function(b,a){b.stopPropagation();var c=6*Math.floor(a[0]/$(this).attr("data-max")*
40/6);fx.grid(this,c,[39,68],[61,28])}});$('svg[data-widget="icon.blade"]').on({update:function(b,a){b.stopPropagation();for(var c=a[0]/$(this).attr("data-max")*.4*Math.PI,d,e=0;3>=e;e++)d=[],d=d.concat(fx.rotate([37,20+20*e],c,[50,20+20*e]),fx.rotate([63,20+20*e],c,[50,20+20*e])),$("#"+this.id+" #blade"+e).attr("points",d.toString())}});$('svg[data-widget="icon.blade_z"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*.5*Math.PI*-1,d=[],d=d.concat(fx.rotate([25,
25],c,[50,30]),fx.rotate([45,25],c,[50,30]),fx.rotate([55,35],c,[50,30]),fx.rotate([75,35],c,[50,30]));$("#"+this.id+" #blade0").attr("points",d.toString());d=[];d=d.concat(fx.rotate([25,65],c,[50,70]),fx.rotate([45,65],c,[50,70]),fx.rotate([55,75],c,[50,70]),fx.rotate([75,75],c,[50,70]));$("#"+this.id+" #blade1").attr("points",d.toString())}});$('svg[data-widget="icon.blade_arc"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*-.7*Math.PI+.35*Math.PI,d;d="M "+fx.rotate([30,
40],c,[50,37])+" Q "+fx.rotate([50,22],c,[50,30])+" "+fx.rotate([70,40],c,[50,37]);$("#"+this.id+" #blade0").attr("d",d);d="M "+fx.rotate([30,80],c,[50,77])+" Q "+fx.rotate([50,62],c,[50,70])+" "+fx.rotate([70,80],c,[50,77]);$("#"+this.id+" #blade1").attr("d",d)}});$('svg[data-widget="icon.clock"]').on({update:function(b,a){b.stopPropagation();var c=a[0]%60/60*2*Math.PI;$("#"+this.id+" #hand_l").attr("points","50,50 "+fx.rotate([50,30],c,[50,50]).toString());c=5*Math.floor(a[0]/60)/60*2*Math.PI;$("#"+
this.id+" #hand_s").attr("points","50,50 "+fx.rotate([50,35],c,[50,50]).toString())}});$('svg[data-widget="icon.compass"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*2*Math.PI,d=[],d=d.concat(fx.rotate([40,50],c,[50,50]),fx.rotate([50,25],c,[50,50]),fx.rotate([60,50],c,[50,50]));$("#"+this.id+" #pin0").attr("points",d.toString());d=[];d=d.concat(fx.rotate([40,50],c,[50,50]),fx.rotate([50,75],c,[50,50]),fx.rotate([60,50],c,[50,50]));$("#"+this.id+" #pin1").attr("points",
d.toString())}});$('svg[data-widget="icon.graph"]').on({update:function(b,a){b.stopPropagation();var c=Math.round(a[0]/$(this).attr("data-max")*70),d=$("#"+this.id+" #graph").attr("d").substr(8),e=d.split("L");8<e.length&&e.shift();for(var d="M 15,85 ",f=1;f<e.length;f++)d+="L "+(10*f+5)+","+e[f].substr(e[f].indexOf(",")+1).trim()+" ";$("#"+this.id+" #graph").attr("d",d+"L "+(10*f+5)+","+(85-c))}});$(document).delegate('svg[data-widget="icon.light"]',{update:function(b,a){var c=Math.round(a[0]/$(this).attr("data-max")*
10),d=1;$("#"+this.id+" g#light-rays line").each(function(){$(this).css("visibility",c>=d?"visible":"hidden");d++})}});$('svg[data-widget="icon.meter"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*.44*Math.PI;$("#"+this.id+" #pointer").attr("points","50,85 "+fx.rotate([15,48],c,[50,85]).toString())}});$('svg[data-widget="icon.shutter"]').on({update:function(b,a){b.stopPropagation();var c=Math.round(a[0]/$(this).attr("data-max")*38);fx.grid(this,c,[14,30],[86,
68])}});$('svg[data-widget="icon.ventilation"]').on({update:function(b,a){b.stopPropagation();var c=4.5*(1-a[0]/$(this).attr("data-max"))+.5;$("#"+this.id+" #anim").attr("dur",0<a[0]?c:0)}});$('svg[data-widget="icon.volume"]').on({update:function(b,a){b.stopPropagation();var c=Math.round(a[0]/$(this).attr("data-max")*71);fx.bar(this,c,[18,68],[89,50])}});$('svg[data-widget="icon.windmill"]').on({update:function(b,a){b.stopPropagation();var c=4.5*(1-a[0]/$(this).attr("data-max"))+.5;$("#"+this.id+
" #anim").attr("dur",0<a[0]?c:0)}});$('svg[data-widget="icon.windrose"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*2*Math.PI,d=[],d=d.concat(fx.rotate([50,60],c,[50,50]),fx.rotate([37,71],c,[50,50]),fx.rotate([50,29],c,[50,50]));$("#"+this.id+" #pin0").attr("points",d.toString());d=[];d=d.concat(fx.rotate([50,60],c,[50,50]),fx.rotate([63,71],c,[50,50]),fx.rotate([50,29],c,[50,50]));$("#"+this.id+" #pin1").attr("points",d.toString())}});$('svg[data-widget="icon.windsock"]').on({update:function(b,
a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*.45*Math.PI,d=[],d=d.concat(fx.rotate([70,40],c,[80,22]),[80,22],fx.rotate([90,40],c,[80,22]));$("#"+this.id+" #top").attr("points",d.toString());for(var e=0;3>e;e++)d=[],d=d.concat(fx.rotate([71+2*e,50+14*e],c,[80,22]),fx.rotate([89-2*e,50+14*e],c,[80,22]),fx.rotate([88-2*e,54+14*e],c,[80,22]),fx.rotate([72+2*e,54+14*e],c,[80,22])),$("#"+this.id+" #part"+e).attr("points",d.toString());d=[];d=d.concat(fx.rotate([70,40],c,[80,22]),fx.rotate([76,
82],c,[80,22]),fx.rotate([84,82],c,[80,22]),fx.rotate([90,40],c,[80,22]));$("#"+this.id+" #part3").attr("points",d.toString())}});$('svg[data-widget="icon.zenith"]').on({update:function(b,a){b.stopPropagation();var c=a[0]/$(this).attr("data-max")*Math.PI;pt=fx.rotate([10,90],c,[50,90]);$("#"+this.id+" #sun").attr("x",pt[0]-50);$("#"+this.id+" #sun").attr("y",pt[1]-50)}})}); 
