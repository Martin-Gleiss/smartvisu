var widget={buffer:new Object(),explode:function(text){var ret=Array(),unique=Array();if(text.indexOf(',')>=0){var parts=text.explode();for(var i=0;i<parts.length;i++)if(parts[i]!='')unique[parts[i]]='';for(var part in unique)ret.push(part)}else if(text.trim()!='')ret.push(text.trim());return ret},listening:function(){var ret=false;if($('[id^="'+$.mobile.activePage.attr('id')+'-"][data-item]').size()>0)ret=true;return ret},listeners:function(){var ret=Array(),unique=Array();$('[id^="'+$.mobile.activePage.attr('id')+'-"][data-item]').each(function(idx){var items=widget.explode($(this).attr('data-item'));for(var i=0;i<items.length;i++)unique[items[i]]=''});for(var item in unique)ret.push(item);return ret},list:function(){var widgets=0;$('[data-item]').each(function(idx){if($(this).attr('data-item').trim()!=''){console.log("["+$(this).attr('data-widget')+"] '"+this.id+"' listen on '"+$(this).attr('data-item')+"'");widgets++}});console.log("[widget] --> "+widgets+" listening.")},check:function(values){if(values instanceof Array){for(var i=0;i<values.length;i++)if(values[i]===undefined||values[i]==null)return false}else if(values===undefined||values==null)return false;return true},get:function(items){if(items instanceof Array){var ret=Array();for(var i=0;i<items.length;i++)ret.push(widget.buffer[items[i]])}else var ret=widget.buffer[items];return ret},set:function(item,value){if(widget.buffer[item]instanceof Array);else if(value!==undefined)widget.buffer[item]=($.isNumeric(value)?value*1.0:value)},update:function(item,value){if(value===undefined||widget.buffer[item]!==value||(widget.buffer[item]instanceof Array&&widget.buffer[item].toString()!=value.toString())){widget.set(item,value);$('[data-item*="'+item+'"]').each(function(idx){var items=widget.explode($(this).attr('data-item'));for(var i=0;i<items.length;i++)if(items[i]==item){var values=Array();if($(this).attr('data-widget').substr(0,5)=='plot.'&&$('#'+this.id).highcharts()){for(var j=0;j<items.length;j++)values.push(items[j]==item?value:null);if(value!==undefined&&value!=null){console.log("["+$(this).attr('data-widget')+"] point '"+this.id+"':",values);$(this).trigger('point',[values])}}else{values=widget.get(items);if(widget.check(values)){console.log("["+$(this).attr('data-widget')+"] update '"+this.id+"':",values);$(this).trigger('update',[values])}}}})}},prepare:function(){$('[id^="'+$.mobile.activePage.attr('id')+'-"][data-widget^="plot."][data-item]').each(function(idx){if($('#'+this.id).highcharts())$('#'+this.id).highcharts().destroy()})},refresh:function(){$('[id^="'+$.mobile.activePage.attr('id')+'-"][data-item]').each(function(idx){var values=widget.get(widget.explode($(this).attr('data-item')));if(widget.check(values))$(this).trigger('update',[values])})},plot:function(item){var ret=$();if(item){$('[id^="'+$.mobile.activePage.attr('id')+'-"][data-widget^="plot."][data-item*="'+item+'"]').each(function(idx){var items=widget.explode($(this).attr('data-item'));for(var i=0;i<items.length;i++)if(items[i]==item)ret=ret.add(this)})}else ret=$('[id^="'+$.mobile.activePage.attr('id')+'-"][data-widget^="plot."][data-item]');return ret},is_series:function(item){var pt=item.split('.');return((pt instanceof Array)&&(pt[pt.length-3]=='avg'||pt[pt.length-3]=='sum'||pt[pt.length-3]=='min'||pt[pt.length-3]=='max'))}};$(document).delegate('[data-widget="basic.value"]',{update:function(event,response){$('#'+this.id).html(response+' '+$(this).attr('data-unit'))}});$(document).delegate('[data-widget="basic.float"]',{update:function(event,response){if($(this).attr('data-unit')=='°'){$('#'+this.id).html(parseFloat(response).transTemp())}else if($(this).attr('data-unit')=='%'){$('#'+this.id).html(parseFloat(response).transPercent())}else if($(this).attr('data-unit')=='€'){$('#'+this.id).html(parseFloat(response).transCurrency())}else $('#'+this.id).html(parseFloat(response).transFloat()+' '+$(this).attr('data-unit'))}});$(document).delegate('[data-widget="basic.text"]',{update:function(event,response){$('#'+this.id).html((response==$(this).attr('data-val-on')?$(this).attr('data-txt-on'):$(this).attr('data-txt-off')))}});$(document).delegate('input[data-widget="basic.checkbox"]',{update:function(event,response){$(this).prop('checked',response!=0).checkboxradio('refresh')},change:function(event){io.write($(this).attr('data-item'),($(this).prop('checked')?1:0))}});$(document).delegate('select[data-widget="basic.flip"]',{update:function(event,response){$(this).val(response>0?'on':'off').slider('refresh')},change:function(event){io.write($(this).attr('data-item'),($(this).val()=='on'?1:0))}});$(document).delegate('input[data-widget="basic.slider"]',{update:function(event,response){$(this).attr('lock',1);$('#'+this.id).val(response).slider('refresh').attr('mem',$(this).val())},slidestop:function(event){if($(this).val()!=$(this).attr('mem'))io.write($(this).attr('data-item'),$(this).val())},change:function(event){if(($(this).attr('timer')===undefined||$(this).attr('timer')==0&&$(this).attr('lock')==0)&&($(this).val()!=$(this).attr('mem'))){if($(this).attr('timer')!==undefined)$(this).trigger('click');$(this).attr('timer',1);setTimeout("$('#"+this.id+"').attr('timer', 0);",400)};$(this).attr('lock',0)},click:function(event){io.write($(this).attr('data-item'),$(this).val())}});$(document).delegate('span[data-widget="basic.symbol"]',{update:function(event,response){var bit=($(this).attr('data-mode')=='and');if(response instanceof Array){for(var i=0;i<response.length;i++)if($(this).attr('data-mode')=='and'){bit=bit&&(response[i]==$(this).attr('data-val'))}else bit=bit||(response[i]==$(this).attr('data-val'))}else bit=(response==$(this).attr('data-val'));$('#'+this.id+' img').attr('title',new Date());if(bit){$('#'+this.id).show()}else $('#'+this.id).hide()}});$(document).delegate('span[data-widget="basic.switch"]',{update:function(event,response){$('#'+this.id+' img').attr('src',(response==$(this).attr('data-val-on')?$(this).attr('data-pic-on'):$(this).attr('data-pic-off')))},click:function(event){if($('#'+this.id+' img').attr('src')==$(this).attr('data-pic-off')){io.write($(this).attr('data-item'),$(this).attr('data-val-on'))}else io.write($(this).attr('data-item'),$(this).attr('data-val-off'))}});$(document).delegate('span[data-widget="basic.switch"] > a > img','hover',function(event){if(event.type==='mouseenter'){$(this).addClass("ui-focus")}else $(this).removeClass("ui-focus")});$(document).delegate('span[data-widget="basic.shifter"]',{update:function(event,response){var step=Math.min((response[0]/$(this).attr('data-max')*10+0.49).toFixed(0)*10,100);if(step>0&&response[1]!=0){$('#'+this.id+' img').attr('src',$(this).attr('data-pic-on').replace('00',step))}else if(step>0&&$(this).attr('data-pic-off').substr(-7)=='_00.png'){$('#'+this.id+' img').attr('src',$(this).attr('data-pic-off').replace('00',step))}else $('#'+this.id+' img').attr('src',$(this).attr('data-pic-off'))},click:function(event){var items=$(this).attr('data-item').explode();if(items[1])io.write(items[1],(widget.get(items[1])==0?1:0))}});$(document).delegate('span[data-widget="basic.shifter"] > a > img','hover',function(event){if(event.type==='mouseenter'){$(this).addClass("ui-focus")}else $(this).removeClass("ui-focus")});$(document).delegate('a[data-widget="basic.button"]',{click:function(event){if($(this).attr('data-val')!='')io.write($(this).attr('data-item'),$(this).attr('data-val'))}});$(document).delegate('a[data-widget="basic.dual"]',{update:function(event,response){$('#'+this.id+' img').attr('src',(response==$(this).attr('data-val-on')?$(this).attr('data-pic-on'):$(this).attr('data-pic-off')))},click:function(event){if($('#'+this.id+' img').attr('src')==$(this).attr('data-pic-off')){io.write($(this).attr('data-item'),$(this).attr('data-val-on'))}else io.write($(this).attr('data-item'),$(this).attr('data-val-off'))}});$(document).delegate('div[data-widget="basic.shutter"]',{update:function(event,response){var a=13,mode=($(this).attr('data-mode')=='half'?0.5:1);if(response[1]!==undefined)a=parseInt(13/mode*(response[1]/$(this).attr('data-max')+mode-1));var style,h=parseInt(response[0]*13*14/$(this).attr('data-max'));for(var i=12;i>=1;i--)if(h>=14){var w=13-Math.abs(a);style='height: '+((h>i*14)&&a==13?(14-w):(15-w))+'px;';if(a!=13){style+='margin-top: '+(h-15>=14?w:parseInt(w/2))+'px;'}else style+='border-top: 1px dotted '+(h>i*14?'#ccc':'#333')+';';if(a>0){$('#'+this.id+'-'+i).attr('class','blade-pos')}else $('#'+this.id+'-'+i).attr('class','blade-neg');$('#'+this.id+'-'+i).attr('style',style);h=h-15}else{style='height: '+h+'px;';style+='border-top: 1px dotted #aaa;';$('#'+this.id+'-'+i).attr('style',style);h=1}},click:function(event){var offset=$(this).offset(),x=Math.round(event.pageX-offset.left),y=(event.pageY-offset.top),val=Math.floor((y/160-10/160)*$(this).attr('data-max')/$(this).attr('data-step'))*$(this).attr('data-step');val=val.limit($(this).attr('data-min'),$(this).attr('data-max'),1);var items=$(this).attr('data-item').explode();if(items[1]!=''&&x>52){io.write(items[1],val)}else io.write(items[0],val)},mouseenter:function(event){$('#'+this.id+' .control').fadeIn(400)},mouseleave:function(event){$('#'+this.id+' .control').fadeOut(400)}});$(document).delegate('a[data-widget="basic.rgb"]',{update:function(event,response){var max=$(this).attr('data-max');$('#'+this.id+' span').css('background-color','rgb('+Math.round(response[0]/max*255)+','+Math.round(response[1]/max*255)+','+Math.round(response[2]/max*255)+')')}});$(document).delegate('div[data-widget="basic.rgb-popup"] > div',{click:function(event){var rgb=$(this).css('background-color');rgb=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);var max=$(this).parent().attr('data-max'),items=$(this).parent().attr('data-item').explode();io.write(items[0],Math.round(rgb[1]/255*max));io.write(items[1],Math.round(rgb[2]/255*max));io.write(items[2],Math.round(rgb[3]/255*max));$(this).parent().popup('close')},mouseenter:function(event){$(this).addClass("ui-focus")},mouseleave:function(event){$(this).removeClass("ui-focus")}});$(document).delegate('a[data-widget="basic.colordisc"]',{update:function(event,response){var max=$(this).attr('data-max');$('#'+this.id+' span').css('background-color','rgb('+Math.round(response[0]/max*255)+','+Math.round(response[1]/max*255)+','+Math.round(response[2]/max*255)+')')},click:function(event){$('#'+this.id+'-screen').removeClass('hide').addClass('in');var offset=$(this).offset(),disc=$('#'+this.id+'-disc'),top=offset.top-(disc.height()/2)+15,left=offset.left-(disc.width()/2)+25;disc.css('top',top.limit(5,$(window).height()+$(document).scrollTop()-disc.height()-5,1));disc.css('left',left.limit(5,$(window).width()-disc.width()-5,1));disc.show()}});$(document).delegate('div[data-widget="basic.colordisc"]',{click:function(event){var uid=this.id.substr(0,this.id.length-7);$('#'+uid+'-disc').hide();$('#'+uid+'-screen').removeClass('in').addClass('hide')}});$(document).delegate('canvas[data-widget="basic.colordisc"]',{init:function(event){var colors=parseFloat($(this).attr('data-colors')),size=280,canvas=$(this)[0],step=100/($(this).attr('data-step')/2),arc=Math.PI/(colors+2)*2,startangle=-(Math.PI/2)+arc,gauge=(size-10)/16/($(this).attr('data-step')/8),share=360/colors,ctx;canvas.width=size;canvas.height=size;if(canvas.getContext){var center=size/2-1;ctx=canvas.getContext("2d");ctx.beginPath();ctx.fillStyle='#888';ctx.shadowColor='rgba(96,96,96,0.4)';ctx.shadowOffsetX=2;ctx.shadowOffsetY=2;ctx.shadowBlur=4;ctx.arc(center,center,size/2-1,0,2*Math.PI,false);ctx.fill();ctx.beginPath();ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;ctx.shadowBlur=0;ctx.fillStyle='#555';ctx.arc(center,center,size/2-2,0,2*Math.PI,false);ctx.fill();var v,s;for(var i=0;i<=colors;i++){var angle=startangle+i*arc,ring=1,h=i*share;for(v=step;v<=100;v+=step){ctx.beginPath();ctx.fillStyle=fx.hsv2rgb(h,100,v);ctx.arc(center,center,ring*gauge+gauge+1,angle,angle+arc+0.01,false);ctx.arc(center,center,ring*gauge,angle+arc+0.01,angle,true);ctx.fill();ring+=1};for(s=(100-step);s>=step;s-=step){ctx.beginPath();ctx.fillStyle=fx.hsv2rgb(h,s,100);ctx.arc(center,center,ring*gauge+gauge+1,angle,angle+arc+0.01,false);ctx.arc(center,center,ring*gauge,angle+arc+0.01,angle,true);ctx.fill();ring+=1}};i-=1;angle=startangle+i*arc;ring=1;h=i*share;for(v=step;v<=100;v+=(step/2)){ctx.beginPath();ctx.fillStyle=fx.hsv2rgb(h,0,v);ctx.arc(center,center,ring*gauge+gauge+1,angle,angle+2*arc+0.01,false);ctx.arc(center,center,ring*gauge,angle+2*arc+0.01,angle,true);ctx.fill();ring+=1};ctx.beginPath();ctx.fillStyle='rgb(0,0,0)';ctx.arc(center,center,gauge+1,0,2*Math.PI,false);ctx.fill()}},click:function(event){var uid=this.id.substr(0,this.id.length-5),disc=$(this)[0],ctx=disc.getContext("2d"),offset=$(this).offset(),x=Math.round(event.pageX-offset.left),y=Math.round(event.pageY-offset.top),rgb=ctx.getImageData(x,y,1,1).data,max=$('#'+uid).attr('data-max'),items=$('#'+uid).attr('data-item').explode();io.write(items[0],Math.round(rgb[0]/255*max));io.write(items[1],Math.round(rgb[1]/255*max));io.write(items[2],Math.round(rgb[2]/255*max));$(this).hide();$('#'+uid+'-screen').removeClass('in').addClass('hide')}});$(document).delegate('div[data-widget="basic.tank"]',{update:function(event,response){$('#'+this.id+' div').css('height',Math.round(Math.min(response/$(this).attr('data-max'),1)*180))}});$(document).delegate('span[data-widget="basic.notify"]',{update:function(event,response){if(response[0]!=0){notify.add($(this).attr('data-mode'),$(this).attr('data-signal'),$('#'+this.id+' h1').html(),'<b>'+response[1]+'</b><br />'+$('#'+this.id+' p').html());notify.display()}}});$(document).delegate('div[data-widget="device.rtr"] > div > a[data-icon="minus"]',{click:function(event,response){var uid=$(this).parent().parent().attr('id'),step=$('#'+uid).attr('data-step'),item=$('#'+uid+'set').attr('data-item'),temp=(Math.round((widget.get(item)-step)*10)/10).toFixed(1);io.write(item,temp)}});$(document).delegate('div[data-widget="device.rtr"] > div > a[data-icon="plus"]',{click:function(event,response){var uid=$(this).parent().parent().attr('id'),step=$('#'+uid).attr('data-step'),item=$('#'+uid+'set').attr('data-item'),temp=(Math.round((widget.get(item)*1+step*1)*10)/10).toFixed(1);io.write(item,temp)}});$(document).delegate('div[data-widget="plot.period"]',{update:function(event,response){var label=$(this).attr('data-label').explode(),color=$(this).attr('data-color').explode(),exposure=$(this).attr('data-exposure').explode(),axis=$(this).attr('data-axis').explode(),series=Array();for(var i=0;i<response.length;i++)series[i]={type:(exposure[i]!='stair'?exposure[i]:'line'),step:(exposure[i]=='stair'?'left':false),name:label[i],data:response[i],color:(color[i]?color[i]:null)};$('#'+this.id).highcharts({series:series,xAxis:{type:'datetime',title:{text:axis[0]}},yAxis:{min:$(this).attr('data-ymin'),max:$(this).attr('data-ymax'),title:{text:axis[1]}}})},point:function(event,response){for(var i=0;i<response.length;i++)if(response[i]){var chart=$('#'+this.id).highcharts();for(var j=0;j<response[i].length;j++)chart.series[i].addPoint(response[i][j],false,(chart.series[i].data.length>=100));chart.redraw()}}});$(document).delegate('div[data-widget="plot.period_zoomable"]',{update:function(event,response){var label=$(this).attr('data-label').explode(),color=$(this).attr('data-color').explode(),exposure=$(this).attr('data-exposure').explode(),axis=$(this).attr('data-axis').explode(),minRange=$(this).attr('data-minRange'),series=Array();for(var i=0;i<response.length;i++)series[i]={type:(exposure[i]!='stair'?exposure[i]:'line'),step:(exposure[i]=='stair'?'left':false),name:label[i],data:response[i],color:(color[i]?color[i]:null)};$('#'+this.id).highcharts({chart:{zoomType:'x'},series:series,xAxis:{type:'datetime',title:{text:axis[0]},minRange:minRange},yAxis:{min:$(this).attr('data-ymin'),max:$(this).attr('data-ymax'),title:{text:axis[1]}}})},point:function(event,response){for(var i=0;i<response.length;i++)if(response[i]){var chart=$('#'+this.id).highcharts();for(var j=0;j<response[i].length;j++)chart.series[i].addPoint(response[i][j],false,(chart.series[i].data.length>=100));chart.redraw()}}});$(document).delegate('div[data-widget="plot.rtr"]',{update:function(event,response){var label=$(this).attr('data-label').explode(),axis=$(this).attr('data-axis').explode(),state=response[2],stamp=state[0][0],percent=0;for(var i=1;i<state.length;i++){percent+=state[i-1][1]*(state[i][0]-stamp);stamp=state[i][0]};percent=percent/(stamp-state[0][0]);if(percent<1){percent=percent*100}else if(percent>100)percent=percent/255*100;$('#'+this.id).highcharts({chart:{type:'line'},series:[{name:label[0],data:response[0],type:'spline'},{name:label[1],data:response[1],dashStyle:'shortdot',step:'left'},{type:'pie',name:'∑ On: ',data:[{name:'On',y:percent},{name:'Off',y:(100-percent),color:null}],center:['95%','90%'],size:35,showInLegend:false,dataLabels:{enabled:false}}],xAxis:{type:'datetime'},yAxis:{min:$(this).attr('data-min'),max:$(this).attr('data-max'),title:{text:axis[1]}},tooltip:{formatter:function(){return this.series.name+' <b>'+(this.percentage?this.y.transPercent():this.y.transTemp())+'</b>'}}})},point:function(event,response){for(var i=0;i<response.length;i++){var chart=$('#'+this.id).highcharts();if(response[i]&&(i==0||i==1)){for(var j=0;j<response[i].length;j++)chart.series[i].addPoint(response[i][j],false,(chart.series[i].data.length>=100))}else if(response[i]&&(i==2));chart.redraw()}}});$(document).delegate('div[data-widget="plot.comfortchart"]',{update:function(event,response){var label=$(this).attr('data-label').explode(),axis=$(this).attr('data-axis').explode(),plots=Array();plots[0]={type:'area',name:label[0],lineWidth:0,data:[[17,35],[16,75],[17,85],[21,80],[25,60],[27,35],[25,19],[20,20],[17,35]]};plots[1]={type:'area',name:label[1],lineWidth:0,data:[[17,75],[22.5,65],[25,33],[18.5,35],[17,75]]};plots[2]={name:'point',data:[[response[0]*1.0,response[1]*1.0]],marker:{enabled:true,lineWidth:2,radius:6,symbol:'circle'},showInLegend:false};$('#'+this.id).highcharts({series:plots,xAxis:{min:10,max:35,title:{text:axis[0],align:'high',margin:-2}},yAxis:{min:0,max:100,title:{text:axis[1],margin:7}},plotOptions:{area:{enableMouseTracking:false}},tooltip:{formatter:function(){return this.x.transTemp()+' / '+this.y.transPercent()}}})},point:function(event,response){var chart=$('#'+this.id).highcharts(),point=chart.series[2].data[0];if(!response[0])response[0]=point.x;if(!response[1])response[1]=point.y;chart.series[2].data[0].update([response[0]*1.0,response[1]*1.0],true)}});$(document).delegate('div[data-widget="plot.temprose"]',{update:function(event,response){var label=$(this).attr('data-label').explode(),axis=$(this).attr('data-axis').explode(),count=parseInt($(this).attr('data-count')),plots=Array();plots[0]={name:label[0],pointPlacement:'on',data:response.slice(0,count)};if(response.slice(count).length==count)plots[1]={name:label[1],pointPlacement:'on',data:response.slice(count),dashStyle:'shortdot'};$('#'+this.id).highcharts({chart:{polar:true,type:'line',marginLeft:10},series:plots,xAxis:{categories:axis,tickmarkPlacement:'on',lineWidth:0},yAxis:{gridLineInterpolation:'polygon',lineWidth:0},tooltip:{formatter:function(){return this.x+' - '+this.series.name+': <b>'+this.y.transTemp()+'</b>'}},legend:{x:10,layout:'vertical'}})},point:function(event,response){var chart=$('#'+this.id).highcharts(),point=chart.series[2].data[0];if(!response[0])response[0]=point.x;if(!response[1])response[1]=point.y;chart.series[2].data[0].update([response[0]*1.0,response[1]*1.0],true)}});$(document).delegate('svg[data-widget^="icon."]',{update:function(event,response){if(response instanceof Array)document.getElementById(this.id).setAttributeNS(null,'class','icon'+(response[1]?' icon1':' icon0'))},click:function(event){var items=$(this).attr('data-item').explode();if(items[1])io.write(items[1],(widget.get(items[1])==0?1:0))}});$(document).delegate('svg[data-widget="icon.arrow"]',{update:function(event,response){var ang=response[0]/$(this).attr('data-max')*2*Math.PI,pt=[];pt=pt.concat([50,50],fx.rotate([25,50],ang,[50,50]),fx.rotate([50,18],ang,[50,50]),fx.rotate([75,50],ang,[50,50]),[50,50]);$('#'+this.id+' #line0').attr('points',pt.toString());pt=[];pt=pt.concat(fx.rotate([32,50],ang,[50,50]),fx.rotate([32,60],ang,[50,50]),fx.rotate([68,60],ang,[50,50]),fx.rotate([68,50],ang,[50,50]));$('#'+this.id+' #line1').attr('points',pt.toString())}});$(document).delegate('svg[data-widget="icon.battery"]',{update:function(event,response){var val=Math.round(response[0]/$(this).attr('data-max')*40);fx.grid(this,val,[38,68],[61,28])}});$(document).delegate('svg[data-widget="icon.compass"]',{update:function(event,response){var ang=response[0]/$(this).attr('data-max')*2*Math.PI,pt=[];pt=pt.concat(fx.rotate([40,50],ang,[50,50]),fx.rotate([50,25],ang,[50,50]),fx.rotate([60,50],ang,[50,50]));$('#'+this.id+' #pin0').attr('points',pt.toString());pt=[];pt=pt.concat(fx.rotate([40,50],ang,[50,50]),fx.rotate([50,75],ang,[50,50]),fx.rotate([60,50],ang,[50,50]));$('#'+this.id+' #pin1').attr('points',pt.toString())}});$(document).delegate('svg[data-widget="icon.shutter"]',{update:function(event,response){var val=Math.round(response[0]/$(this).attr('data-max')*38);fx.grid(this,val,[14,30],[86,68])}});$(document).delegate('svg[data-widget="icon.shutterangle"]',{update:function(event,response){fx.rotategrid(this,response[0])}});$(document).delegate('svg[data-widget="icon.shutterangle_z"]',{update:function(event,response){fx.rotategridz(this,response[0])}});$(document).delegate('svg[data-widget="icon.shutterangle_round"]',{update:function(event,response){fx.rotategridbezier(this,response[0])}});$(document).delegate('svg[data-widget="icon.windrose"]',{update:function(event,response){var ang=response[0]/$(this).attr('data-max')*2*Math.PI,pt=[];pt=pt.concat(fx.rotate([50,60],ang,[50,50]),fx.rotate([37,71],ang,[50,50]),fx.rotate([50,29],ang,[50,50]));$('#'+this.id+' #pin0').attr('points',pt.toString());pt=[];pt=pt.concat(fx.rotate([50,60],ang,[50,50]),fx.rotate([63,71],ang,[50,50]),fx.rotate([50,29],ang,[50,50]));$('#'+this.id+' #pin1').attr('points',pt.toString())}});$(document).delegate('svg[data-widget="icon.windsock"]',{update:function(event,response){var ang=response[0]/$(this).attr('data-max')*0.45*Math.PI,pt=[];pt=pt.concat(fx.rotate([70,40],ang,[80,22]),[80,22],fx.rotate([90,40],ang,[80,22]));$('#'+this.id+' #top').attr('points',pt.toString());for(var i=0;i<3;i++){pt=[];pt=pt.concat(fx.rotate([71+i*2,50+i*14],ang,[80,22]),fx.rotate([89-i*2,50+i*14],ang,[80,22]),fx.rotate([88-i*2,54+i*14],ang,[80,22]),fx.rotate([72+i*2,54+i*14],ang,[80,22]));$('#'+this.id+' #part'+i).attr('points',pt.toString())};pt=[];pt=pt.concat(fx.rotate([70,40],ang,[80,22]),fx.rotate([76,82],ang,[80,22]),fx.rotate([84,82],ang,[80,22]),fx.rotate([90,40],ang,[80,22]));$('#'+this.id+' #part3').attr('points',pt.toString())}})