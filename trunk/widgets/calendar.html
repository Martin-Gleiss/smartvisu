/**
 * -----------------------------------------------------------------------------
 * @package     smartVISU
 * @author      Martin Glei√ü
 * @copyright   2012
 * @license     GPL <http://www.gnu.de>
 * ----------------------------------------------------------------------------- 
 */ 
                
 
/**
 * Displays the calendarlist
 *  
 * @param       unique id for this widget
 * @param       a title to display
 * @param       the number of displayed calendar-entries, default 25 
 * @param       a color for this calendar, default grey 
 */ 
{% macro list(id, title, count, color) %}
    /** Design */
    <div id="{{ page }}-{{ id }}-calendarlist" class="calendarlist">
        {% if title %} <h2>{{ title }}</h2> {% endif %}
        <ul data-role="listview">
        </ul>
    </div>
            
    /** Events */
    <script type="text/javascript">
        $('#{{ page }}').live('pagecreate',function(event, ui){
            $.getJSON('lib/calendar/service/{{ config_calendar_service }}.php?url={{ config_calendar_url|url_encode() }}&count={{ count|default(25) }}', function(data) {
                if (data instanceof Array) {
                    var line = '';
                    var sum = 1;
                    for (var i in data) {
                        ret  = '<img style="background: ' + data[i].color + ';" class="icon" src="' + data[i].icon + '" />';
                        ret += '<div class="color" style="background: {{ color|default('#666666') }};"></div>';
                        ret += '<h3>' + data[i].title + '</h3>';
                        ret += '<p>' + data[i].weekday + ',&nbsp;' + data[i].period + '&nbsp;</p>';
                        
                        if (data[i].where)
                            ret += '<span class="ui-li-count">' + data[i].where + '</span>';
                        
                        ret = '<a href="' + (data[i].link ? data[i].link : '#') + '">' + ret + '</a>'; 
                    line += '<li data-icon="false">' + ret + '</li>';
                        }
                } else 
                    line = data;
                
                $('#{{ page }}-{{ id }}-calendarlist ul').html(line).listview('refresh');
            });
        });
    </script>
{% endmacro %}


/**
 * Displays the phonelist from a phone system
 * 
 * @param       unique id for this widget
 * @param       a title to display
 * @param       the number of displayed lines, default 10
 */ 
{% macro sheet(id, title, count) %}
    /** Design */
    <div id="{{ page }}-{{ id }}-phonelist" class="phonelist">
        {% if title %} <h2>{{ title }}</h2> {% endif %}
        <ul data-role="listview">
        </ul>
    </div>
            
    /** Events */
    <script type="text/javascript">
        $('#{{ page }}').live('pagecreate',function(event, ui){
            $.getJSON('lib/phone/service/{{ config_phone_service }}.php', function(data) {
                var line = '';
                var sum = 1;
                for (var i in data) {
                    ret  = '<img class="icon" src="pics/phone/' + data[i].pic + '" />';
                    ret += '<img class="dir" src="lib/phone/pics/' + data[i].dirpic + '" />';
                    ret += '<h3>' + data[i].name + '&nbsp;</h3>';
                    ret += '<p>' + data[i].number + '&nbsp;</p>';
                    ret += '<span class="ui-li-count">' + data[i].date + '</span>';
                    if (data[i].number)
                        ret = '<a href="callto://' + data[i].number + '">' + ret + '</a>'; 
                    
                    line += '<li data-icon="false">' + ret + '</li>';
                    if (sum++ == {{ count|default(10) }}) break;
                }
                
                $('#{{ page }}-{{ id }}-phonelist ul').html(line).listview('refresh');
            });
        });
    </script>
{% endmacro %}
