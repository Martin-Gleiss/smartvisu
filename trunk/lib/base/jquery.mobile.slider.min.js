(function(b,v){b.widget("mobile.slider",b.mobile.widget,{options:{theme:null,trackTheme:null,disabled:!1,initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",mini:!1},_create:function(){var a=this,g=this.element,i=b.mobile.getInheritedTheme(g,"c"),d=this.options.theme||i,i=this.options.trackTheme||i,h=g[0].nodeName.toLowerCase(),e="select"==h?"ui-slider-switch":"",p=g.attr("id"),k=p+"-label",p=b("[for='"+p+"']").attr("id",k),j=function(){return"input"==h?parseFloat(g.val()): g[0].selectedIndex},c="input"==h?parseFloat(g.attr("min")):0,q="input"==h?parseFloat(g.attr("max")):g.find("option").length-1,f=g.attr("orientation"),s=window.parseFloat(g.attr("step")||1),t=this.options.inline||!0==g.jqmData("inline")?" ui-slider-inline":"",x=this.options.mini||g.jqmData("mini")?" ui-slider-mini":"",u=document.createElement("a"),r=b(u),m=document.createElement("div"),n=b(m),l;if(g.jqmData("highlight")&&"select"!=h){l=document.createElement("div");if("semicircle"==f){l.className= "ui-slider-semicircle-highlight-cut";var w=document.createElement("div");w.className="ui-slider-semicircle ui-btn-active";l.appendChild(w)}else l.className="ui-slider-bg ui-btn-active ui-btn-corner-all";l=b(l).prependTo(n)}else l=!1;u.setAttribute("href","#");m.setAttribute("role","application");m.className=["ui-slider"+(f?"-"+f:" "),e," ui-btn-down-",i," ui-btn-corner-all",t,x].join("");u.className="ui-slider-handle"+(f?"-"+f:"");m.appendChild(u);"semicircle"==f&&(e=document.createElement("div"), e.className="ui-slider-semicircle-box",f=document.createElement("div"),f.className="ui-slider-semicircle-cut",e.appendChild(f),f.appendChild(m),t=document.createElement("div"),t.className="ui-slider-semicircle-inner ui-body-"+i,f.appendChild(t),f=document.createElement("div"),f.className="ui-slider-semicircle-bottom "+(l?"ui-btn-active ":"")+"ui-btn-down-"+i,f.style.cssFloat="left",e.appendChild(f),f=document.createElement("div"),f.className="ui-slider-semicircle-bottom ui-btn-down-"+i,f.style.cssFloat= "right",e.appendChild(f),n=b(e));r.buttonMarkup({corners:!0,theme:d,shadow:!0}).attr({role:"slider","aria-valuemin":c,"aria-valuemax":q,"aria-valuenow":j(),"aria-valuetext":j(),title:j(),"aria-labelledby":k});b.extend(this,{slider:n,handle:r,valuebg:l,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1});if("select"===h){d=document.createElement("div");d.className="ui-slider-inneroffset";k=0;for(l=m.childNodes.length;k<l;k++)d.appendChild(m.childNodes[k]);m.appendChild(d);r.addClass("ui-slider-handle-snapping"); m=g.find("option");d=0;for(k=m.length;d<k;d++)l=!d?"b":"a",e=!d?" ui-btn-down-"+i:" "+b.mobile.activeBtnClass,document.createElement("div"),f=document.createElement("span"),f.className=["ui-slider-label ui-slider-label-",l,e," ui-btn-corner-all"].join(""),f.setAttribute("role","img"),f.appendChild(document.createTextNode(m[d].innerHTML)),b(f).prependTo(n);a._labels=b(".ui-slider-label",n)}p.addClass("ui-slider");g.addClass("input"===h?"ui-slider-input":"ui-slider-switch").change(function(){a.mouseMoved|| a.refresh(j(),!0)}).keyup(function(){a.refresh(j(),!0,!0)}).blur(function(){a.refresh(j(),!0)});b(document).bind("vmousemove",function(b){if(a.dragging)return a.mouseMoved=!0,"select"===h&&r.removeClass("ui-slider-handle-snapping"),a.refresh(b),a.userModified=a.beforeStart!==g[0].selectedIndex,!1});n.bind("vmousedown",function(b){a.dragging=!0;a.userModified=!1;a.mouseMoved=!1;"select"===h&&(a.beforeStart=g[0].selectedIndex);a.refresh(b);return!1}).bind("vclick",!1);n.add(document).bind("vmouseup", function(){if(a.dragging)return a.dragging=!1,"select"===h&&(r.addClass("ui-slider-handle-snapping"),a.mouseMoved?a.userModified?a.refresh(0==a.beforeStart?1:0):a.refresh(a.beforeStart):a.refresh(0==a.beforeStart?1:0)),a.mouseMoved=!1});n.insertAfter(g);"select"==h&&this.handle.bind({focus:function(){n.addClass(b.mobile.focusClass)},blur:function(){n.removeClass(b.mobile.focusClass)}});this.handle.bind({vmousedown:function(){b(this).focus()},vclick:!1,keydown:function(d){var e=j();if(!a.options.disabled){switch(d.keyCode){case b.mobile.keyCode.HOME:case b.mobile.keyCode.END:case b.mobile.keyCode.PAGE_UP:case b.mobile.keyCode.PAGE_DOWN:case b.mobile.keyCode.UP:case b.mobile.keyCode.RIGHT:case b.mobile.keyCode.DOWN:case b.mobile.keyCode.LEFT:d.preventDefault(), a._keySliding||(a._keySliding=!0,b(this).addClass("ui-state-active"))}switch(d.keyCode){case b.mobile.keyCode.HOME:a.refresh(c);break;case b.mobile.keyCode.END:a.refresh(q);break;case b.mobile.keyCode.PAGE_UP:case b.mobile.keyCode.UP:case b.mobile.keyCode.RIGHT:a.refresh(e+s);break;case b.mobile.keyCode.PAGE_DOWN:case b.mobile.keyCode.DOWN:case b.mobile.keyCode.LEFT:a.refresh(e-s)}}},keyup:function(){a._keySliding&&(a._keySliding=!1,b(this).removeClass("ui-state-active"))}});this.refresh(v,v,!0)}, refresh:function(a,g,i){(this.options.disabled||this.element.attr("disabled"))&&this.disable();var d=this.element,h=d[0].nodeName.toLowerCase(),e="input"===h?parseFloat(d.attr("min")):0,p="input"===h?parseFloat(d.attr("max")):d.find("option").length-1,k="input"===h&&0<parseFloat(d.attr("step"))?parseFloat(d.attr("step")):1,j=d.attr("orientation");if("object"===typeof a){var c=a;if(!this.dragging||c.pageX<this.slider.offset().left-8||c.pageX>this.slider.offset().left+this.slider.width()+8)return;"vertical"== j?a=Math.round(100*((c.pageY-this.slider.offset().top)/this.slider.height())):"vertical-invers"==j?a=100-Math.round(100*((c.pageY-this.slider.offset().top)/this.slider.height())):"semicircle"==j?(a=c.pageX-this.slider.offset().left-this.slider.width()/2-2,c=-(c.pageY-this.slider.offset().top-this.slider.height()+8),a=Math.round(100*((180*(Math.atan2(a,c)/Math.PI)+90)/180)),0>a&&(a=0),100<a&&(a=100)):a=Math.round(100*((c.pageX-this.slider.offset().left)/this.slider.width()))}else null==a&&(a="input"=== h?parseFloat(d.val()||0):d[0].selectedIndex),a=100*((parseFloat(a)-e)/(p-e));if(!isNaN(a)){0>a&&(a=0);100<a&&(a=100);var c=a/100*(p-e)+e,q=(c-e)%k,c=c-q;2*Math.abs(q)>=k&&(c+=0<q?k:-k);c=parseFloat(c.toFixed(5));c<e&&(c=e);c>p&&(c=p);"vertical"==j?(this.handle.css("top",a+"%"),this.valuebg&&this.valuebg.css("height",a+"%")):"vertical-invers"==j?(this.handle.css("top",100-a+"%"),this.valuebg&&this.valuebg.css("height",100-a+"%")):"semicircle"==j?(e=(180*(a/100)-90)/180*Math.PI,this.handle.css("top", Math.round(-Math.cos(e)*(this.slider.width()/2-8)+((0==this.slider.height()?92:this.slider.height())-4))+"px"),this.handle.css("left",Math.round(Math.sin(e)*(this.slider.width()/2-8)+(this.slider.width()/2+4))+"px"),e=(1.08*a-8).toFixed(0),this.valuebg&&this.valuebg.css("width",(1>e?1:e)+"%")):(this.handle.css("left",a+"%"),this.valuebg&&this.valuebg.css("width",a+"%"));this.handle.attr({"aria-valuenow":"input"===h?c:d.find("option").eq(c).attr("value"),"aria-valuetext":"input"===h?c:d.find("option").eq(c).getEncodedText(), title:"input"===h?c:d.find("option").eq(c).getEncodedText()});if(this._labels){var e=100*(this.handle.width()/this.slider.width()),f=a&&e+(100-e)*a/100,s=100===a?0:Math.min(e+100-f,100);this._labels.each(function(){var a=b(this).is(".ui-slider-label-a");b(this).width((a?f:s)+"%")})}i||(i=!1,"input"===h?(i=d.val()!==c,d.val(c)):(i=d[0].selectedIndex!==c,d[0].selectedIndex=c),!g&&i&&d.trigger("change"))}},enable:function(){this.element.attr("disabled",!1);this.slider.removeClass("ui-disabled").attr("aria-disabled", !1);return this._setOption("disabled",!1)},disable:function(){this.element.attr("disabled",!0);this.slider.addClass("ui-disabled").attr("aria-disabled",!0);return this._setOption("disabled",!0)}});b(document).bind("pagecreate create",function(a){b.mobile.slider.prototype.enhanceWithin(a.target,!0)})})(jQuery);