/* smartVISU, Martin Glei√ü, 2013, GPL <http://www.gnu.de> */
var widget={buffer:{},explode:function(b){var a=[],c=[];if(0<=b.indexOf(",")){b=b.explode();for(var d=0;d<b.length;d++)""!=b[d]&&(c[b[d]]="");for(var e in c)a.push(e)}else""!=b.trim()&&a.push(b.trim());return a},listening:function(){var b=!1;0<$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').size()&&(b=!0);return b},listeners:function(){var b=[],a=[];$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').each(function(){for(var b=widget.explode($(this).attr("data-item")),c=0;c<b.length;c++)a[b[c]]=
""});for(var c in a)b.push(c);return b},list:function(){var b=0;$("[data-item]").each(function(){""!=$(this).attr("data-item").trim()&&b++})},check:function(b){if(b instanceof Array)for(var a=0;a<b.length;a++){if(void 0===b[a]||null==b[a])return!1}else if(void 0===b||null==b)return!1;return!0},get:function(b){if(b instanceof Array)for(var a=[],c=0;c<b.length;c++)a.push(widget.buffer[b[c]]);else a=widget.buffer[b];return a},set:function(b,a){widget.buffer[b]instanceof Array||void 0!==a&&(widget.buffer[b]=
$.isNumeric(a)?1*a:a)},update:function(b,a){if(void 0===a||widget.buffer[b]!==a||widget.buffer[b]instanceof Array&&widget.buffer[b].toString()!=a.toString())widget.set(b,a),$('[data-item*="'+b+'"]').each(function(){for(var c=widget.explode($(this).attr("data-item")),d=0;d<c.length;d++)if(c[d]==b){var e=[];if("plot."==$(this).attr("data-widget").substr(0,5)&&$("#"+this.id).highcharts()){for(var f=0;f<c.length;f++)e.push(c[f]==b?a:null);void 0!==a&&null!=a&&$(this).trigger("point",[e])}else e=widget.get(c),
widget.check(e)&&$(this).trigger("update",[e])}})},prepare:function(){$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item]').each(function(){$("#"+this.id).highcharts()&&$("#"+this.id).highcharts().destroy()})},refresh:function(){$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').each(function(){var b=widget.get(widget.explode($(this).attr("data-item")));widget.check(b)&&$(this).trigger("update",[b])})},plot:function(b){var a=$();b?$('[id^="'+$.mobile.activePage.attr("id")+
'-"][data-widget^="plot."][data-item*="'+b+'"]').each(function(){for(var c=widget.explode($(this).attr("data-item")),d=0;d<c.length;d++)c[d]==b&&(a=a.add(this))}):a=$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item]');return a},is_series:function(b){b=b.split(".");return b instanceof Array&&("avg"==b[b.length-3]||"sum"==b[b.length-3]||"min"==b[b.length-3]||"max"==b[b.length-3])?!0:!1}};
$(document).delegate('[data-widget="basic.value"]',{update:function(b,a){$("#"+this.id).html(a+" "+$(this).attr("data-unit"))}});
$(document).delegate('[data-widget="basic.float"]',{update:function(b,a){"\u00b0"==$(this).attr("data-unit")?$("#"+this.id).html(parseFloat(a).transTemp()):"%"==$(this).attr("data-unit")?$("#"+this.id).html(parseFloat(a).transPercent()):"\u20ac"==$(this).attr("data-unit")?$("#"+this.id).html(parseFloat(a).transCurrency()):$("#"+this.id).html(parseFloat(a).transFloat()+" "+$(this).attr("data-unit"))}});
$(document).delegate('[data-widget="basic.text"]',{update:function(b,a){$("#"+this.id).html(a==$(this).attr("data-val-on")?$(this).attr("data-txt-on"):$(this).attr("data-txt-off"))}});$(document).delegate('input[data-widget="basic.checkbox"]',{update:function(b,a){$(this).prop("checked",0!=a).checkboxradio("refresh")},change:function(){io.write($(this).attr("data-item"),$(this).prop("checked")?1:0)}});
$(document).delegate('select[data-widget="basic.flip"]',{update:function(b,a){$(this).val(0<a?"on":"off").slider("refresh")},change:function(){io.write($(this).attr("data-item"),"on"==$(this).val()?1:0)}});
$(document).delegate('input[data-widget="basic.slider"]',{update:function(b,a){$(this).attr("lock",1);$("#"+this.id).val(a).slider("refresh");$("#"+this.id).attr("mem",$(this).val())},slidestop:function(){$(this).val()!=$(this).attr("mem")&&io.write($(this).attr("data-item"),$(this).val())},change:function(){if((void 0===$(this).attr("timer")||0==$(this).attr("timer")&&0==$(this).attr("lock"))&&$(this).val()!=$(this).attr("mem"))void 0!==$(this).attr("timer")&&$(this).trigger("click"),$(this).attr("timer",
1),setTimeout("$('#"+this.id+"').attr('timer', 0);",400);$(this).attr("lock",0)},click:function(){io.write($(this).attr("data-item"),$(this).val())}});
$(document).delegate('span[data-widget="basic.symbol"]',{update:function(b,a){var c="and"==$(this).attr("data-mode");if(a instanceof Array)for(var d=0;d<a.length;d++)c="and"==$(this).attr("data-mode")?c&&a[d]==$(this).attr("data-val"):c||a[d]==$(this).attr("data-val");else c=a==$(this).attr("data-val");$("#"+this.id+" img").attr("title",new Date);c?$("#"+this.id).show():$("#"+this.id).hide()}});
$(document).delegate('span[data-widget="basic.switch"]',{update:function(b,a){$("#"+this.id+" img").attr("src",a==$(this).attr("data-val-on")?$(this).attr("data-pic-on"):$(this).attr("data-pic-off"))},click:function(){$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?io.write($(this).attr("data-item"),$(this).attr("data-val-on")):io.write($(this).attr("data-item"),$(this).attr("data-val-off"))}});
$(document).delegate('span[data-widget="basic.switch"] > a > img',"hover",function(b){"mouseenter"===b.type?$(this).addClass("ui-focus"):$(this).removeClass("ui-focus")});
$(document).delegate('span[data-widget="basic.shifter"]',{update:function(b,a){var c=Math.min(10*(10*(a[1]/$(this).attr("data-max"))+0.49).toFixed(0),100);0!=a[0]&&0<c?$("#"+this.id+" img").attr("src",$(this).attr("data-pic-on").replace("00",c)):$("#"+this.id+" img").attr("src",$(this).attr("data-pic-off"))},click:function(){var b=$(this).attr("data-item").explode();$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?io.write(b[0],1):io.write(b[0],0)}});
$(document).delegate('span[data-widget="basic.shifter"] > a > img',"hover",function(b){"mouseenter"===b.type?$(this).addClass("ui-focus"):$(this).removeClass("ui-focus")});$(document).delegate('a[data-widget="basic.button"]',{click:function(){""!=$(this).attr("data-val")&&io.write($(this).attr("data-item"),$(this).attr("data-val"))}});
$(document).delegate('a[data-widget="basic.dual"]',{update:function(b,a){$("#"+this.id+" img").attr("src",a==$(this).attr("data-val-on")?$(this).attr("data-pic-on"):$(this).attr("data-pic-off"))},click:function(){$("#"+this.id+" img").attr("src")==$(this).attr("data-pic-off")?io.write($(this).attr("data-item"),$(this).attr("data-val-on")):io.write($(this).attr("data-item"),$(this).attr("data-val-off"))}});
$(document).delegate('div[data-widget="basic.shutter"]',{update:function(b,a){var c=13,d="half"==$(this).attr("data-mode")?0.5:1;void 0!==a[1]&&(c=parseInt(13/d*(a[1]/$(this).attr("data-max")+d-1)));h=parseInt(182*a[0]/$(this).attr("data-max"));for(var e=12;1<=e;e--)if(14<=h){var f=13-Math.abs(c),d="height: "+(h>14*e&&13==c?14-f:15-f)+"px;",d=13!=c?d+("margin-top: "+(14<=h-15?f:parseInt(f/2))+"px;"):d+("border-top: 1px dotted "+(h>14*e?"#ccc":"#333")+";");0<c?$("#"+this.id+"-"+e).attr("class","blade-pos"):
$("#"+this.id+"-"+e).attr("class","blade-neg");$("#"+this.id+"-"+e).attr("style",d);h-=15}else d="height: "+h+"px;",d+="border-top: 1px dotted #aaa;",$("#"+this.id+"-"+e).attr("style",d),h=1},click:function(b){var a=$(this).offset(),c=Math.round(b.pageX-a.left);b=Math.floor(((b.pageY-a.top)/160-0.0625)*$(this).attr("data-max")/$(this).attr("data-step"))*$(this).attr("data-step");b=b.limit($(this).attr("data-min"),$(this).attr("data-max"),1);a=$(this).attr("data-item").explode();""!=a[1]&&52<c?io.write(a[1],
b):io.write(a[0],b)},mouseenter:function(){$("#"+this.id+" .control").fadeIn(400)},mouseleave:function(){$("#"+this.id+" .control").fadeOut(400)}});$(document).delegate('a[data-widget="basic.rgb"]',{update:function(b,a){var c=$(this).attr("data-max");$("#"+this.id+" span").css("background-color","rgb("+Math.round(255*(a[0]/c))+","+Math.round(255*(a[1]/c))+","+Math.round(255*(a[2]/c))+")")}});
$(document).delegate('div[data-widget="basic.rgb-popup"] > div',{click:function(){var b=$(this).css("background-color"),b=b.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),a=$(this).parent().attr("data-max"),c=$(this).parent().attr("data-item").explode();io.write(c[0],Math.round(b[1]/255*a));io.write(c[1],Math.round(b[2]/255*a));io.write(c[2],Math.round(b[3]/255*a));$(this).parent().popup("close")},mouseenter:function(){$(this).addClass("ui-focus")},mouseleave:function(){$(this).removeClass("ui-focus")}});
$(document).delegate('a[data-widget="basic.colordisc"]',{update:function(b,a){var c=$(this).attr("data-max");$("#"+this.id+" span").css("background-color","rgb("+Math.round(255*(a[0]/c))+","+Math.round(255*(a[1]/c))+","+Math.round(255*(a[2]/c))+")")},click:function(){$("#"+this.id+"-screen").removeClass("hide");$("#"+this.id+"-screen").addClass("in");var b=$(this).offset(),a=$("#"+this.id+"-disc"),c=b.top-a.height()/2+15,b=b.left-a.width()/2+25;a.css("top",c.limit(5,$(window).height()+$(document).scrollTop()-
a.height()-5,1));a.css("left",b.limit(5,$(window).width()-a.width()-5,1));a.show()}});$(document).delegate('div[data-widget="basic.colordisc"]',{click:function(){var b=this.id.substr(0,this.id.length-7);$("#"+b+"-disc").hide();$("#"+b+"-screen").removeClass("in");$("#"+b+"-screen").addClass("hide")}});
$(document).delegate('canvas[data-widget="basic.colordisc"]',{init:function(){var b=parseFloat($(this).attr("data-colors")),a=$(this)[0],c=100/($(this).attr("data-step")/2),d=2*(Math.PI/(b+2)),e=-(Math.PI/2)+d,f=16.875/($(this).attr("data-step")/8),j=360/b;a.width=280;a.height=280;if(a.getContext){a=a.getContext("2d");a.beginPath();a.fillStyle="#888";a.shadowColor="rgba(96,96,96,0.4)";a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowBlur=4;a.arc(139,139,139,0,2*Math.PI);a.fill();a.beginPath();a.shadowOffsetX=
0;a.shadowOffsetY=0;a.shadowBlur=0;a.fillStyle="#555";a.arc(139,139,138,0,2*Math.PI);a.fill();for(var g=0;g<=b;g++){for(var l=e+g*d,m=1,n=g*j,k=c;100>=k;k+=c)a.beginPath(),a.fillStyle=hsv2rgb(n,100,k),a.arc(139,139,m*f+f+1,l,l+d+0.01,!1),a.arc(139,139,m*f,l+d+0.01,l,!0),a.fill(),m+=1;for(k=100-c;k>=c;k-=c)a.beginPath(),a.fillStyle=hsv2rgb(n,k,100),a.arc(139,139,m*f+f+1,l,l+d+0.01,!1),a.arc(139,139,m*f,l+d+0.01,l,!0),a.fill(),m+=1}g-=1;l=e+g*d;m=1;n=g*j;for(k=c;100>=k;k+=c/2)a.beginPath(),a.fillStyle=
hsv2rgb(n,0,k),a.arc(139,139,m*f+f+1,l,l+2*d+0.01,!1),a.arc(139,139,m*f,l+2*d+0.01,l,!0),a.fill(),m+=1;a.beginPath();a.fillStyle="rgb(0,0,0)";a.arc(139,139,f+1,0,2*Math.PI);a.fill()}},click:function(b){var a=this.id.substr(0,this.id.length-5),c=$(this)[0].getContext("2d"),d=$(this).offset(),e=Math.round(b.pageX-d.left);b=Math.round(b.pageY-d.top);c=c.getImageData(e,b,1,1).data;e=$("#"+a).attr("data-max");b=$("#"+a).attr("data-item").explode();io.write(b[0],Math.round(c[0]/255*e));io.write(b[1],Math.round(c[1]/
255*e));io.write(b[2],Math.round(c[2]/255*e));$(this).hide();$("#"+a+"-screen").removeClass("in");$("#"+a+"-screen").addClass("hide")}});$(document).delegate('div[data-widget="basic.tank"]',{update:function(b,a){$("#"+this.id+" div").css("height",Math.round(180*Math.min(a/$(this).attr("data-max"),1)))}});
$(document).delegate('span[data-widget="basic.notify"]',{update:function(b,a){0!=a[0]&&(notify.add($(this).attr("data-mode"),$(this).attr("data-signal"),$("#"+this.id+" h1").html(),"<b>"+a[1]+"</b><br />"+$("#"+this.id+" p").html()),notify.display())}});
$(document).delegate('div[data-widget="device.rtr"] > div > a[data-icon="minus"]',{click:function(){var b=$(this).parent().parent().attr("id"),a=$("#"+b).attr("data-step"),b=$("#"+b+"set").attr("data-item"),a=(Math.round(10*(widget.get(b)-a))/10).toFixed(1);io.write(b,a)}});
$(document).delegate('div[data-widget="device.rtr"] > div > a[data-icon="plus"]',{click:function(){var b=$(this).parent().parent().attr("id"),a=$("#"+b).attr("data-step"),b=$("#"+b+"set").attr("data-item"),a=(Math.round(10*(1*widget.get(b)+1*a))/10).toFixed(1);io.write(b,a)}});
$(document).delegate('div[data-widget="plot.period"]',{update:function(b,a){for(var c=$(this).attr("data-label").explode(),d=$(this).attr("data-color").explode(),e=$(this).attr("data-exposure").explode(),f=$(this).attr("data-axis").explode(),j=[],g=0;g<a.length;g++)j[g]={type:"stair"!=e[g]?e[g]:"line",step:"stair"==e[g]?"left":!1,name:c[g],data:a[g],color:d[g]?d[g]:null};$("#"+this.id).highcharts({series:j,xAxis:{type:"datetime",title:{text:f[0]}},yAxis:{min:$(this).attr("data-ymin"),max:$(this).attr("data-ymax"),
title:{text:f[1]}}})},point:function(b,a){for(var c=0;c<a.length;c++)if(a[c]){for(var d=$("#"+this.id).highcharts(),e=0;e<a[c].length;e++)d.series[c].addPoint(a[c][e],!1,100<=d.series[c].data.length);d.redraw()}}});
$(document).delegate('div[data-widget="plot.rtr"]',{update:function(b,a){for(var c=$(this).attr("data-label").explode(),d=$(this).attr("data-axis").explode(),e=a[2],f=e[0][0],j=0,g=1;g<e.length;g++)j+=e[g-1][1]*(e[g][0]-f),f=e[g][0];j/=f-e[0][0];1>j?j*=100:100<j&&(j=100*(j/255));$("#"+this.id).highcharts({chart:{type:"line"},series:[{name:c[0],data:a[0],type:"spline"},{name:c[1],data:a[1],dashStyle:"shortdot",step:"left"},{type:"pie",name:"\u2211 On: ",data:[{name:"On",y:j},{name:"Off",y:100-j,color:null}],
center:["95%","90%"],size:15,showInLegend:!1,dataLabels:{enabled:!1}}],xAxis:{type:"datetime"},yAxis:{min:$(this).attr("data-min"),max:$(this).attr("data-max"),title:{text:d[1]}},tooltip:{formatter:function(){return this.series.name+" <b>"+(this.percentage?this.y.transPercent():this.y.transTemp())+"</b>"}}})},point:function(b,a){for(var c=0;c<a.length;c++){var d=$("#"+this.id).highcharts();if(a[c]&&(0==c||1==c))for(var e=0;e<a[c].length;e++)d.series[c].addPoint(a[c][e],!1,100<=d.series[c].data.length);
d.redraw()}}});
$(document).delegate('div[data-widget="plot.comfortchart"]',{update:function(b,a){var c=$(this).attr("data-label").explode(),d=$(this).attr("data-axis").explode(),e=[];e[0]={type:"area",name:c[0],lineWidth:0,data:[[17,35],[16,75],[17,85],[21,80],[25,60],[27,35],[25,19],[20,20],[17,35]]};e[1]={type:"area",name:c[1],lineWidth:0,data:[[17,75],[22.5,65],[25,33],[18.5,35],[17,75]]};e[2]={name:"point",data:[[1*a[0],1*a[1]]],marker:{enabled:!0,lineWidth:2,radius:6,symbol:"circle"},showInLegend:!1};$("#"+
this.id).highcharts({series:e,xAxis:{min:10,max:35,title:{text:d[0],align:"high",margin:-2}},yAxis:{min:0,max:100,title:{text:d[1],margin:7}},plotOptions:{area:{enableMouseTracking:!1}},tooltip:{formatter:function(){return this.x.transTemp()+" / "+this.y.transPercent()}}})},point:function(b,a){var c=$("#"+this.id).highcharts(),d=c.series[2].data[0];a[0]||(a[0]=d.x);a[1]||(a[1]=d.y);c.series[2].data[0].update([1*a[0],1*a[1]],!0)}});
$(document).delegate('div[data-widget="plot.temprose"]',{update:function(b,a){var c=$(this).attr("data-label").explode(),d=$(this).attr("data-axis").explode(),e=parseInt($(this).attr("data-count")),f=[];f[0]={name:c[0],pointPlacement:"on",data:a.slice(0,e)};a.slice(e).length==e&&(f[1]={name:c[1],pointPlacement:"on",data:a.slice(e),dashStyle:"shortdot"});$("#"+this.id).highcharts({chart:{polar:!0,type:"line",marginLeft:10},series:f,xAxis:{categories:d,tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",
lineWidth:0},tooltip:{formatter:function(){return this.x+" - "+this.series.name+": <b>"+this.y.transTemp()+"</b>"}},legend:{x:10,layout:"vertical"}})},point:function(b,a){var c=$("#"+this.id).highcharts(),d=c.series[2].data[0];a[0]||(a[0]=d.x);a[1]||(a[1]=d.y);c.series[2].data[0].update([1*a[0],1*a[1]],!0)}}); 
