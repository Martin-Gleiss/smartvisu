/* smartVISU, Martin Glei√ü, 2013, GPL [http://www.gnu.de] */
Number.prototype.limit=function(a,b,c){var d=this;d<a&&(d=a);d>b&&(d=b);c&&(d=Math.floor(d,c));return d};String.prototype.explode=function(a){var b=[];if(this.length)for(b=this.split(void 0!==a?a:","),a=0;a<b.length;a++)b[a]=b[a].trim();return b};
Date.prototype.duration=function(a){var b={y:307584E5,m:2592E6,w:6048E5,d:864E5,h:36E5,i:6E4,s:1E3},c=0;if(a){a=a.toLowerCase().split(" ");for(var d=0,e=1,e=-1,f=c=0;f<a.length;f+=1)if(Number(a[f]))d=a[f];else{if(e=a[f].match(/[a-z]/)){var g=e.index,e=a[f].substr(g);0<g&&(d=a[f].substr(0,g))}else e=a[f];e&&d&&(e=b[e],c+=d*e,d=0)}0==c&&0<d&&(c=d*b.s)}return new Date(c)};
var fx={init:function(){$('img.icon1[src$=".svg"], a.icon1 > img.icon[src$=".svg"]').each(function(){var a=$(this),b=a.attr("id"),c=a.attr("class"),d=a.attr("src");$.get(d,function(d){d=$(d).find("svg");"undefined"!==typeof b&&(d=d.attr("id",b));d=d.attr("class","fx-"+c);d.find('[fill!="none"]').removeAttr("fill");d.find("g").children().removeAttr("stroke");d.children().removeAttr("stroke");a.replaceWith(d)},"xml")})},rotate:function(a,b,c){var d=Math.cos(b)*(a[0]-c[0])-Math.sin(b)*(a[1]-c[1])+c[0];
a=Math.sin(b)*(a[0]-c[0])+Math.cos(b)*(a[1]-c[1])+c[1];return[d,a]},grid:function(a,b,c,d){var e;for(this.remove(a);0<b;)e=document.createElementNS("http://www.w3.org/2000/svg","line"),e.setAttributeNS(null,"x1",c[0]),e.setAttributeNS(null,"y1",c[1]<d[1]?c[1]+b:c[1]-b),e.setAttributeNS(null,"x2",d[0]),e.setAttributeNS(null,"y2",c[1]<d[1]?c[1]+b:c[1]-b),$("#"+a.id+" g").append(e),b-=6},remove:function(a,b){b||(b="line");$("#"+a.id+" g").children().each(function(a){a=$(this);a.is(b)&&a.remove()})},
hsv2rgb:function(a,b,c){var d,e,f;a=Math.max(0,Math.min(360,a));b=Math.max(0,Math.min(100,b));c=Math.max(0,Math.min(100,c));b/=100;c/=100;if(0==b)d=b=c;else switch(a/=60,d=Math.floor(a),e=a-d,a=c*(1-b),f=c*(1-b*e),e=c*(1-b*(1-e)),d){case 0:d=c;b=e;c=a;break;case 1:d=f;b=c;c=a;break;case 2:d=a;b=c;c=e;break;case 3:d=a;b=f;break;case 4:d=e;b=a;break;default:d=c,b=a,c=f}d=Math.round(255*d);b=Math.round(255*b);c=Math.round(255*c);return"rgb("+d+","+b+","+c+")"}},notify={i:0,messages:{},exists:function(){var a=
!1,b;for(b in notify.messages)a=!0;return a},add:function(a,b,c,d){notify.i++;notify.messages[notify.i]=[];notify.messages[notify.i]={level:a,signal:b,title:c,text:d,time:Date.now()}},debug:function(a,b){},update:function(a,b){notify.add("update","UPDATE",a,b);notify.display()},info:function(a,b){notify.add("info","INFO",a,b);notify.display()},warning:function(a,b){notify.add("warning","WARN",a,b);notify.display()},error:function(a,b){notify.add("error","ERROR",a,b);notify.display()},json:function(a,
b,c){a=jQuery.parseJSON(a.responseText);for(b=0;b<a.length;b++)notify.add("error","ERROR",a[b].title,a[b].text);notify.display()},remove:function(a){var b=notify.messages[notify.i];$(".alert").popup("close");$(".signal").removeClass(b.level).hide();void 0!==a?delete notify.messages[a]:notify.messages={}},display:function(){var a=notify.messages[notify.i];a&&($(".alert h1").html(a.title),$(".alert p").html(a.text),$(".alert .stamp").html((new Date(a.time)).transShort()),$(".signal").addClass(a.level).html(a.signal).show())}},
repeater={dir:{},init:function(){$("[data-repeat]").each(function(a){repeater.dir[this.id]||(a=$("#"+this.id),repeater.dir[this.id]=(new Date).duration(a.attr("data-repeat")),a.trigger("repeat"),repeater.tick(this.id))})},tick:function(a){var b=new Date,c=repeater.dir[a];6E4<=c&&(c-=1E3*b.getSeconds());36E5<=c&&(c-=6E4*b.getMinutes());864E5<=c&&(c-=36E5*b.getHours());setTimeout("$('#"+a+"').trigger('repeat'); repeater.tick('"+a+"');",c)},list:function(){var a=0;$("[data-repeat]").each(function(b){a++})}},
widget={buffer:{},explode:function(a){var b=[],c=[];if(0<=a.indexOf(",")){a=a.explode();for(var d=0;d<a.length;d++)""!=a[d]&&(c[a[d]]="");for(var e in c)b.push(e)}else""!=a.trim()&&b.push(a.trim());return b},list:function(){var a=0;$("[data-item]").each(function(b){""!=$(this).attr("data-item").trim()&&a++})},check:function(a){if(a instanceof Array)for(var b=0;b<a.length;b++){if(void 0===a[b]||null==a[b])return!1}else if(void 0===a||null==a)return!1;return!0},get:function(a){if(a instanceof Array)for(var b=
[],c=0;c<a.length;c++)b.push(widget.buffer[a[c]]);else b=widget.buffer[a];return b},set:function(a,b){widget.buffer[a]instanceof Array||void 0!==b&&(widget.buffer[a]=$.isNumeric(b)?1*b:b)},update:function(a,b){if(void 0===b||widget.buffer[a]!==b||widget.buffer[a]instanceof Array&&widget.buffer[a].toString()!=b.toString())widget.set(a,b),$('[data-item*="'+a+'"]').each(function(c){c=widget.explode($(this).attr("data-item"));for(var d=0;d<c.length;d++)if(c[d]==a){var e=[];if("plot."==$(this).attr("data-widget").substr(0,
5)&&$("#"+this.id).highcharts()){for(var f=0;f<c.length;f++)e.push(c[f]==a?b:null);void 0!==b&&null!=b&&$(this).trigger("point",[e])}else e=widget.get(c),widget.check(e)&&$(this).trigger("update",[e])}})},prepare:function(){$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item]').each(function(a){$("#"+this.id).highcharts()&&$("#"+this.id).highcharts().destroy()})},refresh:function(){$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').each(function(a){a=widget.get(widget.explode($(this).attr("data-item")));
widget.check(a)&&$(this).trigger("update",[a])})},checkseries:function(a){a=a.split(".");return 0<=$.inArray(a[a.length-3],"avg min max sum diff rate on".split(" "))},listeners:function(){var a=[],b=[];$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').each(function(a){if("status.log"!=$(this).attr("data-widget")){a=widget.explode($(this).attr("data-item"));for(var c=0;c<a.length;c++)widget.checkseries(a[c])||(b[a[c]]="")}});for(var c in b)a.push(c);return a},plot:function(a){var b=$();a?
$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item*="'+a+'"]').each(function(c){c=widget.explode($(this).attr("data-item"));for(var d=0;d<c.length;d++)c[d]==a&&(b=b.add(this))}):b=$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item]');return b},log:function(a){var b=$();a?$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget="status.log"][data-item="'+a+'"]').each(function(c){c=widget.explode($(this).attr("data-item"));for(var d=0;d<c.length;d++)c[d]==
a&&(b=b.add(this))}):b=$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget="status.log"][data-item]');return b}}; 
