/* smartVISU, Martin GleiÃŸ, 2012 - 2015, GPL [http://www.gnu.de] */
function printf(t,e){var i=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(([\.,])(\*\d+\$|\*|\d+))?([sScboxXuideEfFgG])/g,r=function(t,e,i){return i>0&&(t=t.slice(0,i)),t},a=function(t,e,i){var r=t>>>0;return i=i&&r&&{2:"0b",8:"0",16:"0x"}[e]||"",i+r.toString(e)},n=function(t,e){return"."!=e&&(t=t.replace(".",e)),t},o=function(t,i,o,s,d,f,c,l){var u,g="";if("%%"===t)return"%";switch("+"==o&&(g="+"),l){case"s":return r(String(e),s,c);case"S":return r(String(e),s,c).toUpperCase();case"c":return r(String.fromCharCode(+e),s,c);case"b":return a(e,2,g);case"o":return a(e,8,g);case"x":return a(e,16,g);case"X":return a(e,16,g).toUpperCase();case"u":return a(e,10,g);case"i":case"d":return u=+e||0,u=Math.round(u-u%1),g=0>u?"-":g,g+String(Math.abs(u));case"e":case"E":case"f":case"F":case"g":case"G":u=+e,g=0>u?"-":g;var h=["toExponential","toFixed","toPrecision"]["efg".indexOf(l.toLowerCase())],p=["toString","toUpperCase"]["eEfFgG".indexOf(l)%2];return n((g+Math.abs(u)[h](c))[p](),f);default:return t}};return t.replace(i,o)}Number.prototype.limit=function(t,e,i){var r=this;return t>r&&(r=t),r>e&&(r=e),i&&(r=Math.floor(r,i)),r},String.prototype.explode=function(t){var e=Array();if(this.length){e=this.split(void 0!==t?t:",");for(var i=0;i<e.length;i++)e[i]=e[i].trim()}return e},Date.prototype.duration=function(t){var e={y:307584e5,m:2592e6,w:6048e5,d:864e5,h:36e5,i:6e4,s:1e3},i=0;if(t){var r,a=t.toLowerCase().split(" "),n=0,o=1,s=-1;i=0;for(var d=0;d<a.length;d+=1)if(r=!1,Number(a[d]))n=a[d];else{if(s=a[d].match(/[a-z]/)){var f=s.index;r=a[d].substr(f),f>0&&(n=a[d].substr(0,f))}else r=a[d];r&&n&&(o=e[r],i+=n*o,n=0,r=!1)}0==i&&n>0&&(i=n*e.s)}return new Date(i)};var fx={init:function(){$('img.icon1[src$=".svg"], a.icon1 > img.icon[src$=".svg"]').each(function(){var t=$(this),e=t.attr("id"),i=t.attr("class"),r=t.attr("src");$.get(r,function(r){var a=$(r).find("svg");"undefined"!=typeof e&&(a=a.attr("id",e)),a=a.attr("class","fx-"+i),a.find('[fill!="none"]').removeAttr("fill"),a.find("g").children().removeAttr("stroke"),a.children().removeAttr("stroke"),t.replaceWith(a)},"xml")})},rotate:function(t,e,i){var r=Math.cos(e)*(t[0]-i[0])-Math.sin(e)*(t[1]-i[1])+i[0],a=Math.sin(e)*(t[0]-i[0])+Math.cos(e)*(t[1]-i[1])+i[1];return[r,a]},grid:function(t,e,i,r){var a;for(this.remove(t);e>0;)a=document.createElementNS("http://www.w3.org/2000/svg","line"),a.setAttributeNS(null,"x1",i[0]),a.setAttributeNS(null,"y1",i[1]<r[1]?i[1]+e:i[1]-e),a.setAttributeNS(null,"x2",r[0]),a.setAttributeNS(null,"y2",i[1]<r[1]?i[1]+e:i[1]-e),$("#"+t.id+" g").append(a),e-=6},bar:function(t,e,i,r){var a;this.remove(t);for(var n=2.5,o=(r[0]-i[0])/n,s=(i[1]-r[1])/o*2,e=e*o,d=0;e>d;)a=document.createElementNS("http://www.w3.org/2000/svg","line"),a.setAttributeNS(null,"x1",i[0]+n*d),a.setAttributeNS(null,"y1",i[1]),a.setAttributeNS(null,"x2",i[0]+n*d),a.setAttributeNS(null,"y2",i[1]-s*d),$("#"+t.id+" g").append(a),d+=n},remove:function(t,e){e||(e="line"),$("#"+t.id+" g").children().each(function(){var t=$(this);t.is(e)&&t.remove()})},hsv2rgb:function(t,e,i){var r,a,n,o,s,d,f,c;if(t=Math.max(0,Math.min(360,t)),e=Math.max(0,Math.min(100,e)),i=Math.max(0,Math.min(100,i)),e/=100,i/=100,0==e)r=a=n=i;else switch(t/=60,o=Math.floor(t),s=t-o,d=i*(1-e),f=i*(1-e*s),c=i*(1-e*(1-s)),o){case 0:r=i,a=c,n=d;break;case 1:r=f,a=i,n=d;break;case 2:r=d,a=i,n=c;break;case 3:r=d,a=f,n=i;break;case 4:r=c,a=d,n=i;break;default:r=i,a=d,n=f}return r=Math.round(255*r),a=Math.round(255*a),n=Math.round(255*n),"rgb("+r+","+a+","+n+")"}},notify={i:0,messages:new Object,exists:function(){var t=!1;for(var e in notify.messages)t=!0;return t},add:function(t,e,i,r){notify.i++,notify.messages[notify.i]=Array(),notify.messages[notify.i]={level:t,signal:e,title:i,text:r,time:Date.now()},console.log("[notify."+notify.messages[notify.i].level+"] "+notify.messages[notify.i].title+" - "+notify.messages[notify.i].text)},debug:function(){},update:function(t,e){notify.add("update","UPDATE",t,e),notify.display()},info:function(t,e){notify.add("info","INFO",t,e),notify.display()},warning:function(t,e){notify.add("warning","WARN",t,e),notify.display()},error:function(t,e){notify.add("error","ERROR",t,e),notify.display()},json:function(t){var e=t.responseJSON[0];notify.add("error","ERROR",e.title,e.text),notify.display()},remove:function(t){var e=notify.messages[notify.i];$(".alert").popup("close"),$(".signal").removeClass(e.level).hide(),void 0!==t?delete notify.messages[t]:notify.messages=new Object},display:function(){var t=notify.messages[notify.i];t&&($(".alert h1").html(t.title),$(".alert p").html(t.text),$(".alert .stamp").html(new Date(t.time).transShort()),$(".signal").addClass(t.level).html(t.signal).show())}},repeater={dir:new Object,init:function(){$("[data-repeat]").each(function(){if(!repeater.dir[this.id]){var t=$("#"+this.id);repeater.dir[this.id]=(new Date).duration(t.attr("data-repeat")),t.trigger("repeat"),repeater.tick(this.id)}})},tick:function(t){var e=new Date,i=repeater.dir[t];i>=6e4&&(i-=1e3*e.getSeconds()),i>=36e5&&(i-=60*e.getMinutes()*1e3),i>=864e5&&(i-=60*e.getHours()*60*1e3),setTimeout("$('#"+t+"').trigger('repeat'); repeater.tick('"+t+"');",i)},list:function(){var t=0;$("[data-repeat]").each(function(){console.log("["+$(this).attr("data-widget")+"] '"+this.id+"' repeats every '"+$(this).attr("data-repeat")+"'"),t++}),console.log("[repeater] --> "+t+" widgets - ",Object.keys(repeater.dir).length+" in dir")}},widget={buffer:new Object,explode:function(t){var e=Array(),i=Array();if(t.indexOf(",")>=0){for(var r=t.explode(),a=0;a<r.length;a++)""!=r[a]&&(i[r[a]]="");for(var n in i)e.push(n)}else""!=t.trim()&&e.push(t.trim());return e},list:function(){var t=0;$("[data-item]").each(function(){""!=$(this).attr("data-item").trim()&&(console.log("["+$(this).attr("data-widget")+"] '"+this.id+"' listen on '"+$(this).attr("data-item")+"'"),t++)}),console.log("[widget] --> "+t+" listening.")},check:function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)if(void 0===t[e]||null==t[e])return!1}else if(void 0===t||null==t)return!1;return!0},get:function(t){if(t instanceof Array)for(var e=Array(),i=0;i<t.length;i++)e.push(widget.buffer[t[i]]);else var e=widget.buffer[t];return e},set:function(t,e){widget.buffer[t]instanceof Array||void 0!==e&&(widget.buffer[t]=$.isNumeric(e)?1*e:e)},update:function(t,e){(void 0===e||widget.buffer[t]!==e||widget.buffer[t]instanceof Array&&widget.buffer[t].toString()!=e.toString())&&(widget.set(t,e),$('[data-item*="'+t+'"]').each(function(){for(var i=widget.explode($(this).attr("data-item")),r=0;r<i.length;r++)if(i[r]==t){var a=Array();if("plot."==$(this).attr("data-widget").substr(0,5)&&$("#"+this.id).highcharts()){for(var n=0;n<i.length;n++)a.push(i[n]==t?e:null);void 0!==e&&null!=e&&(console.log("["+$(this).attr("data-widget")+"] point '"+this.id+"':",a),$(this).trigger("point",[a]))}else a=widget.get(i),widget.check(a)&&(console.log("["+$(this).attr("data-widget")+"] update '"+this.id+"':",a),$(this).trigger("update",[a]))}}))},prepare:function(){$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item]').each(function(){$("#"+this.id).highcharts()&&$("#"+this.id).highcharts().destroy()})},refresh:function(){$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').each(function(){var t=widget.get(widget.explode($(this).attr("data-item")));widget.check(t)&&$(this).trigger("update",[t])})},checkseries:function(t){var e=t.split(".");return $.inArray(e[e.length-4],Array("avg","min","max","sum","diff","rate","on"))>=0},listeners:function(){var t=Array(),e=Array();$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-item]').each(function(){if("status.log"!=$(this).attr("data-widget"))for(var t=widget.explode($(this).attr("data-item")),i=0;i<t.length;i++)widget.checkseries(t[i])||(e[t[i]]="")});for(var i in e)t.push(i);return t},plot:function(t){var e=$();return t?$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item*="'+t+'"]').each(function(){for(var i=widget.explode($(this).attr("data-item")),r=0;r<i.length;r++)i[r]==t&&(e=e.add(this))}):e=$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget^="plot."][data-item]'),e},log:function(t){var e=$();return t?$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget="status.log"][data-item="'+t+'"]').each(function(){for(var i=widget.explode($(this).attr("data-item")),r=0;r<i.length;r++)i[r]==t&&(e=e.add(this))}):e=$('[id^="'+$.mobile.activePage.attr("id")+'-"][data-widget="status.log"][data-item]'),e}};