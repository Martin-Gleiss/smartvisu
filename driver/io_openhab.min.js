
var io = {

	adress: '',

	port: '',

	read: function (item) {
		$.ajax({  url: 'driver/io_openhab.php?cmd=getState&item=' + item,
			type: 'GET',
			dataType: 'text',
			async: true,
			cache: false,
		})
			.done(function (response) {
				widget.update(item, response);
			});
	},

	write: function (item, val) {
		io.put(item, val);
	},


	trigger: function (name, val) {
		// not supported
	},


	init: function (address, port) {
		io.address = address;
		io.port = port;
	},


	run: function (realtime) {
		io.RefreshAllItems();
	},

	RefreshAllItems: function() {
		var items = '';

		// only if anyone listens
		if (widget.listeners().length) {
			      
			var item = widget.listeners();
			
			for (var i = 0; i < widget.listeners().length; i++) {
				var currentItem = item[i];
				io.read(currentItem);
			}
			

		}
	},

    put: function (item, val) {
        var url = 'driver/io_openhab.php?cmd=setState&item=' + item + '&state=' + val;

        $.ajax({
            url: url,
            type: 'GET',
            async: true,
            cache: false,
            data: val
        })
				.done(function (response) {
				    widget.update(item, response);
				});

    },

};
