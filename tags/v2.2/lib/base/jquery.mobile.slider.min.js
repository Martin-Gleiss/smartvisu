(function(b,w){b.widget("mobile.slider",b.mobile.widget,{options:{theme:null,trackTheme:null,disabled:!1,initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",mini:!1},_create:function(){var a=this,g=this.element,j=b.mobile.getInheritedTheme(g,"c"),d=this.options.theme||j,j=this.options.trackTheme||j,h=g[0].nodeName.toLowerCase(),e="select"==h?"ui-slider-switch":"",q=g.attr("id"),l=q+"-label",q=b("[for='"+q+"']").attr("id",l),k=function(){return"input"==h?parseFloat(g.val()): g[0].selectedIndex},c="input"==h?parseFloat(g.attr("min")):0,r="input"==h?parseFloat(g.attr("max")):g.find("option").length-1,f=g.attr("orientation"),t=window.parseFloat(g.attr("step")||1),u=this.options.inline||!0==g.jqmData("inline")?" ui-slider-inline":"",y=this.options.mini||g.jqmData("mini")?" ui-slider-mini":"",v=document.createElement("a"),s=b(v),n=document.createElement("div"),p=b(n),m;if(g.jqmData("highlight")&&"select"!=h){m=document.createElement("div");if("semicircle"==f){m.className= "ui-slider-semicircle-highlight-cut";var x=document.createElement("div");x.className="ui-slider-semicircle ui-btn-active";m.appendChild(x)}else m.className="ui-slider-bg ui-btn-active ui-btn-corner-all";m=b(m).prependTo(p)}else m=!1;v.setAttribute("href","#");n.setAttribute("role","application");n.className=["ui-slider"+(f?"-"+f:" "),e," ui-btn-down-",j," ui-btn-corner-all",u,y].join("");v.className="ui-slider-handle"+(f?"-"+f:"");n.appendChild(v);"semicircle"==f&&(e=document.createElement("div"), e.className="ui-slider-semicircle-box",f=document.createElement("div"),f.className="ui-slider-semicircle-cut",e.appendChild(f),f.appendChild(n),u=document.createElement("div"),u.className="ui-slider-semicircle-inner ui-body-"+j,f.appendChild(u),f=document.createElement("div"),f.className="ui-slider-semicircle-bottom "+(m?"ui-btn-active ":"")+"ui-btn-down-"+j,f.style.cssFloat="left",e.appendChild(f),f=document.createElement("div"),f.className="ui-slider-semicircle-bottom ui-btn-down-"+j,f.style.cssFloat= "right",e.appendChild(f),p=b(e));s.buttonMarkup({corners:!0,theme:d,shadow:!0}).attr({role:"slider","aria-valuemin":c,"aria-valuemax":r,"aria-valuenow":k(),"aria-valuetext":k(),title:k(),"aria-labelledby":l});b.extend(this,{slider:p,handle:s,valuebg:m,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1});if("select"===h){d=document.createElement("div");d.className="ui-slider-inneroffset";l=0;for(m=n.childNodes.length;l<m;l++)d.appendChild(n.childNodes[l]);n.appendChild(d);s.addClass("ui-slider-handle-snapping"); n=g.find("option");d=0;for(l=n.length;d<l;d++)m=!d?"b":"a",e=!d?" ui-btn-down-"+j:" "+b.mobile.activeBtnClass,document.createElement("div"),f=document.createElement("span"),f.className=["ui-slider-label ui-slider-label-",m,e," ui-btn-corner-all"].join(""),f.setAttribute("role","img"),f.appendChild(document.createTextNode(n[d].innerHTML)),b(f).prependTo(p);a._labels=b(".ui-slider-label",p)}q.addClass("ui-slider");g.addClass("input"===h?"ui-slider-input":"ui-slider-switch").change(function(){a.mouseMoved|| a.refresh(k(),!0)}).keyup(function(){a.refresh(k(),!0,!0)}).blur(function(){a.refresh(k(),!0)});b(document).bind("vmousemove",function(b){if(a.dragging)return a.mouseMoved=!0,"select"===h&&s.removeClass("ui-slider-handle-snapping"),a.refresh(b),a.userModified=a.beforeStart!==g[0].selectedIndex,!1});p.bind("vmousedown",function(b){a.dragging=!0;a.userModified=!1;a.mouseMoved=!1;"select"===h&&(a.beforeStart=g[0].selectedIndex);a.refresh(b);return!1}).bind("vclick",!1);p.add(document).bind("vmouseup", function(){if(a.dragging)return a.dragging=!1,"select"===h&&(s.addClass("ui-slider-handle-snapping"),a.mouseMoved?a.userModified?a.refresh(0==a.beforeStart?1:0):a.refresh(a.beforeStart):a.refresh(0==a.beforeStart?1:0)),a.mouseMoved=!1});p.insertAfter(g);"select"==h&&this.handle.bind({focus:function(){p.addClass(b.mobile.focusClass)},blur:function(){p.removeClass(b.mobile.focusClass)}});this.handle.bind({vmousedown:function(){b(this).focus()},vclick:!1,keydown:function(d){var e=k();if(!a.options.disabled){switch(d.keyCode){case b.mobile.keyCode.HOME:case b.mobile.keyCode.END:case b.mobile.keyCode.PAGE_UP:case b.mobile.keyCode.PAGE_DOWN:case b.mobile.keyCode.UP:case b.mobile.keyCode.RIGHT:case b.mobile.keyCode.DOWN:case b.mobile.keyCode.LEFT:d.preventDefault(), a._keySliding||(a._keySliding=!0,b(this).addClass("ui-state-active"))}switch(d.keyCode){case b.mobile.keyCode.HOME:a.refresh(c);break;case b.mobile.keyCode.END:a.refresh(r);break;case b.mobile.keyCode.PAGE_UP:case b.mobile.keyCode.UP:case b.mobile.keyCode.RIGHT:a.refresh(e+t);break;case b.mobile.keyCode.PAGE_DOWN:case b.mobile.keyCode.DOWN:case b.mobile.keyCode.LEFT:a.refresh(e-t)}}},keyup:function(){a._keySliding&&(a._keySliding=!1,b(this).removeClass("ui-state-active"))}});this.refresh(w,w,!0)}, refresh:function(a,g,j){(this.options.disabled||this.element.attr("disabled"))&&this.disable();var d=this.element,h=d[0].nodeName.toLowerCase(),e="input"===h?parseFloat(d.attr("min")):0,q="input"===h?parseFloat(d.attr("max")):d.find("option").length-1,l="input"===h&&0<parseFloat(d.attr("step"))?parseFloat(d.attr("step")):1,k=d.attr("orientation");if("object"===typeof a){var c=a;if(!this.dragging||c.pageX<this.slider.offset().left-8||c.pageX>this.slider.offset().left+this.slider.width()+8)return;"vertical"== k?a=Math.round(100*((c.pageY-this.slider.offset().top)/this.slider.height())):"bottomup"==k?a=100-Math.round(100*((c.pageY-this.slider.offset().top)/this.slider.height())):"semicircle"==k?(a=c.pageX-this.slider.offset().left-this.slider.width()/2-2,c=-(c.pageY-this.slider.offset().top-this.slider.height()+8),a=Math.round(100*((180*(Math.atan2(a,c)/Math.PI)+90)/180)),0>a&&(a=0),100<a&&(a=100)):a=Math.round(100*((c.pageX-this.slider.offset().left)/this.slider.width()))}else null==a&&(a="input"===h? parseFloat(d.val()||0):d[0].selectedIndex),a=100*((parseFloat(a)-e)/(q-e));if(!isNaN(a)){0>a&&(a=0);100<a&&(a=100);var c=a/100*(q-e)+e,r=(c-e)%l,c=c-r;2*Math.abs(r)>=l&&(c+=0<r?l:-l);c=parseFloat(c.toFixed(5));c<e&&(c=e);c>q&&(c=q);"vertical"==k?(this.handle.css("top",a+"%"),this.valuebg&&this.valuebg.css("height",a+"%")):"bottomup"==k?(this.handle.css("top",100-a+"%"),this.valuebg&&this.valuebg.css("margin-top",(this.slider.height()*(100-a)/100).toFixed(0)+"px"),this.valuebg&&this.valuebg.css("height", a+"%")):"semicircle"==k?(e=(180*(a/100)-90)/180*Math.PI,this.handle.css("top",Math.round(-Math.cos(e)*(this.slider.width()/2-8)+((0==this.slider.height()?92:this.slider.height())-4))+"px"),this.handle.css("left",Math.round(Math.sin(e)*(this.slider.width()/2-8)+(this.slider.width()/2+4))+"px"),e=(1.08*a-8).toFixed(0),this.valuebg&&this.valuebg.css("width",(1>e?1:e)+"%")):(this.handle.css("left",a+"%"),this.valuebg&&this.valuebg.css("width",a+"%"));this.handle.attr({"aria-valuenow":"input"===h?c:d.find("option").eq(c).attr("value"), "aria-valuetext":"input"===h?c:d.find("option").eq(c).getEncodedText(),title:"input"===h?c:d.find("option").eq(c).getEncodedText()});if(this._labels){var e=100*(this.handle.width()/this.slider.width()),f=a&&e+(100-e)*a/100,t=100===a?0:Math.min(e+100-f,100);this._labels.each(function(){var a=b(this).is(".ui-slider-label-a");b(this).width((a?f:t)+"%")})}j||(j=!1,"input"===h?(j=d.val()!==c,d.val(c)):(j=d[0].selectedIndex!==c,d[0].selectedIndex=c),!g&&j&&d.trigger("change"))}},enable:function(){this.element.attr("disabled", !1);this.slider.removeClass("ui-disabled").attr("aria-disabled",!1);return this._setOption("disabled",!1)},disable:function(){this.element.attr("disabled",!0);this.slider.addClass("ui-disabled").attr("aria-disabled",!0);return this._setOption("disabled",!0)}});b(document).bind("pagecreate create",function(a){b.mobile.slider.prototype.enhanceWithin(a.target,!0)})})(jQuery);