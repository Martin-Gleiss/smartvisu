/* smartVISU, Martin Glei√ü, 2013, GPL <http://www.gnu.de> */
var io={adress:"",port:"",read:function(a){io.get(a)},write:function(a,b){io.put(a,b)},init:function(a,b){io.address=a;io.port=b;io.stop()},run:function(a){widget.refresh();io.all();a&&io.start()},timer:0,timer_run:!1,loop:function(){widget.listening()&&(io.timer=setTimeout("io.loop(); io.all();",1E3))},start:function(){!io.timer_run&&widget.listening()&&(io.loop(),io.timer_run=!0)},stop:function(){clearTimeout(io.timer);io.timer_run=!1},get:function(a){$.ajax({url:"driver/io_offline.php",data:{item:a},
type:"GET",dataType:"json",async:!0,cache:!1}).done(function(b){widget.update(a,b[a])})},put:function(a,b){var c=io.timer_run;io.stop();$.ajax({url:"driver/io_offline.php",data:{item:a,val:b},type:"GET",dataType:"json",cache:!1}).done(function(b){widget.update(a,b[a]);c&&io.start()})},all:function(){var a="";if(widget.listening()){for(var b=widget.listeners(),c=0;c<widget.listeners().length;c++)a+=b[c]+",";a=a.substr(0,a.length-1);$.ajax({url:"driver/io_offline.php",data:{item:a},type:"POST",dataType:"json",
async:!0,cache:!1}).done(function(a){widget.plot().each(function(){for(var b=widget.explode($(this).attr("data-item")),c=0;c<b.length;c++){var d=b[c].split(".");null==a[b[c]]&&(null==widget.get(b[c])&&widget.is_series(b[c]))&&(a[b[c]]=io.series(d[d.length-2],d[d.length-1],$(this).attr("data-ymin"),$(this).attr("data-ymax"),$(this).attr("data-step")))}});$.each(a,function(a,b){widget.update(a,b)})})}},series:function(a,b,c,e,f){var g=[];c||(c=0);e||(e=255);var d=1*c+(e-c)/2;c=(e-c)/20;a=(new Date).getTime()-
(new Date).duration(a);b=(new Date).getTime()-(new Date).duration(b);for(f=Math.round((b-a)/f);a<=b;)d+=Math.random()*2*c-c,g.push([a,1*d.toFixed(2)]),a+=f;return g}}; 
