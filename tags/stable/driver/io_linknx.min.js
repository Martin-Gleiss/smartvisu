/* smartVISU, Martin Glei√ü, 2013, GPL [http://www.gnu.de] */
var io={adress:"",port:"",read:function(a){io.get(a)},write:function(a,b){io.put(a,b)},trigger:function(a,b){},init:function(a,b){io.address=a;io.port=b;io.stop()},run:function(a){widget.refresh();io.all();a&&io.start()},timer:0,timer_run:!1,loop:function(){widget.listeners().length&&(io.timer=setTimeout("io.loop(); io.all();",1E3))},start:function(){!io.timer_run&&widget.listeners().length&&(io.loop(),io.timer_run=!0)},stop:function(){clearTimeout(io.timer);io.timer_run=!1},get:function(a){$.ajax({url:"driver/io_linknx.php",
data:{item:a},type:"GET",dataType:"json",async:!0,cache:!1}).done(function(b){"object"==typeof b?widget.update(a,b[a]):notify.error("Driver: linknx",b)})},put:function(a,b){var c=io.timer_run;io.stop();$.ajax({url:"driver/io_linknx.php",data:{item:a,val:b},type:"GET",dataType:"json",cache:!1}).done(function(b){"object"==typeof b?(widget.update(a,b[a]),c&&io.start()):notify.error("Driver: linknx",b)})},all:function(){var a="";if(widget.listeners().length){for(var b=widget.listeners(),c=0;c<widget.listeners().length;c++)a+=
b[c]+",";a=a.substr(0,a.length-1);$.ajax({url:"driver/io_linknx.php",data:{item:a},type:"POST",dataType:"json",async:!0,cache:!1}).done(function(a){"object"==typeof a?$.each(a,function(a,b){widget.update(a,b)}):notify.error("Driver: linknx",a)})}}}; 
